<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>GTAåœ°å›¾ - æ´›åœ£éƒ½</title>
        <!-- FontAwesome 6 Free for custom checkbox icons -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" crossorigin="anonymous" />

    <!-- Leaflet CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      crossorigin=""
    />

    <style>
        /* CSSå˜é‡ç³»ç»Ÿ - å®šä¹‰GTAé£æ ¼çš„è“è‰²ä¸»é¢˜ */
        :root {
            --gta-bg-dark: #0a1929;
            --gta-bg-medium: rgba(15, 25, 35, 0.95);
            --gta-bg-light: rgba(25, 40, 55, 0.7);
            --gta-primary: #1976d2;
            --gta-primary-glow: rgba(25, 118, 210, 0.7);
            --gta-secondary: #2196f3;
            --gta-border: #2e5c8a;
            --gta-border-light: #4a90e2;
            --gta-text: #ffffff;
            --gta-text-secondary: #b3d9ff;
            --gta-accent: #42a5f5;
            /* å…¼å®¹å˜é‡æ˜ å°„ï¼Œä¾›ä½©é‡Œç§‘æ ·å¼å¤ç”¨ï¼ˆè“è‰²ä¸»é¢˜ï¼‰ */
            --bg-darker: var(--gta-bg-medium);
            --primary-color: var(--gta-primary);
            --primary-dark: #145a9e;
            --accent-color: var(--gta-accent);
            --border-color: var(--gta-border);
            --text-secondary: var(--gta-text-secondary);
            --transition: all 0.15s ease;
        }

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: var(--gta-bg-dark);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            /* ç¦æ­¢ç§»åŠ¨ç«¯ç¼©æ”¾ï¼ˆæåˆ/åŒå‡»ï¼‰ */
            touch-action: manipulation; /* é™åˆ¶æ‰‹åŠ¿ä¸ºåŸºæœ¬äº¤äº’ï¼Œé˜»æ­¢åŒæŒ‡ç¼©æ”¾ */
            -ms-touch-action: manipulation;
            -webkit-text-size-adjust: 100%; /* é˜²æ­¢ iOS åŒå‡»æ”¾å¤§æ–‡æœ¬ */
        }

        /* éšè—æ•´ä½“é¡µé¢çš„æ»šåŠ¨æ¡ï¼ˆå³ä¾§å’Œåº•éƒ¨ï¼‰ï¼Œä½†ä¸å½±å“å†…éƒ¨å¯æ»šåŠ¨é¢æ¿æ ·å¼ */
        html, body {
            overflow: hidden; /* éšè—å…¨å±€æ»šåŠ¨ */
        }

        /* WebKit æµè§ˆå™¨éšè—æ»šåŠ¨æ¡è½¨é“ï¼Œä½†ä¿ç•™æ»šåŠ¨åŠŸèƒ½ï¼ˆç”¨äºå†…éƒ¨æ»šåŠ¨å®¹å™¨ï¼‰ */
        html::-webkit-scrollbar, body::-webkit-scrollbar {
            width: 0px;
            height: 0px;
        }

        /* Firefox éšè—æ»šåŠ¨æ¡ï¼ˆä»å¯æ»šåŠ¨ï¼‰ */
        html, body {
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE 10+ */
        }

        /* ä¸»å®¹å™¨ */
        #map-container {
            width: 100%;
            height: 100%;
            position: relative;
            cursor: grab;
            overflow: visible !important;
        }
        #map-container:active { cursor: grabbing; }

        #tile-pane {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 650;
        }

        /* éšè—åœ°å›¾ä¸Šçš„æ¸¸æˆåŸç‚¹æ˜¾ç¤ºï¼ˆè‹¥å­˜åœ¨ï¼‰ */
        #origin-marker {
            display: none !important;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loader {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--gta-text);
            background: var(--gta-bg-medium);
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 18px;
            z-index: 800;
            opacity: 0;
            transition: opacity 0.25s ease-in-out;
            pointer-events: none;
            border: 1px solid var(--gta-border);
        }
        .loader.visible { opacity: 1; pointer-events: auto; }

        /* æ–‡ä»¶è¯†åˆ«çŠ¶æ€ */
        #file-status {
            position: absolute;
            left: 15px;
            top: 15px;
            background: rgba(0,0,0,0.7);
            color: var(--gta-text);
            padding: 6px 10px;
            border-radius: 6px;
            border: 1px solid rgba(255,255,255,0.06);
            z-index: 750;
            font-size: 13px;
            pointer-events: none;
            min-width: 180px;
        }
        #file-status.ok { background: rgba(21,128,61,0.9); }
        #file-status.warn { background: rgba(170,85,0,0.9); }
        #file-status.err { background: rgba(128,20,20,0.9); }

        /* ç‰©å“æ ‡è®°æ ·å¼ */
        .item-marker {
            position: absolute;
            transform: translate(-50%, -50%);
            z-index: 670;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        .item-marker:hover {
            transform: translate(-50%, -50%) scale(1.2);
        }
        .item-marker img {
            width: 32px;
            height: 32px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
        }

        /* ä½©é‡Œç§‘å²›é£æ ¼ï¼šç‰©å“é€‰æ‹©å™¨ï¼ˆè“è‰²ä¸»é¢˜ï¼‰ */
        .item-selector-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .item-checkbox-wrapper {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            width: 100%;
        }

        .item-checkbox {
            display: none;
        }

        /* éšè—åŸç”Ÿå¤é€‰ï¼Œä½¿ç”¨ç´§å‡‘çš„ label åšæ›¿ä»£ */
        .item-checkbox + label {
            display: flex;
            align-items: center;
            padding: 6px 10px;
            background: var(--bg-darker);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: var(--transition);
            width: 100%;
            color: var(--gta-text);
            gap: 4px;
        }

        .nav-links {
            display: flex;
            gap: 15px;
            /* æ”¾åœ¨æ ‡é¢˜åé¢æ˜¾ç¤ºï¼Œä¸å†éœ€è¦é¢å¤–å·¦è¾¹è· */
            margin-left: 0;
            align-items: center;
        }

        .nav-links a {
            color: white; /* é“¾æ¥å­—ä½“æ”¹ä¸ºç™½è‰² */
            text-decoration: none;
            font-size: 14px;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        /* å½“æ—¶é—´/å¤©æ°”ä½äºå¯¼èˆªé“¾æ¥æ—æ—¶çš„å¾®è°ƒæ ·å¼ */
        .gta-nav .nav-left #game-time-weather {
            margin-left: 8px;
            font-size: 13px;
            opacity: 0.95;
            color: rgba(255,255,255,0.95);
            pointer-events: none;
        }

        .gta-nav .nav-left .nav-weather {
            display: inline-flex !important;
            align-items: center;
            gap: 6px;
            margin-left: 8px;
            color: white !important;
            font-size: 13px;
            pointer-events: none;
        }

        @media (max-width: 768px) {
            .gta-nav .nav-left #game-time-weather {
                margin-left: 10px;
                display: inline-flex !important;
                align-items: center;
                color: white !important;
            }
        }

        /* å¼ºè¦†ç›–ï¼Œä¿è¯ç§»åŠ¨ç«¯/å¯¼èˆªå†…å§‹ç»ˆå¯è§ */
        .gta-nav .nav-left #game-time-weather {
            display: inline-flex !important;
            align-items: center !important;
            color: white !important;
        }

        .nav-links a:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .gta-nav .nav-right {
            display: flex;
            gap: 15px;
        }

        /* ç§»åŠ¨ç«¯å¼ºåˆ¶è¦†ç›–ï¼šç¡®ä¿æ ‡é¢˜å·¦å¯¹é½ï¼Œä¸è¢«åç»­å…¨å±€è§„åˆ™å½±å“ */
        @media (max-width: 768px) {
            .gta-nav .nav-left {
                flex: 0 0 auto !important;
                flex-grow: 0 !important;
                justify-content: flex-start !important;
            }
            .gta-nav .nav-right {
                margin-left: auto !important;
            }
            .gta-title { text-align: left !important; }
        }

        .nav-buttons-desktop {
            display: flex;
            gap: 15px;
        }

        /* ç§»åŠ¨ç«¯æ ·å¼ */
        .nav-buttons-mobile {
            display: none;
        }

        /* ç§»åŠ¨ç«¯å¯¼èˆªï¼šä»…æ˜¾ç¤ºæ ‡é¢˜ä¸â€œæ›´å¤šâ€æŒ‰é’®ï¼Œå…¶ä½™é“¾æ¥æ”¾å…¥ä¸‹æ‹‰èœå• */
        @media (max-width: 768px) {
            .nav-links { display: none; }
            .nav-buttons-desktop { display: none; }
            .nav-buttons-mobile { display: block; }
            .gta-nav { padding: 8px 12px; }
            .gta-title { font-size: 18px; padding: 6px 10px; }

            /* ä¿æŒå¯¼èˆªæ åœ¨ä¸€è¡Œ */
            .gta-nav { flex-wrap: nowrap; align-items: center; }
            .gta-title { white-space: nowrap; }
            /* å·¦ä¾§æ ‡é¢˜å›ºå®šå®½åº¦ï¼Œä¸å æ»¡å‰©ä½™ç©ºé—´ */
            .nav-left { flex: 0 0 auto; display: flex; align-items: center; gap: 8px; }
            /* å³ä¾§é å³æ˜¾ç¤ºï¼Œä¿æŒä¸ºå†…è”æ¨ªå‘å¸ƒå±€ */
            .nav-right { flex: 0 0 auto; margin-left: auto; display: flex; align-items: center; }
            .nav-buttons-mobile { display: flex; align-items: center; }
            .menu-toggle { white-space: nowrap; }

            .mobile-menu {
                display: none;
                position: absolute;
                top: 56px;
                right: 12px;
                /* Use same visual style as the title bar for consistency */
                background: linear-gradient(90deg, rgba(10, 25, 41, 0.95) 0%, rgba(25, 118, 210, 0.95) 100%);
                border: 1px solid #42a5f5;
                padding: 10px;
                border-radius: 8px;
                z-index: 1100;
                box-shadow: 0 8px 22px rgba(20,30,50,0.5);
                flex-direction: column;
                gap: 8px;
                min-width: 160px;
                backdrop-filter: blur(6px);
            }

            .mobile-menu.show { display: flex; }

            .mobile-menu .nav-button,
            .mobile-menu .nav-link {
                display: flex;
                align-items: center;
                gap: 8px;
                background: rgba(255,255,255,0.06);
                color: white;
                padding: 8px 10px;
                border-radius: 8px;
                text-decoration: none;
                border: none;
                cursor: pointer;
            }

            .menu-toggle {
                background: rgba(255,255,255,0.06);
                color: white;
                border: 1px solid rgba(255,255,255,0.08);
                padding: 8px 12px;
                border-radius: 14px;
                cursor: pointer;
                font-size: 14px;
            }
        }

        .item-checkbox + label:before {
            /* ä½¿ç”¨ FontAwesome çš„æ–¹æ¡†å›¾æ ‡ä½œä¸ºå ä½ï¼ˆå›é€€ï¼‰ */
            content: "\f0c8";
            font-family: "Font Awesome 6 Free";
            margin-right: 4px;
            color: var(--text-secondary);
            transition: var(--transition);
            font-weight: 900;
            font-size: 16px;
            display: inline-block;
            width: 16px;
            text-align: center;
        }

        .item-checkbox:checked + label {
            background: var(--primary-dark);
            border-color: var(--primary-color);
            box-shadow: 0 0 10px var(--gta-primary-glow);
        }

        .item-checkbox:checked + label:before {
            content: "\f14a"; /* FontAwesome checked */
            color: var(--accent-color);
        }

        .item-checkbox + label:hover {
            border-color: var(--primary-color);
            background: rgba(25,118,210,0.12);
        }

        .item-icon {
            width: 16px;
            height: 16px;
            margin-right: 0;
            display: inline-block;
            object-fit: contain;
        }

        /* GTAé£æ ¼å¯¼èˆªæ  - ä½©é‡Œç§‘å²›é£æ ¼è“è‰²ä¸»é¢˜ */
        .gta-nav {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(90deg, rgba(10, 25, 41, 0.7) 0%, rgba(25, 118, 210, 0.7) 100%);
            border-bottom: 2px solid #42a5f5;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .gta-nav .nav-left {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-grow: 1;
        }

        .gta-title {
            font-family: 'Impact', sans-serif;
            color: white;
            font-size: 24px;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            margin: 0;
            display: flex;
            align-items: center;
            background: rgba(0,0,0,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .gta-title i {
            margin-right: 8px;
            color: var(--gta-primary);
        }

        .gta-nav .nav-right {
            display: flex;
            gap: 15px;
        }

        .nav-button {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .nav-button:hover {
            background: var(--gta-primary);
            color: var(--gta-bg-dark);
            box-shadow: 0 0 15px var(--gta-primary-glow);
            transform: translateY(-1px);
        }

        .nav-button.back-button {
            background: var(--gta-secondary);
            border-color: var(--gta-secondary);
        }

        /* ä¾§è¾¹æ ï¼ˆä½©é‡Œç§‘å²›æ ·å¼ï¼‰ */
        .side-panel {
            position: absolute;
            top: 80px;
            left: 10px;
            width: 320px;
            max-height: calc(100% - 120px);
            background: linear-gradient(180deg, rgba(10,20,30,0.85), rgba(15,25,35,0.9));
            border: 1px solid var(--gta-border);
            border-radius: 10px;
            color: var(--gta-text);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
            backdrop-filter: blur(6px);
        }

        .side-panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.03);
        }

        .side-panel-title {
            font-weight: bold;
            color: var(--gta-text);
            font-size: 14px;
            text-transform: uppercase;
        }

        .side-panel-content {
            padding: 12px;
            overflow-y: auto;
            max-height: calc(100vh - 80px);
            scrollbar-width: thin;
        }

        /* è“è‰²è‡ªå®šä¹‰æ»šåŠ¨æ¡ï¼ˆwebkitï¼‰ */
        .side-panel-content::-webkit-scrollbar {
            width: 8px;
            background: rgba(25, 118, 210, 0.08);
        }
        .side-panel-content::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #42a5f5 0%, #1976d2 100%);
            border-radius: 6px;
        }
        .side-panel-content::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #1976d2 0%, #42a5f5 100%);
        }
        /* Firefox */
        .side-panel-content {
            scrollbar-color: #42a5f5 rgba(25, 118, 210, 0.08);
            scrollbar-width: thin;
        }

        .side-panel-section { margin-bottom: 14px; }
        .side-panel-section-title { font-size: 13px; color: var(--gta-accent); margin-bottom: 8px; }

        /* item selector */
        .item-selector-container { display:flex; flex-direction:column; gap:6px; }
        .item-checkbox + label { display:flex; align-items:center; gap:8px; padding:8px; background: rgba(255,255,255,0.02); border-radius:6px; cursor:pointer; }

        /* éšè—é»˜è®¤ leaflet ç¼©æ”¾æ§ä»¶ */
        .leaflet-control-zoom { display: none; }

        /* åº•éƒ¨ç¼©æ”¾æ§åˆ¶ */
        .zoom-controls {
            position: absolute;
            bottom: 24px;
            right: 24px;
            display: flex;
            flex-direction: column;
            gap: 7px; /* æ”¾å¤§ 1/3ï¼ˆ5px -> 7pxï¼‰ */
            background: rgba(10,20,30,0.85);
            padding: 5px; /* 4px -> 5px */
            border-radius: 13px; /* 10px -> 13px */
            border: 1px solid var(--gta-border);
            box-shadow: 0 6px 14px rgba(0,0,0,0.5);
            z-index: 1000;
        }

        /* æŠ˜å çŠ¶æ€æ ·å¼ï¼šå½“é¢æ¿æ·»åŠ  .collapsed æ—¶æ”¶èµ·å†…å®¹å¹¶ç¼©çª„å®½åº¦ */
        .side-panel.collapsed {
            width: 56px;
            overflow: hidden;
            transition: width 0.25s ease;
        }

        .side-panel.collapsed .side-panel-content {
            display: none;
        }

        .side-panel.collapsed .side-panel-title {
            display: none;
        }

        .side-panel.collapsed .side-panel-header {
            justify-content: center;
        }

        .zoom-button {
            width: 30px; /* 22px * 4/3 â‰ˆ 29.3 -> 30px */
            height: 30px; /* 30px */
            background: linear-gradient(160deg, #145a9e 60%, #1976d2 100%);
            color: #fff;
            border: 1.5px solid #1565c0; /* ç•¥å¢è¾¹æ¡†ä»¥é€‚é…å°ºå¯¸ */
            border-radius: 50%;
            font-size: 0.9rem; /* ä»0.65remæ”¾å¤§1/3 -> ~0.87remï¼Œå–0.9rem */
            box-shadow: 0 0 0 1.3px rgba(25, 118, 210, 0.13), 0 3px 10px rgba(20, 90, 158, 0.22);
            cursor: pointer;
            transition: background 0.18s, box-shadow 0.18s, transform 0.12s;
            outline: none;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            user-select: none;
        }
        .zoom-button:active {
            background: linear-gradient(160deg, #0d305a 60%, #145a9e 100%);
            box-shadow: 0 0 0 1.3px #145a9e, 0 1px 5px rgba(20,90,158,0.18);
            transform: scale(0.98);
        }
        .zoom-button:hover, .zoom-button:focus {
            background: linear-gradient(160deg, #1976d2 0%, #145a9e 100%);
            box-shadow: 0 0 0 2px #1976d2, 0 5px 16px rgba(20,90,158,0.32);
            transform: scale(1.05);
        }
        .zoom-button i {
            font-size: 16px; /* é€‚é… 30px æŒ‰é’® */
            line-height: 1;
            margin: 0;
            pointer-events: none;
        }

        /* å³ä¸Šè§’åœ°å›¾æ§åˆ¶èœå•æŒ‰é’®ç¾åŒ– */
        .side-panel-toggle {
            width: 40px;
            height: 40px;
            background: transparent !important;
            color: #fff;
            border: none !important;
            border-radius: 50%;
            font-size: 1.3rem;
            box-shadow: none !important;
            cursor: pointer;
            transition: background 0.18s, box-shadow 0.18s, transform 0.12s;
            outline: none;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 8px;
            padding: 0;
            user-select: none;
        }
        .side-panel-toggle:active {
            background: rgba(25, 118, 210, 0.10);
            box-shadow: none;
            transform: scale(0.96);
        }
        .side-panel-toggle:hover, .side-panel-toggle:focus {
            background: rgba(25, 118, 210, 0.13);
            box-shadow: 0 0 0 2px #1976d233, 0 2px 8px #1976d211;
            transform: scale(1.08);
        }
        .side-panel-toggle i {
            font-size: 1.2em;
            line-height: 1;
            margin: 0;
            pointer-events: none;
        }
        /* å³ä¸Šè§’åœ°å›¾æ§åˆ¶èœå•æŒ‰é’®ç¾åŒ– */
        .side-panel-toggle {
            width: 38px;
            height: 38px;
            background: linear-gradient(145deg, var(--gta-accent) 0%, var(--gta-primary) 100%);
            color: #fff;
            border: none;
            border-radius: 50%;
            font-size: 1.3rem;
            box-shadow: 0 2px 8px rgba(25, 118, 210, 0.18), 0 1px 0 #fff inset;
            cursor: pointer;
            transition: background 0.18s, box-shadow 0.18s, transform 0.12s;
            outline: none;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 8px;
        }
        .side-panel-toggle:active {
            background: linear-gradient(145deg, var(--gta-primary) 0%, var(--gta-accent) 100%);
            box-shadow: 0 1px 4px rgba(25, 118, 210, 0.12);
            transform: scale(0.97);
        }
        .side-panel-toggle:hover, .side-panel-toggle:focus {
            background: linear-gradient(145deg, #42a5f5 0%, #1976d2 100%);
            box-shadow: 0 4px 16px rgba(25, 118, 210, 0.22);
            transform: scale(1.08);
        }
        .side-panel-toggle i {
            pointer-events: none;
        }
        .zoom-button:active {
            background: linear-gradient(145deg, var(--gta-primary) 0%, var(--gta-accent) 100%);
            box-shadow: 0 2px 8px rgba(25, 118, 210, 0.18);
            transform: scale(0.97);
        }
        .zoom-button:hover, .zoom-button:focus {
            background: linear-gradient(145deg, #42a5f5 0%, #1976d2 100%);
            box-shadow: 0 6px 24px rgba(25, 118, 210, 0.32);
            transform: scale(1.10);
        }
        .zoom-button i {
            pointer-events: none;
        }

        /* è“è‰²æ»šåŠ¨æ¡ï¼ˆGTA é£æ ¼ï¼‰ */
        .side-panel-content::-webkit-scrollbar { width: 10px; }
        .side-panel-content::-webkit-scrollbar-track { background: rgba(255,255,255,0.02); border-radius: 6px; }
        .side-panel-content::-webkit-scrollbar-thumb { background: linear-gradient(180deg,var(--gta-primary),var(--gta-accent)); border-radius: 6px; box-shadow: inset 0 0 6px rgba(0,0,0,0.3); }

        .nav-button.back-button:hover {
            background: var(--gta-accent);
            border-color: var(--gta-accent);
        }

        .nav-section select {
            width: 100%;
            background: var(--gta-bg-dark);
            color: var(--gta-text);
            border: 1px solid var(--gta-border-light);
            padding: 8px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .nav-section select:hover {
            border-color: var(--gta-primary);
            box-shadow: 0 0 8px rgba(255, 204, 0, 0.3);
        }

        .nav-section select:focus {
            outline: none;
            border-color: var(--gta-primary);
            box-shadow: 0 0 12px rgba(255, 204, 0, 0.4);
        }

        /* ç‰©å“ç±»å‹é€‰æ‹©å™¨ */
        /* åœ°å›¾æ ·å¼é€‰æ‹©å™¨ï¼šæ”¾åœ¨ä¾§è¾¹æ å†…ï¼Œä¸ä½¿ç”¨ç»å¯¹å®šä½ä»¥é¿å…é®æŒ¡åœ°å›¾ */
        .map-style-selector {
            position: static;
            margin-bottom: 12px;
            background: transparent;
            border-radius: 6px;
            border: none;
            box-shadow: none;
            padding: 0;
            z-index: auto;
            width: 100%;
        }

        .map-style-selector label {
            display: block;
            margin-bottom: 8px;
            color: var(--gta-text);
            font-size: 14px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .map-style-selector select {
            width: 100%;
            background: var(--gta-bg-dark);
            color: var(--gta-text);
            border: 1px solid var(--gta-border-light);
            padding: 8px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s ease;
        }

        .map-style-selector select:hover {
            border-color: var(--gta-primary);
            box-shadow: 0 0 8px rgba(25, 118, 210, 0.3);
        }

        .map-style-selector select:focus {
            outline: none;
            border-color: var(--gta-accent);
            box-shadow: 0 0 12px rgba(30, 144, 255, 0.4);
        }

        .item-selector-wrapper {
            position: absolute;
            top: 150px;
            right: 15px;
            background: var(--gta-bg-medium);
            border-radius: 8px;
            border: 1px solid var(--gta-border);
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
            padding: 15px;
            z-index: 700;
            width: 200px;
        }

        .item-selector-label {
            color: var(--gta-text);
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            display: block;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        #item-type-select {
            width: 100%;
            background: var(--gta-bg-dark);
            color: var(--gta-text);
            border: 1px solid var(--gta-border-light);
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        #item-type-select:hover {
            border-color: var(--gta-primary);
            box-shadow: 0 0 8px rgba(255, 204, 0, 0.3);
        }

        #item-type-select:focus {
            outline: none;
            border-color: var(--gta-primary);
            box-shadow: 0 0 12px rgba(255, 204, 0, 0.4);
        }

        /* ç‰©å“ä¿¡æ¯å¼¹çª— */
        #item-info {
            position: absolute;
            bottom: 120px;
            left: 15px;
            background: var(--gta-bg-medium);
            border-radius: 8px;
            border: 1px solid var(--gta-border);
            box-shadow: 0 2px 15px rgba(0,0,0,0.5);
            padding: 15px;
            z-index: 700;
            max-width: 300px;
            display: none;
        }

        #item-info .close {
            position: absolute;
            top: 5px;
            right: 10px;
            color: var(--gta-text-secondary);
            font-size: 20px;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        #item-info .close:hover {
            color: var(--gta-secondary);
        }

        #item-title {
            color: var(--gta-primary);
            font-size: 18px;
            margin-top: 0;
            margin-bottom: 10px;
            font-weight: bold;
        }

        #item-coords, #item-location, #item-details {
            color: var(--gta-text);
            font-size: 14px;
            margin: 5px 0;
            line-height: 1.4;
        }

        /* å³ä¸‹è§’ç¼©æ”¾æŒ‰é’® - ç¼©å°ä¸º 50% */
        .zoom-controls {
            position: absolute;
            right: 32px;
            bottom: 18px;
            display: flex;
            flex-direction: column;
            gap: 8px; /* 50% */
            z-index: 1200;
            user-select: none;
        }

        #vertical-links a {
            color: var(--gta-primary);
            text-decoration: none;
            padding: 6px 12px;
            margin: 2px 0;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        #vertical-links a:hover {
            color: white;
            background: rgba(25, 118, 210, 0.2);
        }

        /* æ¸¸æˆæ—¶é—´/å¤©æ°” - é»˜è®¤ä½œä¸ºå¯¼èˆªä¸‹çš„å†…è”é¡¹ï¼Œå»æ‰åº•éƒ¨è“è‰²æ¡† */
        #game-time-weather {
            font-size: 14px;
            color: #fff;
            padding: 0;
            background: transparent;
            border: none;
            box-shadow: none;
            z-index: 1300;
            pointer-events: none;
            letter-spacing: 0.6px;
            min-width: 0;
            text-align: left;
            user-select: none;
            display: inline-block;
            opacity: 0.95;
        }

        /* ä¿æŒé™æ­¢ï¼Œæ— åŠ¨ç”» */

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .gta-nav {
                padding: 8px 15px;
                /* åœ¨ç§»åŠ¨ç«¯ä¹Ÿä¿æŒä¸€è¡Œï¼šæ ‡é¢˜å·¦ï¼Œæ›´å¤šæŒ‰é’®å³ */
                flex-direction: row;
                justify-content: space-between;
                gap: 8px;
                align-items: center;
            }

            .gta-title {
                font-size: 18px;
            }

            .nav-button {
                padding: 6px 12px;
                font-size: 12px;
            }

            /* ç§»åŠ¨ç«¯åªæ˜¾ç¤ºï¼šæ ‡é¢˜ã€æ—¶é—´/å¤©æ°”ã€æ›´å¤šï¼ˆéšè—å…¶å®ƒå·¦ä¾§/å³ä¾§é¡¹ï¼‰ */
            .gta-nav .nav-left > *:not(.gta-title):not(#game-time-weather) {
                display: none !important;
            }

            .gta-nav .nav-right > *:not(.nav-buttons-mobile) {
                display: none !important;
            }

            .nav-buttons-desktop { display: none !important; }
            .nav-buttons-mobile { display: flex !important; }

            .map-style-selector {
                top: 120px;
                right: 10px;
                width: 160px;
                padding: 10px;
            }

            .item-selector-wrapper {
                top: 190px;
                right: 10px;
                width: 160px;
                padding: 10px;
            }

            #item-info {
                bottom: 100px;
                left: 10px;
                max-width: 250px;
                padding: 10px;
            }

            /* Keep game time/weather inline on mobile so JS can place it next to the title.
               Previously it was forced to bottom-right with !important which conflicted
               with the runtime placement logic. */
            #game-time-weather {
                display: inline-flex !important;
                align-items: center !important;
                color: white !important;
                font-size: 14px !important;
                margin-left: 8px !important;
                background: transparent !important;
                padding: 0 6px !important;
                pointer-events: none !important;
                opacity: 1 !important;
            }
        }
    </style>
</head>
<body>

    <!-- åœ°å›¾å®¹å™¨ -->
    <div id="map-container">
        <!-- å·¦ä¾§æ§åˆ¶é¢æ¿ï¼ˆä½©é‡Œç§‘å²›æ ·å¼ï¼‰ -->
        <div class="side-panel" id="side-panel">
            <div class="side-panel-header">
                <div class="side-panel-title">åœ°å›¾æ§åˆ¶</div>
                <button class="side-panel-toggle" id="panel-toggle">
                    <i class="fas fa-chevron-left"></i>
                </button>
            </div>
            <div class="side-panel-content">
                <div class="side-panel-section">
                    <div class="side-panel-section-title">åœ°å›¾æ ·å¼</div>
                    <div class="map-style-selector">

                        <select id="map-style-select" style="width:100%; margin-top:6px;">
                            <option value="https://eo-gta-maps.antwen.com/maps/gta_map/gta_map_game">æ¸¸æˆ (Game)</option>
                            <option value="https://eo-gta-maps.antwen.com/maps/gta_map/gta_map_render">æ¸²æŸ“ (Render)</option>
                            <option value="https://eo-gta-maps.antwen.com/maps/gta_map/gta_map_print">å°åˆ· (Print)</option>
                        </select>
                    </div>
                </div>

                <div class="side-panel-section">
                    <div class="side-panel-section-title">æ˜¾ç¤ºç‰©å“</div>
                    <div class="item-selector-container" id="sidebar-item-selectors">
                        <!-- å¤ç”¨ç°æœ‰ item é€‰æ‹©ï¼ˆç¨åé€šè¿‡ JS å¡«å……ï¼‰ -->
                    </div>
                </div>

                <div class="side-panel-section">
                    <button id="reset-checkboxes" class="nav-button" style="width: 100%; margin-top: 10px;">
                        <i class="fas fa-undo"></i> é‡ç½®é€‰æ‹©
                    </button>
                </div>
            </div>
        </div>
        <div id="tile-pane"></div>
    </div>

    <!-- GTAé£æ ¼å¯¼èˆªæ  -->
    <div class="gta-nav">
        <div class="nav-left">
            <h1 class="gta-title">ğŸ™ï¸ æ´›åœ£éƒ½åœ°å›¾</h1>
            <div class="nav-links">
                <a href="https://www.antwen.com" target="_blank">å®‰ç¨³</a>
                <a href="https://s.antwen.com" target="_blank">åœ¨çº¿æ–‡ä»¶</a>
            </div>
        </div>
        <div class="nav-right">
            <!-- PCç«¯æ˜¾ç¤º -->
            <div class="nav-buttons-desktop">
                <a href="index.html" class="nav-button">ğŸ  é¦–é¡µ</a>
                <a href="cayo-perico-map.html" class="nav-button">ğŸï¸ ä½©é‡Œç§‘å²›</a>
                <a href="vehicles.html" class="nav-button">ğŸš— è½¦è¾†æ•°æ®åº“</a>
            </div>
            <!-- ç§»åŠ¨ç«¯æ˜¾ç¤º -->
            <div class="nav-buttons-mobile">
                <button class="menu-toggle" id="mobile-menu-toggle">
                    <i class="fas fa-bars"></i> æ›´å¤š
                </button>
                <div class="mobile-menu" id="mobile-menu">
                    <a href="index.html" class="nav-button">ğŸ  é¦–é¡µ</a>
                    <a href="cayo-perico-map.html" class="nav-button">ğŸï¸ ä½©é‡Œç§‘å²›</a>
                    <a href="vehicles.html" class="nav-button">ğŸš— è½¦è¾†æ•°æ®åº“</a>
                    <a href="https://www.antwen.com" target="_blank" class="nav-link">ğŸ”— å®‰ç¨³</a>
                    <a href="https://s.antwen.com" target="_blank" class="nav-link">â˜ï¸ åœ¨çº¿æ–‡ä»¶</a>
                </div>
            </div>
        </div>
    </div>

    <!-- åœ°å›¾æ ·å¼é€‰æ‹©å™¨ å·²ç§»å…¥ä¾§è¾¹æ  -->

    <!-- ç‰©å“ç±»å‹å¤é€‰é¡¹å·²ç§»å…¥ä¾§è¾¹æ  -->

    <!-- ç‰©å“ä¿¡æ¯å¼¹çª— -->
    <div id="item-info">
        <span class="close" onclick="hideItemInfoText()">Ã—</span>
        <h3 id="item-title">ç‰©å“ä¿¡æ¯</h3>
        <p id="item-coords">åæ ‡: </p>
        <p id="item-location">ä½ç½®: </p>
        <p id="item-details">è¯¦ç»†ä¿¡æ¯: </p>
    </div>

    <!-- åŠ è½½åŠ¨ç”» -->
    <div class="loader" id="loader">åœ°å›¾åŠ è½½ä¸­...</div>

        <!-- åº•éƒ¨ç¼©æ”¾æ§åˆ¶ -->
        <div class="zoom-controls">
            <button class="zoom-button" id="zoom-in">
                <i class="fas fa-plus"></i>
            </button>
            <button class="zoom-button" id="zoom-out">
                <i class="fas fa-minus"></i>
            </button>
        </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

    <script>
        // --- é…ç½®/å¸¸é‡ ---
        const TILE_SIZE = 256;
        const GAME_LEFT = -4140;
        const GAME_RIGHT = 4860;
        const GAME_BOTTOM = -5100;
        const GAME_TOP = 8400;

        const zoomLevels = [
            { zoom: 3, cols: 4, rows: 6 },   // æœ€å°ç¼©æ”¾çº§åˆ«
            { zoom: 4, cols: 8, rows: 12 },
            { zoom: 5, cols: 16, rows: 24 },
            { zoom: 6, cols: 32, rows: 48 } ,
            { zoom: 7, cols: 64, rows: 96 }  // æœ€å¤§ç¼©æ”¾çº§åˆ«
        ];

        // ç‰©å“å›¾æ ‡è·¯å¾„æ˜ å°„
        const itemIcons = {
            hidden_caches: './src/assets/cache.png',
            shipwrecked: './src/assets/shipwrecked.png',
            gun_van: './src/assets/van.png',
            dead_drop: './src/assets/dead_drop.svg',
            stunt_jumps: './src/assets/stunt_jumps.svg',
            spray: './src/assets/spray.svg',
            ls_tags: './src/assets/ls_tags.svg',
            street_dealers: './src/assets/dealer.png',
            playing_cards: './src/assets/playing_cards.svg',
            smoke_on_the_water_product: './src/assets/smoke_product.svg',
            action_figures: './src/assets/action_figures.svg',
            yuanbao: './src/assets/yuanbao.svg',
            ld_organics_products: './src/assets/organic_farm.svg',
            signal_jammers: './src/assets/signal_jammer.svg',
            jack_o_lanterns: 'data:image/svg+xml;base64,PHN2ZyBkYXRhLXYtZWEyMTA3NDY9IiIgdmlld0JveD0iMCAwIDY0IDY0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGNsYXNzPSJhYnNvbHV0ZSBpbnNldC14LTAgIXctZnVsbCI+PGNpcmNsZSBkYXRhLXYtZWEyMTA3NDY9IiIgY3g9IjMyIiBjeT0iMzIiIHI9IjIwIiBmaWxsPSIjZjI2ZjE3IiBmaWxsLW9wYWNpdHk9IjEiPjwvY2lyY2xlPjwvc3ZnPg==',
            payphone_hits: 'data:image/svg+xml;base64,PHN2ZyBkYXRhLXYtZWEyMTA3NDY9IiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBmaWxsPSIjZmZmIiB2aWV3Qm94PSIwIDAgNjQgNjQiIGNsYXNzPSJ1aS1pY29uIG1heC1oLWZ1bGwgd2Z1bGwiIHN0eWxlPSJvcGFjaXR5OiAxOyI+PGcgZmlsbD0iIzAwMCI+PHBhdGggZD0iTTU1LjUgNTAuMmE1LjMzIDUuMzMgMCAwMS01LjMzIDUuMzNIMTMuODFhNS4zMyA1LjMzIDAgMDEtNS4zMy01LjMzVjEzLjc4YTUuMzMgNS4zMyAwIDAxNS4zMy01LjMzaDM2LjM2YTUuMzMgNS4zMyAwIDAxNS4zMyA1LjMzem0tMi4yODItMzYuMzg3YTMuMTEgMy4xMSAwIDAwLTMuMTE1LTMuMTA1bC0zNi4zLjA2NGEzLjExIDMuMTEgMCAwMC0zLjEwNSAzLjExNWwuMDY0IDM2LjNhMy4xMSAzLjExIDAgMDAzLjExNSAzLjEwNWwzNi4zLS4wNjRhMy4xMSAzLjExIDAgMDAzLjEwNS0zLjExNXoiPjwvcGF0aD48cGF0aCBkPSJNMzAuNjUgMzkuNThjMy45NS0zLjY5IDQuOTQtNy40MSA2Ljk1LTExLjkzYS45NC45My02NyAwIDAwLS41LTEuMjVjLTEuNzUtLjcxLTMuODktMS40LTQuMDQtMy42NHEtLjIxLTMuMTMtLjA0LTcuMjJhMS41NyAxLjU3IDAgMDExLjQ1LTEuNTFjMTIuNjEtLjkzIDExIDEyLjg3IDcuNSAyMC41MS0zLjkzIDguNTYtOS44NyAxNy40MS0yMC40MyAxMy41NHEtMi4wNS0uNzYtMi45My0yLjkxYS45NC45My0zNC40IDAgMDEuMTktMWw1LjA4LTUuMjhhMS43OCAxLjc3LTU4LjQgMCAwMTEuODYtLjQ1bDMuOTYgMS4zNHEuNTQuMTguOTUtLjIiPjwvcGF0aD48L2c+PHBhdGggZD0iTTUzLjI4MiA1MC4xMTNhMy4xMSAzLjExIDAgMDEtMy4xMDUgMy4xMTVsLTM2LjMuMDZhMy4xMSAzLjExIDAgMDEtMy4xMTUtMy4xMDVsLS4wNjQtMzYuM2EzLjExIDMuMTEgMCAwMTMuMTA1LTMuMTE1bDM2LjMtLjA2NGMzLjExIDAgMy4xMTUgMy4xMDV6TTI5LjcgMzkuNzhsLTMuOTYtMS4zNGExLjc4IDEuNzctNTguNCAwIDAwLTEuODYuNDVsLTUuMDggNS4yOGEuOTQuOTMtMzQuNCAwIDAwLS4xOSAxcS44OCAyLjE1IDIuOTMgMi45MWMxMC41NiAzLjg3IDE2LjUtNC45OCAyMC40My0xMy41NCAzLjUtNy42NCA1LjExLTIxLjQ0LTcuNS0yMC41MWExLjU3IDEuNTcgMCAwMC0xLjQ1IDEuNTEgMTcuMTcgMTcuMTcgMCAwMC4wNCA3LjIyYy4xNSAyLjI0IDIuMjkgMi45MyA0LjA0IDMuNjRhLjk0LjkzLTY3IDAgMDEuNSAxLjI1YzIuMDEgNC41MiAzIDguMjQgNi45NSAxMS45M3EuNDEuMzguOTUuMiI+PC9wYXRoPjwvc3ZnPg==',
            golf_holes: 'data:image/svg+xml;base64,PHN2ZyBkYXRhLXYtZWEyMTA3NDY9IiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBmaWxsPSIjZmZmIiB2aWV3Qm94PSIwIDAgNjQgNjQiIGNsYXNzPSJ1aS1pY29uIG1heC1oLWZ1bGwgd2Z1bGwiIHN0eWxlPSJvcGFjaXR5OiAxOyI+PHBhdGggZD0iTTI3LjcxIDUuMzZjMS40MS0uMDEgMi44MS0uMDIgNC4yMi0uMDQuMTIgMy42NC4xNyA3LjI3LjExIDEwLjkxLS4yMiAxMy4xNi4yNSAyNi4zNi0uMjYgMzkuNWwtNC4wNS0uM2MtLjA1LTE2LjY5LS4wMy0zMy4zOC0uMDItNTAuMDciPjwvcGF0aD48cGF0aCBmaWxsPSIjMDAwIiBkPSJNMjUuNzIgMy41MWM3LjczLS4wNCAxNS40NyAwIDIzLjItLjAzLS4wMSA0LjkzLjIgOS44NS0uMDIgMTQuNzctNC45My4wNC05Ljg3LjEtMTQuNzktLjA2LS40MiA4LjQ3IDAgMTYuOTUtLjA0IDI1LjQzIDMuNTUuNTcgNi44NCAyLjMxIDguOTMgNS4yOSAxLjA3IDUuMDgtMy42NyA4LjMyLTguMDUgOS4xMS01LjU5IDEuMDItMTIuMjcuNzQtMTYuNTUtMy40Ni0xLjYzLTEuNDEtMS4yMy0zLjczLTEuNDEtNS42NCAyLjA2LTIuOTQgNS4yOS00LjY1IDguNzYtNS4zNS0uMDgtMTMuMzUtLjAyLTI2LjcxLS4wMy00MC4wNm0xLjk5IDEuODVjLS4wMSAxNi42OS0uMDMgMzMuMzguMDIgNTAuMDdsNC4wNS4zYy41MS0xMy4xNC4wNC0yNi4zNC4yNi0zOS41IDUuMS4xIDEwLjAxLjEzIDE1LjAxLjEtLjAxLTMuNjctLjAxLTcuMzQuMDEtMTEuMDEtNS4wNSAwLTEwLjA5LS4wMS0xNS4xMyAwLTEuNDEuMDItMi44MS4wMy00LjIyLjA0Ij48L3BhdGg+PHBhdGggZmlsbD0iI2MwNTA1MCIgZD0iTTMxLjkzIDUuMzJjNS4wNC0uMDEgMTAuMDggMCAxNS4xMyAwLS4wMiAzLjY3LS4wMiA3LjM0LS4wMSAxMS4wMS01LjAzLTMuNjctLjAxLTcuMjctLjExLTEwLjkxIj48L3BhdGg+PC9zdmc+',
            snowmen: './src/assets/snowmen.svg',
            rc_time_trial: './src/assets/rctt.png',
            bike_time_trial: './src/assets/btt.png',
            skydives: './src/assets/skydive.png',
            gang_attacks: './src/assets/gang_attack.svg',
            // è½¦è¡Œå›¾æ ‡
            casino: './src/assets/casino.svg',
            car_meet: './src/assets/lscm.svg',
            premium_deluxe_motorsport: './src/assets/sem.svg',
            luxury_autos: './src/assets/lux.svg'
        };

        // ç‰©å“æ•°æ®ï¼ˆä»JSONæ–‡ä»¶åŠ è½½ï¼‰
        const itemData = {
            hidden_caches: [],
            shipwrecked: [],
            gun_van: [],
            dead_drop: [],
            ls_tags: [],
            street_dealers: [],
            playing_cards: [],
            smoke_on_the_water_product: [],
            action_figures: [],
            yuanbao: [],
            ld_organics_products: [],
            signal_jammers: [],
            jack_o_lanterns: [],
            payphone_hits: [],
            golf_holes: [],
            snowmen: [],
            stunt_jumps: [],
            spray: [],
            rc_time_trial: [],
            bike_time_trial: [],
            skydives: [],
            gang_attacks: []
        };

        // è½¦è¡Œä½ç½®æ•°æ®
        const dealershipData = {
            casino: {
                coordinates: [[939.1505, 26.4848]],
                name: 'èµŒåœº',
                icon: 'casino'
            },
            car_meet: {
                coordinates: [[781.25, -1868.553]],
                name: 'è½¦å‹ä¼š',
                icon: 'car_meet'
            },
            premium_deluxe_motorsport: {
                coordinates: [[-42.6786, -1097.2642]],
                name: 'è¥¿ç±³æ©',
                icon: 'premium_deluxe_motorsport'
            },
            luxury_autos: {
                coordinates: [[-788.722, -239.5369]],
                name: 'è±ªå',
                icon: 'luxury_autos'
            }
        };

        // è½¦è¡Œæ ‡è®°æ•°ç»„
        let dealershipMarkers = [];

        // æ­¦å™¨å¢å‹è½¦ä½ç½®ç¼“å­˜ï¼ˆæ¯å¤©å˜åŒ–ï¼‰
        let gunVanLocation = null;
        let gunVanLastUpdate = 0;
        
        // LSæ¶‚é¸¦ä½ç½®ç¼“å­˜ï¼ˆæ¯å¤©å˜åŒ–ï¼‰
        let lsTagsLastUpdate = 0;
        
        // éšè—åŒ…è£¹ä½ç½®ç¼“å­˜ï¼ˆæ¯å¤©å˜åŒ–ï¼‰
        let hiddenCachesLastUpdate = 0;
        
        // æ²‰èˆ¹ä½ç½®ç¼“å­˜ï¼ˆæ¯å¤©å˜åŒ–ï¼‰
        let shipwreckedLastUpdate = 0;

        // DOMå…ƒç´ 
        const styleSelect = document.getElementById('map-style-select');
        // å³ä¸Šè§’çš„ item-type-select å·²ç§»é™¤ï¼Œä¾§è¾¹æ ä½¿ç”¨é™æ€é€‰é¡¹æ•°ç»„ç”Ÿæˆå¤é€‰æ¡†
        const sidebarItemOptions = [
            { value: 'dealerships', text: 'ğŸ¦ è½¦è¡Œä½ç½®' },
            { value: 'hidden_caches', text: 'éšè—åŒ…è£¹' },
            { value: 'shipwrecked', text: 'æ²‰èˆ¹' },
            { value: 'gun_van', text: 'æ­¦å™¨å¢å‹è½¦' },
            { value: 'dead_drop', text: 'æ°æ‹‰å¾·åŒ…è£¹' },
            { value: 'ls_tags', text: 'LSæ¶‚é¸¦' },
            { value: 'street_dealers', text: 'è¡—å¤´æ¯’è´©' },
            { value: 'playing_cards', text: 'çº¸ç‰Œ' },
            { value: 'smoke_on_the_water_product', text: 'åäº‘åé›¾é¦†äº§å“' },
            { value: 'action_figures', text: 'æ‰‹åŠ' },
            { value: 'yuanbao', text: 'å…ƒå®' },
            { value: 'stunt_jumps', text: 'ç‰¹æŠ€è·³è·ƒç‚¹' },
            { value: 'spray', text: 'å–·ç½ä½ç½®' },
            { value: 'ld_organics_products', text: 'æœ‰æœºåŠäº§å“' },
            { value: 'signal_jammers', text: 'ä¿¡å·å¹²æ‰°å™¨' },
            { value: 'jack_o_lanterns', text: 'å—ç“œç¯' },
            { value: 'payphone_hits', text: 'ç”µè¯æš—æ€' },
            { value: 'golf_holes', text: 'é«˜å°”å¤«çƒæ´' },
            { value: 'snowmen', text: 'é›ªäºº' },
            { value: 'rc_time_trial', text: 'RCæ—¶é—´æŒ‘æˆ˜èµ›' },
            { value: 'bike_time_trial', text: 'è‡ªè¡Œè½¦æ—¶é—´æŒ‘æˆ˜èµ›' },
            { value: 'skydives', text: 'è·³ä¼' },
            { value: 'gang_attacks', text: 'âš”ï¸ å¸®æ´¾æ”»å‡»' }
        ];
        const loader = document.getElementById('loader');
        const tilePaneDom = document.getElementById('tile-pane');
        const fileStatus = document.getElementById('file-status');
        const itemInfo = document.getElementById('item-info');

        let currentStyle = styleSelect.value;
    let currentItemType = '';
    // æ”¯æŒåŒæ—¶æ˜¾ç¤ºå¤šä¸ªç‰©å“ç±»å‹
    let activeItemTypes = new Set();
    // å­˜å‚¨æ¯ä¸ªæ ‡è®°å¯¹è±¡ï¼š{type, index, el}
    let itemMarkers = [];

        // --- åœ°å›¾åˆå§‹åŒ– ---
        function getLevelByZoom(z) {
            return zoomLevels.find(l => l.zoom === z);
        }
        function totalSizeForZoom(z) {
            const level = getLevelByZoom(z);
            if (!level) return { width: 0, height: 0 };
            return { width: level.cols * TILE_SIZE, height: level.rows * TILE_SIZE };
        }

        const errorTileSVG = encodeURIComponent(
            `<svg xmlns="http://www.w3.org/2000/svg" width="${TILE_SIZE}" height="${TILE_SIZE}">` +
            `<rect width="100%" height="100%" fill="#1a1a1a"/></svg>`
        );
        const errorTileDataUrl = `data:image/svg+xml;charset=UTF-8,${errorTileSVG}`;

        const initialZoom = zoomLevels[0].zoom;
        const initialSize = totalSizeForZoom(initialZoom);
        const initialCenterPoint = L.point(initialSize.width / 2, initialSize.height / 2);

        const map = L.map('map-container', {
            crs: L.CRS.Simple,
            minZoom: zoomLevels[0].zoom,
            maxZoom: zoomLevels[zoomLevels.length - 1].zoom,
            zoomControl: true,
            attributionControl: false,
            preferCanvas: true
        });

        function resetViewForZoom(z, centerPixel) {
            const size = totalSizeForZoom(z);
            if (size.width === 0) return;

            // å¯¹äºå°ç¼©æ”¾çº§åˆ«3å’Œ4ï¼Œå¼ºåˆ¶ä½¿ç”¨åœ°å›¾ä¸­å¿ƒ
            let centerPoint;
            if (z === 3 || z === 4) {
                centerPoint = L.point(size.width / 2, size.height / 2);
            } else {
                centerPoint = centerPixel ? L.point(centerPixel.x, centerPixel.y) : L.point(size.width / 2, size.height / 2);
            }
            
            const centerLatLng = map.unproject(centerPoint, z);

            const southWest = map.unproject(L.point(0, size.height), z);
            const northEast = map.unproject(L.point(size.width, 0), z);
            const bounds = new L.LatLngBounds(southWest, northEast);

            map.setMaxBounds(bounds);
            
            // å¯¹äºå°ç¼©æ”¾çº§åˆ«3å’Œ4ï¼Œç¡®ä¿åœ°å›¾å®Œå…¨å±…ä¸­
            if (z === 3 || z === 4) {
                map.setView(centerLatLng, z, { animate: false });
                // å¼ºåˆ¶é‡æ–°å®šä½åˆ°ä¸­å¿ƒ
                setTimeout(() => {
                    map.panTo(centerLatLng, { animate: false });
                }, 50);
            } else {
                map.setView(centerLatLng, z, { animate: false });
            }

            tilePaneDom.style.width = size.width + 'px';
            tilePaneDom.style.height = size.height + 'px';
        }

        resetViewForZoom(initialZoom);

        // æ ¹æ®å½“å‰æ ·å¼è·å–é”™è¯¯ç“¦ç‰‡çš„çº¯è‰²èƒŒæ™¯
        function getErrorTileUrl(style) {
            // æå–æ ·å¼åç§°ï¼ˆä»URLä¸­è·å–æœ€åä¸€éƒ¨åˆ†ï¼‰
            let styleName = 'game'; // é»˜è®¤æ ·å¼
            if (style.includes('game')) {
                styleName = 'game';
            } else if (style.includes('render')) {
                styleName = 'render';
            } else if (style.includes('print')) {
                styleName = 'print';
            }
            
            // ä¸åŒåœ°å›¾æ ·å¼å¯¹åº”çš„RGBé¢œè‰²å€¼
            const colors = {
                'game': 'rgb(56, 73, 80)',
                'render': 'rgb(13, 43, 79)',
                'print': 'rgb(78, 177, 208)'
            };
            
            // è·å–å½“å‰æ ·å¼å¯¹åº”çš„é¢œè‰²ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨é»˜è®¤é¢œè‰²
            const color = colors[styleName] || '#1a1a1a';
            
            // è¿”å›çº¯è‰²èƒŒæ™¯çš„SVGæ•°æ®URL
            return 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(
                '<svg xmlns="http://www.w3.org/2000/svg" width="256" height="256">' +
                '<rect width="100%" height="100%" fill="' + color + '"/>' +
                '</svg>'
            );
        }

        const CustomTileLayer = L.TileLayer.extend({
            getTileUrl: function(coords) {
                return `${currentStyle}/${coords.z}/${coords.x}_${coords.y}.jpg`;
            }
        });

        const tileLayer = new CustomTileLayer('', {
            tileSize: TILE_SIZE,
            minZoom: zoomLevels[0].zoom,
            maxZoom: zoomLevels[zoomLevels.length - 1].zoom,
            noWrap: true,
            subdomains: [],
            errorTileUrl: getErrorTileUrl(currentStyle)
        });

        tileLayer.on('loading', () => loader.classList.add('visible'));
        tileLayer.on('load', () => loader.classList.remove('visible'));
        tileLayer.on('tileerror', (err) => {
            loader.classList.remove('visible');
        });

        tileLayer.addTo(map);

        // æ ·å¼é€‰æ‹©äº‹ä»¶
        styleSelect.addEventListener('change', (e) => {
            currentStyle = e.target.value;
            // æ›´æ–°é”™è¯¯ç“¦ç‰‡URLä»¥åŒ¹é…æ–°æ ·å¼
            tileLayer.options.errorTileUrl = getErrorTileUrl(currentStyle);
            tileLayer.redraw();
        });

        // --- ç‰©å“æ ‡è®°åŠŸèƒ½ ---
        function updateTilePanePosition() {
            const z = map.getZoom();
            const level = getLevelByZoom(z);
            if (!level) return;

            const bounds = map.getBounds();
            const topLeftLatLng = bounds.getNorthWest();
            const topLeftPoint = map.project(topLeftLatLng, z);
            
            const size = totalSizeForZoom(z);
            const containerWidth = window.innerWidth;
            const containerHeight = window.innerHeight;
            
            // ç‰¹åˆ«å¤„ç†ç¼©æ”¾çº§åˆ«3å’Œ4çš„å±…ä¸­é—®é¢˜
            let translateX = -topLeftPoint.x;
            let translateY = -topLeftPoint.y;
            
            // å¯¹äºå°ç¼©æ”¾çº§åˆ«3å’Œ4ï¼Œå¼ºåˆ¶å±…ä¸­
            if (z === 3 || z === 4) {
                if (size.width < containerWidth) {
                    translateX = (containerWidth - size.width) / 2;
                }
                if (size.height < containerHeight) {
                    translateY = (containerHeight - size.height) / 2;
                }
            } else {
                // å¯¹äºæ›´å¤§çš„ç¼©æ”¾çº§åˆ«ï¼Œä½¿ç”¨æ ‡å‡†é€»è¾‘
                if (size.width < containerWidth) {
                    const centerOffset = (containerWidth - size.width) / 2;
                    translateX += centerOffset;
                }
                if (size.height < containerHeight) {
                    const centerOffset = (containerHeight - size.height) / 2;
                    translateY += centerOffset;
                }
            }

            tilePaneDom.style.transform = `translate(${Math.round(translateX)}px, ${Math.round(translateY)}px)`;
            updateOriginMarker();
            updateItemMarkers();
        }

        function updateOriginMarker() {
            const z = map.getZoom();
            const level = getLevelByZoom(z);
            if (!level) return;
            const totalWidth = level.cols * TILE_SIZE;
            const totalHeight = level.rows * TILE_SIZE;

            const percentX = (0 - GAME_LEFT) / (GAME_RIGHT - GAME_LEFT);
            const percentY = (GAME_TOP - 0) / (GAME_TOP - GAME_BOTTOM);

            const originX = percentX * totalWidth;
            const originY = percentY * totalHeight;
            // Origin marker display removed by design. If needed later,
            // position can be computed here without creating DOM elements.
        }

        // åŠ è½½ç‰©å“æ•°æ®
        async function loadItemData() {
            try {
                const response = await fetch('./src/data/zones.json');
                const data = await response.json();
                
                // å°†æ•°æ®å¤åˆ¶åˆ°itemDataå¯¹è±¡
                Object.keys(itemData).forEach(key => {
                    if (data[key]) {
                        itemData[key] = data[key];
                    }
                });
                
                // åŠ è½½æ‰€æœ‰ç‰©å“æ•°æ®ï¼ˆä»common_collectibles.jsonï¼‰
                try {
                    const cardsResponse = await fetch('./src/data/common_collectibles.json');
                    const cardsData = await cardsResponse.json();
                    
                    // åŠ è½½playing_cardsæ•°æ®
                    if (cardsData.playing_cards) {
                        itemData.playing_cards = cardsData.playing_cards.map(card => ({
                            x: card[0],
                            y: card[1],
                            name: card[2] || 'çº¸ç‰Œä½ç½®'
                        }));
                        console.log('çº¸ç‰Œä½ç½®æ•°æ®åŠ è½½æˆåŠŸï¼Œå…±', itemData.playing_cards.length, 'ä¸ªä½ç½®');
                    }
                    
                    // åŠ è½½å…¶ä»–ç‰©å“æ•°æ®
                    const itemTypes = [
                        'smoke_on_the_water_product',
                        'action_figures', 
                        'yuanbao',
                        'ld_organics_products',
                        'signal_jammers',
                        'jack_o_lanterns',
                        'payphone_hits',
                        'golf_holes',
                        'snowmen',
                        'spray'
                    ];
                    
                    itemTypes.forEach(type => {
                        try {
                            if (cardsData[type]) {
                                // å¤„ç†action_figuresçš„ç‰¹æ®ŠåµŒå¥—ç»“æ„
                                if (type === 'action_figures' && cardsData[type].regular) {
                                    // åˆå¹¶regularå’Œlast_twoæ•°ç»„
                                    const regularItems = cardsData[type].regular || [];
                                    const lastTwoItems = cardsData[type].last_two || [];
                                    itemData[type] = [...regularItems, ...lastTwoItems].map(item => ({
                                        x: item[0],
                                        y: item[1],
                                        name: item[2] || type
                                    }));
                                } else if (Array.isArray(cardsData[type])) {
                                    // åªå¯¹æ•°ç»„ç±»å‹è°ƒç”¨mapæ–¹æ³•
                                    itemData[type] = cardsData[type].map(item => ({
                                        x: item[0],
                                        y: item[1],
                                        name: item[2] || type
                                    }));
                                } else {
                                    itemData[type] = [];
                                }
                                console.log(`${type}æ•°æ®åŠ è½½æˆåŠŸï¼Œå…±${itemData[type].length}ä¸ªä½ç½®`);
                            }
                        } catch (error) {
                            console.error(`åŠ è½½${type}æ•°æ®å¤±è´¥`);
                            itemData[type] = []; // æä¾›é»˜è®¤å€¼ï¼Œé¿å…åç»­é”™è¯¯
                        }
                    });
                    
                    // ç¡®ä¿stunt_jumpsæ•°æ®è¢«åŠ è½½
                    try {
                        if (cardsData && cardsData.stunt_jumps) {
                            // è½¬æ¢ä¸ºéœ€è¦çš„æ ¼å¼
                            itemData.stunt_jumps = cardsData.stunt_jumps.map((item, index) => ({
                                x: item[0],
                                y: item[1],
                                name: `ç‰¹æŠ€è·³è·ƒç‚¹ ${index + 1}`
                            }));
                            console.log(`stunt_jumpsæ•°æ®åŠ è½½æˆåŠŸï¼Œå…±${itemData.stunt_jumps.length}ä¸ªä½ç½®`);
                        } else {
                            console.error('åŠ è½½stunt_jumpsæ•°æ®å¤±è´¥ï¼šæœªæ‰¾åˆ°æ•°æ®');
                            itemData.stunt_jumps = [];
                        }
                    } catch (error) {
                        console.error('åŠ è½½stunt_jumpsæ•°æ®å¤±è´¥');
                        itemData.stunt_jumps = [];
                    }
                     
                    // ç¡®ä¿sprayæ•°æ®è¢«åŠ è½½
                    try {
                        if (cardsData && cardsData.spray_can) {
                            // è½¬æ¢ä¸ºéœ€è¦çš„æ ¼å¼
                            itemData.spray = cardsData.spray_can.map((item, index) => ({
                                x: item[0],
                                y: item[1],
                                name: `å–·ç½ä½ç½® ${index + 1}`
                            }));
                            console.log(`sprayæ•°æ®åŠ è½½æˆåŠŸï¼Œå…±${itemData.spray.length}ä¸ªä½ç½®`);
                        } else {
                            console.error('åŠ è½½sprayæ•°æ®å¤±è´¥ï¼šæœªæ‰¾åˆ°æ•°æ®');
                            itemData.spray = [];
                        }
                    } catch (error) {
                        console.error('åŠ è½½sprayæ•°æ®å¤±è´¥');
                        itemData.spray = [];
                    }
                    
                    // å•ç‹¬åŠ è½½dead_dropæ•°æ®ï¼ˆä»zones.jsonï¼‰
                    try {
                        // æ£€æŸ¥dataæ˜¯å¦å­˜åœ¨ä¸”åŒ…å«dead_dropæ•°æ®
                        if (data && Array.isArray(data.dead_drop)) {
                            // è½¬æ¢ä¸ºéœ€è¦çš„æ ¼å¼
                            itemData.dead_drop = data.dead_drop.map(item => ({
                                x: item.x,
                                y: item.y,
                                name: item.name || 'Dead Drop'
                            }));
                            console.log(`dead_dropæ•°æ®åŠ è½½æˆåŠŸï¼Œå…±${itemData.dead_drop.length}ä¸ªä½ç½®`);
                        } else {
                            console.error('åŠ è½½dead_dropæ•°æ®å¤±è´¥ï¼šæœªæ‰¾åˆ°æ•°æ®');
                            itemData.dead_drop = [];
                        }
                    } catch (error) {
                        console.error('åŠ è½½dead_dropæ•°æ®å¤±è´¥');
                        itemData.dead_drop = [];
                    }
                    
                } catch (cardsError) {
                    console.warn('åŠ è½½ç‰©å“ä½ç½®æ•°æ®å¤±è´¥:', cardsError);
                    console.log('å°è¯•åŠ è½½çš„URL:', './src/data/common_collectibles.json');
                }
                
                // åŠ¨æ€è®¡ç®—æ­¦å™¨å¢å‹è½¦ä½ç½®
                await updateGunVanLocation();
                
                // åŠ¨æ€è·å–è¡—å¤´æ¯’è´©ä½ç½®
                await updateStreetDealersLocation();
                
                // åŠ¨æ€è·å–LSæ¶‚é¸¦ä½ç½®
                await updateLSTagsLocation();
                
                // åŠ¨æ€è·å–éšè—åŒ…è£¹ä½ç½®
                await updateHiddenCachesLocation();
                
                // åŠ¨æ€è·å–æ²‰èˆ¹ä½ç½®
                await updateShipwreckedLocation();
                
                // åŠ¨æ€è·å–æ—¶é—´æŒ‘æˆ˜èµ›ä½ç½®
                await updateTimeTrialsLocation();
                
                // åŠ¨æ€è·å–è·³ä¼ä½ç½®
                await updateSkydivesLocation();
                
                console.log('ç‰©å“æ•°æ®åŠ è½½æˆåŠŸ');
            } catch (error) {
                console.error('åŠ è½½ç‰©å“æ•°æ®å¤±è´¥:', error);
            }
        }

        // åŠ¨æ€è·å–è¡—å¤´æ¯’è´©ä½ç½®
        async function updateStreetDealersLocation() {
            try {
                const response = await fetch('https://api-gta.antwen.com/api/items/street-dealers');
                const result = await response.json();
                
                if (result.success && result.data && result.data.coordinate) {
                    // ä½¿ç”¨APIè¿”å›çš„è¡—å¤´æ¯’è´©åæ ‡æ•°æ®
                    itemData.street_dealers = result.data.coordinate;
                    console.log('è¡—å¤´æ¯’è´©ä½ç½®è·å–æˆåŠŸ');
                } else {
                    console.warn('è¡—å¤´æ¯’è´©APIè¿”å›æ•°æ®æ ¼å¼å¼‚å¸¸ï¼Œä½¿ç”¨é™æ€æ•°æ®');
                }
            } catch (error) {
                console.warn('è·å–è¡—å¤´æ¯’è´©ä½ç½®å¤±è´¥ï¼Œä½¿ç”¨é™æ€æ•°æ®:', error);
            }
        }

        // åŠ¨æ€è·å–LSæ¶‚é¸¦ä½ç½®ï¼ˆé€šè¿‡APIè·å–å½“å¤©ä½ç½®ï¼‰
        async function updateLSTagsLocation() {
            try {
                const response = await fetch('https://api-gta.antwen.com/api/items/ls-tags');
                const result = await response.json();
                
                if (result.success && result.data && result.data.coordinate) {
                    // ä½¿ç”¨APIè¿”å›çš„LSæ¶‚é¸¦åæ ‡æ•°æ®
                    itemData.ls_tags = result.data.coordinate;
                    
                    // ä»messageå­—æ®µä¸­æå–æ¶‚é¸¦ç¼–å·å¹¶æ·»åŠ åˆ°æ¯ä¸ªtagå¯¹è±¡ä¸­
                    if (result.data.message) {
                        const message = result.data.message;
                        const tagInfoRegex = /#(\d+)\s+(\S+)/g;
                        const tagInfoMap = new Map();
                        let match;
                        
                        // æå–æ‰€æœ‰æ¶‚é¸¦ç¼–å·å’Œåç§°çš„åŒ¹é…
                        while ((match = tagInfoRegex.exec(message)) !== null) {
                            const sequenceNumber = parseInt(match[1]);
                            const locationName = match[2];
                            tagInfoMap.set(locationName, sequenceNumber);
                        }
                        
                        // å°†ç¼–å·æ·»åŠ åˆ°æ¯ä¸ªtagå¯¹è±¡ä¸­
                        itemData.ls_tags.forEach(tag => {
                            // å°è¯•åŒ¹é…tagçš„nameä¸­çš„æœ€åä¸€ä¸ªè¯ä½œä¸ºä½ç½®åç§°
                            if (tag.name) {
                                const tagNameWords = tag.name.split(' ');
                                const lastWord = tagNameWords[tagNameWords.length - 1];
                                
                                // æŸ¥æ‰¾åŒ¹é…çš„ç¼–å·
                                for (const [locationName, sequenceNumber] of tagInfoMap.entries()) {
                                    if (tag.name.includes(locationName) || locationName.includes(lastWord)) {
                                        tag.sequenceNumber = sequenceNumber;
                                        break;
                                    }
                                }
                            }
                        });
                        
                        console.log('LSæ¶‚é¸¦ç¼–å·ä¿¡æ¯æå–æˆåŠŸ', itemData.ls_tags);
                    }
                    
                    console.log('LSæ¶‚é¸¦ä½ç½®è·å–æˆåŠŸ');
                } else {
                    console.warn('LSæ¶‚é¸¦APIè¿”å›æ•°æ®æ ¼å¼å¼‚å¸¸ï¼Œä½¿ç”¨é™æ€æ•°æ®');
                }
            } catch (error) {
                console.warn('è·å–LSæ¶‚é¸¦ä½ç½®å¤±è´¥ï¼Œä½¿ç”¨é™æ€æ•°æ®:', error);
            }
        }

        // åŠ¨æ€è·å–éšè—åŒ…è£¹ä½ç½®ï¼ˆé€šè¿‡APIè·å–å½“å¤©ä½ç½®ï¼‰
        async function updateHiddenCachesLocation() {
            try {
                const response = await fetch('https://api-gta.antwen.com/api/items/hidden-caches');
                const result = await response.json();
                
                if (result.success && result.data && result.data.coordinate) {
                    // ä½¿ç”¨APIè¿”å›çš„éšè—åŒ…è£¹åæ ‡æ•°æ®
                    itemData.hidden_caches = result.data.coordinate;
                    console.log('éšè—åŒ…è£¹ä½ç½®è·å–æˆåŠŸ');
                } else {
                    console.warn('éšè—åŒ…è£¹APIè¿”å›æ•°æ®æ ¼å¼å¼‚å¸¸ï¼Œä½¿ç”¨é™æ€æ•°æ®');
                }
            } catch (error) {
                console.warn('è·å–éšè—åŒ…è£¹ä½ç½®å¤±è´¥ï¼Œä½¿ç”¨é™æ€æ•°æ®:', error);
            }
        }

        // åŠ¨æ€è·å–æ²‰èˆ¹ä½ç½®ï¼ˆé€šè¿‡APIè·å–å½“å¤©ä½ç½®ï¼‰
        async function updateShipwreckedLocation() {
            try {
                const response = await fetch('https://api-gta.antwen.com/api/items/shipwrecked');
                const result = await response.json();
                
                if (result.success && result.data && result.data.coordinate) {
                    // ä½¿ç”¨APIè¿”å›çš„æ²‰èˆ¹åæ ‡æ•°æ®
                    itemData.shipwrecked = result.data.coordinate;
                    // ä¿å­˜APIè¿”å›çš„æ¶ˆæ¯ç”¨äºæå–æ²‰èˆ¹ç¼–å·
                    itemData.shipwreckedMessage = result.data.message;
                    console.log('æ²‰èˆ¹ä½ç½®è·å–æˆåŠŸ');
                } else {
                    console.warn('æ²‰èˆ¹APIè¿”å›æ•°æ®æ ¼å¼å¼‚å¸¸ï¼Œä½¿ç”¨é™æ€æ•°æ®');
                }
            } catch (error) {
                console.warn('è·å–æ²‰èˆ¹ä½ç½®å¤±è´¥ï¼Œä½¿ç”¨é™æ€æ•°æ®:', error);
            }
        }

        // åŠ¨æ€è·å–æ—¶é—´æŒ‘æˆ˜èµ›ä½ç½®ï¼ˆé€šè¿‡APIè·å–å½“å¤©ä½ç½®ï¼‰
        async function updateTimeTrialsLocation() {
            try {
                const response = await fetch('https://api-gta.antwen.com/api/items/time-trials');
                const result = await response.json();
                
                if (result.success && result.data && result.data.coordinate) {
                    // ä½¿ç”¨APIè¿”å›çš„æ—¶é—´æŒ‘æˆ˜èµ›åæ ‡æ•°æ®
                    const { rc_time_trial, bike_time_trial } = result.data.coordinate;
                    
                    // è®¾ç½®RCæ—¶é—´æŒ‘æˆ˜èµ›æ•°æ®ï¼ˆä»…ä¸€ä¸ªä½ç½®ï¼‰
                    if (rc_time_trial) {
                        itemData.rc_time_trial = [{
                            x: rc_time_trial.x,
                            y: rc_time_trial.y,
                            name: rc_time_trial.name,
                            time: rc_time_trial.time
                        }];
                        console.log('RCæ—¶é—´æŒ‘æˆ˜èµ›ä½ç½®è·å–æˆåŠŸ');
                    } else {
                        itemData.rc_time_trial = [];
                    }
                    
                    // è®¾ç½®è‡ªè¡Œè½¦æ—¶é—´æŒ‘æˆ˜èµ›æ•°æ®ï¼ˆä»…ä¸€ä¸ªä½ç½®ï¼‰
                    if (bike_time_trial) {
                        itemData.bike_time_trial = [{
                            x: bike_time_trial.x,
                            y: bike_time_trial.y,
                            name: bike_time_trial.name,
                            time: bike_time_trial.time
                        }];
                        console.log('è‡ªè¡Œè½¦æ—¶é—´æŒ‘æˆ˜èµ›ä½ç½®è·å–æˆåŠŸ');
                    } else {
                        itemData.bike_time_trial = [];
                    }
                    
                    // ä¿å­˜APIè¿”å›çš„æ¶ˆæ¯ç”¨äºæ˜¾ç¤º
                    itemData.timeTrialsMessage = result.data.message;
                    
                } else {
                    console.warn('æ—¶é—´æŒ‘æˆ˜èµ›APIè¿”å›æ•°æ®æ ¼å¼å¼‚å¸¸ï¼Œä½¿ç”¨é™æ€æ•°æ®');
                    itemData.rc_time_trial = [];
                    itemData.bike_time_trial = [];
                }
            } catch (error) {
                console.warn('è·å–æ—¶é—´æŒ‘æˆ˜èµ›ä½ç½®å¤±è´¥ï¼Œä½¿ç”¨é™æ€æ•°æ®:', error);
                itemData.rc_time_trial = [];
                itemData.bike_time_trial = [];
            }
        }

        // åŠ¨æ€è·å–è·³ä¼ä½ç½®ï¼ˆé€šè¿‡APIè·å–å½“å¤©ä½ç½®ï¼‰
        async function updateSkydivesLocation() {
            try {
                const response = await fetch('https://api-gta.antwen.com/api/items/skydives');
                const result = await response.json();
                
                if (result.success && result.data && result.data.coordinate) {
                    // ä½¿ç”¨APIè¿”å›çš„è·³ä¼åæ ‡æ•°æ®
                    itemData.skydives = result.data.coordinate;
                    console.log('è·³ä¼ä½ç½®è·å–æˆåŠŸ');
                } else {
                    console.warn('è·³ä¼APIè¿”å›æ•°æ®æ ¼å¼å¼‚å¸¸ï¼Œä½¿ç”¨é™æ€æ•°æ®');
                    // ä½¿ç”¨zones.jsonä¸­çš„é™æ€æ•°æ®ä½œä¸ºå¤‡ç”¨
                    const zonesResponse = await fetch('./src/data/zones.json');
                    const zonesData = await zonesResponse.json();
                    if (zonesData && Array.isArray(zonesData.skydives)) {
                        itemData.skydives = zonesData.skydives;
                    } else {
                        itemData.skydives = [];
                    }
                }
            } catch (error) {
                console.warn('è·å–è·³ä¼ä½ç½®å¤±è´¥ï¼Œä½¿ç”¨é™æ€æ•°æ®:', error);
                try {
                    // ä½¿ç”¨zones.jsonä¸­çš„é™æ€æ•°æ®ä½œä¸ºå¤‡ç”¨
                    const zonesResponse = await fetch('./src/data/zones.json');
                    const zonesData = await zonesResponse.json();
                    if (zonesData && Array.isArray(zonesData.skydives)) {
                        itemData.skydives = zonesData.skydives;
                    } else {
                        itemData.skydives = [];
                    }
                } catch (fallbackError) {
                    console.error('åŠ è½½é™æ€è·³ä¼æ•°æ®ä¹Ÿå¤±è´¥:', fallbackError);
                    itemData.skydives = [];
                }
            }
        }



        // åŠ¨æ€è®¡ç®—æ­¦å™¨å¢å‹è½¦ä½ç½®
        async function updateGunVanLocation() {
            const currentDay = Math.floor(Date.now() / 86400000); // æ¯å¤©å˜åŒ–
            
            if (gunVanLastUpdate !== currentDay) {
                gunVanLastUpdate = currentDay;
                
                // æ¨¡æ‹Ÿæ¸¸æˆä¸­çš„éšæœºæ•°ç”Ÿæˆé€»è¾‘
                const seed = getSeedValue();
                const location = getRandomGunVanLocation(seed);
                
                // åªä¿ç•™å½“å¤©çš„ä½ç½®
                if (itemData.gun_van && itemData.gun_van.length > 0) {
                    itemData.gun_van = [itemData.gun_van[location]];
                }
                
                console.log(`æ­¦å™¨å¢å‹è½¦ä»Šæ—¥ä½ç½®: ${location + 1}`);
            }
        }

        // æ¨¡æ‹Ÿæ¸¸æˆä¸­çš„ç§å­å€¼è®¡ç®—
        function getSeedValue() {
            const cloudTime = BigInt(Math.floor(Date.now() / 1000));
            return (cloudTime - 21600n) / 86400n;
        }

        // æ¨¡æ‹Ÿæ¸¸æˆä¸­çš„éšæœºä½ç½®é€‰æ‹©ï¼ˆä½¿ç”¨æ­£ç¡®çš„RNGç®—æ³•ï¼‰
        function getRandomGunVanLocation(seed) {
            const DISABLED_LOCATION = 4;
            
            // ä½¿ç”¨æ¸¸æˆä¸­çš„éšæœºæ•°ç”Ÿæˆç®—æ³•
            class GameRNG {
                constructor(seed) {
                    this.mask = (2n ** 32n - 1n);
                    this.magicNumber = 1557985959n;
                    const rolval = ((seed << 16n) & this.mask) | ((seed >> 16n) & this.mask);
                    this.seed0 = seed || 1n;
                    this.seed1 = seed ^ rolval;
                }
                
                nextSeed() {
                    const next_seed = this.magicNumber * this.seed0 + this.seed1;
                    this.seed0 = next_seed & BigInt(0xFFFFFFFF);
                    this.seed1 = next_seed >> 32n;
                    return next_seed;
                }
                
                getRandomInt(min, max) {
                    if (min === max) return Number(min);
                    if (min >= max) return 0;
                    const next_seed = this.nextSeed();
                    return Number(min + (next_seed & BigInt(0x7FFFFFFF)) % (max - min + 1n));
                }
            }
            
            const rng = new GameRNG(seed);
            let location = rng.getRandomInt(0n, 29n);
            
            // è·³è¿‡ç¦ç”¨ä½ç½®
            while (location === DISABLED_LOCATION) {
                location = rng.getRandomInt(0n, 29n);
            }
            
            return location;
        }

        // åˆ›å»ºç‰©å“æ ‡è®°
        function createItemMarker(item, index, type) {
            // åˆ›å»ºæ ‡è®°å…ƒç´ 
            const marker = document.createElement('div');
            marker.className = 'item-marker';
            marker.dataset.index = index;
            marker.dataset.type = type;
            
            // ç‰¹æ®Šå¤„ç†å¸®æ´¾æ”»å‡» - åˆ›å»ºçº¢è‰²åœ†åœˆ
            if (type === 'gang_attacks') {
                // æ£€æŸ¥æ—¶é—´æ˜¯å¦åŒ¹é…
                if (!isGangAttackActive(item.time)) {
                    return null; // ä¸åœ¨æ—¶é—´èŒƒå›´å†…ï¼Œä¸æ˜¾ç¤º
                }
                
                // è·å–å½“å‰ç¼©æ”¾ç­‰çº§æ¥è®¡ç®—åœ†åœˆå¤§å°
                const z = map.getZoom();
                const level = getLevelByZoom(z);
                if (!level) return null;
                
                const totalWidth = level.cols * TILE_SIZE;
                const totalHeight = level.rows * TILE_SIZE;
                
                // è®¡ç®—æ¸¸æˆåæ ‡100å•ä½å¯¹åº”çš„åƒç´ å¤§å°
                const gameRadius = 100; // æ¸¸æˆåæ ‡åŠå¾„
                const gameWidth = GAME_RIGHT - GAME_LEFT; // 9000
                const pixelRadius = (gameRadius / gameWidth) * totalWidth;
                const circleSize = pixelRadius * 2; // ç›´å¾„
                
                console.log('å¸®æ´¾æ”»å‡»åœ†åœˆå¤§å°è®¡ç®—:', {
                    gameRadius,
                    gameWidth,
                    totalWidth,
                    pixelRadius,
                    circleSize
                });
                
                // åˆ›å»ºçº¢è‰²åœ†åœˆ
                marker.style.width = `${circleSize}px`;
                marker.style.height = `${circleSize}px`;
                marker.style.borderRadius = '50%';
                marker.style.border = '3px solid #ff0000';
                marker.style.backgroundColor = 'rgba(255, 0, 0, 0.1)';
                marker.style.position = 'absolute';
                marker.style.transform = 'translate(-50%, -50%)';
                marker.style.cursor = 'pointer';
                marker.style.pointerEvents = 'all';
                
                // æ·»åŠ ä¸­å¿ƒå›¾æ ‡
                const img = document.createElement('img');
                img.src = itemIcons[type];
                img.style.width = '32px';
                img.style.height = '32px';
                img.style.position = 'absolute';
                img.style.top = '50%';
                img.style.left = '50%';
                img.style.transform = 'translate(-50%, -50%)';
                marker.appendChild(img);
            } else {
                // æ™®é€šæ ‡è®°å¤„ç†
                const img = document.createElement('img');
                img.src = itemIcons[type];
                img.style.width = '32px';
                img.style.height = '32px';
                marker.appendChild(img);
            }
            
            // æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼šä½¿ç”¨æ ‡è®°è‡ªèº«çš„ type/index
            L.DomEvent.on(marker, 'click', function(e) {
                const t = marker.dataset.type;
                const idx = parseInt(marker.dataset.index, 10);
                const it = (itemData[t] && itemData[t][idx]) ? itemData[t][idx] : item;
                if (!it) return;
                // å§”æ‰˜ç»™ showItemInfo å¤„ç†å›¾ç‰‡/å¤§å¼¹çª—é€»è¾‘
                showItemInfo(it, t, idx);
            });
            
            return marker;
        }

        // æ›´æ–°ç‰©å“æ ‡è®°ä½ç½®
        function updateItemMarkers() {
            const z = map.getZoom();
            const level = getLevelByZoom(z);
            if (!level) return;

            const totalWidth = level.cols * TILE_SIZE;
            const totalHeight = level.rows * TILE_SIZE;

            // æ¸…é™¤ç°æœ‰ DOM æ ‡è®°
            itemMarkers.forEach(m => m.el.remove());
            itemMarkers = [];

            // ä¸ºæ¯ä¸ªæ¿€æ´»çš„ç±»å‹åˆ›å»ºæ ‡è®°
            activeItemTypes.forEach(type => {
                if (!itemData[type] || !Array.isArray(itemData[type])) return;
                itemData[type].forEach((item, index) => {
                    if (typeof item.x === 'undefined' || typeof item.y === 'undefined') return;

                    const percentX = (item.x - GAME_LEFT) / (GAME_RIGHT - GAME_LEFT);
                    const percentY = (GAME_TOP - item.y) / (GAME_TOP - GAME_BOTTOM);

                    const itemX = percentX * totalWidth;
                    const itemY = percentY * totalHeight;

                    const markerEl = createItemMarker(item, index, type);
                    if (markerEl) { // æ£€æŸ¥æ˜¯å¦åˆ›å»ºæˆåŠŸï¼ˆå¸®æ´¾æ”»å‡»å¯èƒ½è¿”å›nullï¼‰
                        markerEl.style.left = `${itemX}px`;
                        markerEl.style.top = `${itemY}px`;
                        tilePaneDom.appendChild(markerEl);
                        itemMarkers.push({ type, index, el: markerEl });
                    }
                });
            });
        }

        // ä¿®å¤åœ°å›¾æ‹–åŠ¨æ—¶å›¾æ ‡ä¸è·Ÿéšçš„é—®é¢˜
        function updateTilePanePosition() {
            const z = map.getZoom();
            const level = getLevelByZoom(z);
            if (!level) return;

            const bounds = map.getBounds();
            const topLeftLatLng = bounds.getNorthWest();
            const topLeftPoint = map.project(topLeftLatLng, z);

            tilePaneDom.style.transform = `translate(${-topLeftPoint.x}px, ${-topLeftPoint.y}px)`;
            updateOriginMarker();
            updateItemMarkersPosition(); // æ›´æ–°æ ‡è®°ä½ç½®è€Œä¸æ˜¯é‡æ–°åˆ›å»º
            updateDealershipMarkers(); // æ›´æ–°è½¦è¡Œæ ‡è®°ä½ç½®
        }

        // æ›´æ–°ç‰©å“æ ‡è®°ä½ç½®ï¼ˆä¸é‡æ–°åˆ›å»ºï¼‰
        function updateItemMarkersPosition() {
            const z = map.getZoom();
            const level = getLevelByZoom(z);
            if (!level) return;

            const totalWidth = level.cols * TILE_SIZE;
            const totalHeight = level.rows * TILE_SIZE;

            // æ›´æ–°ç°æœ‰æ ‡è®°ä½ç½®
            itemMarkers.forEach(({ type, index, el }) => {
                const item = itemData[type] && itemData[type][index];
                if (!item || typeof item.x === 'undefined' || typeof item.y === 'undefined') return;

                const percentX = (item.x - GAME_LEFT) / (GAME_RIGHT - GAME_LEFT);
                const percentY = (GAME_TOP - item.y) / (GAME_TOP - GAME_BOTTOM);

                const itemX = percentX * totalWidth;
                const itemY = percentY * totalHeight;

                el.style.left = `${itemX}px`;
                el.style.top = `${itemY}px`;
                
                // ç‰¹æ®Šå¤„ç†å¸®æ´¾æ”»å‡»åœ†åœˆå¤§å°æ›´æ–°
                if (type === 'gang_attacks') {
                    // è®¡ç®—æ¸¸æˆåæ ‡100å•ä½å¯¹åº”çš„åƒç´ å¤§å°
                    const gameRadius = 100; // æ¸¸æˆåæ ‡åŠå¾„
                    const gameWidth = GAME_RIGHT - GAME_LEFT; // 9000
                    const pixelRadius = (gameRadius / gameWidth) * totalWidth;
                    const circleSize = pixelRadius * 2; // ç›´å¾„
                    
                    el.style.width = `${circleSize}px`;
                    el.style.height = `${circleSize}px`;
                }
            });
        }

        // === è½¦è¡Œæ ‡è®°åŠŸèƒ½ ===
        
        // åˆå§‹åŒ–è½¦è¡Œæ ‡è®°
        function initDealershipMarkers() {
            createDealershipMarkers();
            console.log('è½¦è¡Œæ ‡è®°åˆå§‹åŒ–å®Œæˆ');
        }
        
        // åˆ›å»ºè½¦è¡Œæ ‡è®°
        function createDealershipMarkers() {
            Object.keys(dealershipData).forEach(dealershipType => {
                const dealership = dealershipData[dealershipType];
                dealership.coordinates.forEach((coord, index) => {
                    const marker = createDealershipMarker(coord[0], coord[1], dealership, dealershipType);
                    dealershipMarkers.push(marker);
                    tilePaneDom.appendChild(marker);
                    // è®¾ç½®åˆå§‹å¯è§æ€§ï¼Œé˜²æ­¢åˆ›å»ºåéœ€ç¼©æ”¾æ‰æ˜¾ç¤º
                    try {
                        marker.style.display = activeItemTypes && activeItemTypes.has && activeItemTypes.has('dealerships') ? 'block' : 'none';
                    } catch (e) {
                        marker.style.display = 'block';
                    }
                });
            });
            updateDealershipMarkers();
        }
        
        // åˆ›å»ºå•ä¸ªè½¦è¡Œæ ‡è®°
        function createDealershipMarker(x, y, dealership, dealershipType) {
            const marker = document.createElement('div');
            marker.className = 'dealership-marker';
            marker.dataset.dealershipType = dealershipType;
            marker.style.cssText = `
                position: absolute;
                transform: translate(-50%, -50%);
                z-index: 680;
                cursor: pointer;
                transition: transform 0.2s ease;
            `;
            
            const img = document.createElement('img');
            img.src = itemIcons[dealership.icon];
            img.style.cssText = `
                width: 40px;
                height: 40px;
                filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
                
            `;
            
            marker.appendChild(img);
            
            // æ·»åŠ æ‚¬åœæ•ˆæœ
            marker.addEventListener('mouseenter', () => {
                marker.style.transform = 'translate(-50%, -50%) scale(1.2)';
            });
            
            marker.addEventListener('mouseleave', () => {
                marker.style.transform = 'translate(-50%, -50%) scale(1)';
            });
            
            // æ·»åŠ ç‚¹å‡»äº‹ä»¶
            marker.addEventListener('click', (e) => {
                e.stopPropagation();
                console.log('dealership marker clicked:', dealershipType, dealership.name);
                showDealershipVehicles(dealershipType, dealership.name);
            });
            
            return marker;
        }
        
        // æ›´æ–°è½¦è¡Œæ ‡è®°ä½ç½®
        function updateDealershipMarkers() {
            const z = map.getZoom();
            let level = getLevelByZoom(z);
            // å¦‚æœæ²¡æœ‰ç²¾ç¡®åŒ¹é…çš„ç¼©æ”¾çº§åˆ«ï¼Œé€‰å–æœ€è¿‘çš„ä¸€ä¸ªï¼Œé¿å…åœ¨å°æ•°ç¼©æ”¾æ—¶æ— æ³•æ›´æ–°æ ‡è®°ä½ç½®
            if (!level) {
                if (typeof zoomLevels !== 'undefined' && Array.isArray(zoomLevels) && zoomLevels.length > 0) {
                    level = zoomLevels.reduce((best, cur) => Math.abs(cur.zoom - z) < Math.abs(best.zoom - z) ? cur : best, zoomLevels[0]);
                } else {
                    return;
                }
            }
            
            const totalWidth = level.cols * TILE_SIZE;
            const totalHeight = level.rows * TILE_SIZE;
            
            let markerIndex = 0;
            Object.keys(dealershipData).forEach(dealershipType => {
                const dealership = dealershipData[dealershipType];
                dealership.coordinates.forEach((coord) => {
                    if (markerIndex < dealershipMarkers.length) {
                        const marker = dealershipMarkers[markerIndex];
                        
                        const percentX = (coord[0] - GAME_LEFT) / (GAME_RIGHT - GAME_LEFT);
                        const percentY = (GAME_TOP - coord[1]) / (GAME_TOP - GAME_BOTTOM);
                        
                        const markerX = percentX * totalWidth;
                        const markerY = percentY * totalHeight;
                        
                        marker.style.left = `${markerX}px`;
                        marker.style.top = `${markerY}px`;
                        // æ ¹æ®ä¾§è¾¹æ é€‰æ‹©æ˜¾ç¤ºæˆ–éšè—è½¦è¡Œæ ‡è®°
                        try {
                            marker.style.display = activeItemTypes && activeItemTypes.has && activeItemTypes.has('dealerships') ? 'block' : 'none';
                        } catch (e) {
                            // å¦‚æœ activeItemTypes æœªå®šä¹‰ï¼Œé»˜è®¤æ˜¾ç¤º
                            marker.style.display = 'block';
                        }

                        markerIndex++;
                    }
                });
            });
        }
        
        // æ˜¾ç¤ºè½¦è¡Œè½¦è¾†ä¿¡æ¯
        async function showDealershipVehicles(dealershipType, dealershipName) {
            try {
                let apiEndpoint = '';
                let vehicleTypes = [];
                
                // æ ¹æ®è½¦è¡Œç±»å‹ç¡®å®š API ç«¯ç‚¹å’Œè½¦è¾†ç±»å‹
                switch(dealershipType) {
                    case 'casino':
                        apiEndpoint = 'https://api-gta.antwen.com/api/dealerships/casino-prize';
                        vehicleTypes = ['èµŒåœºå¥–å“è½½å…·'];
                        break;
                    case 'car_meet':
                        // è½¦å‹ä¼šåŒ…å«å¤šç§è½¦è¾†ç±»å‹
                        await showCarMeetVehicles(dealershipName);
                        return;
                    case 'premium_deluxe_motorsport':
                        // è¥¿ç±³æ©ä½¿ç”¨å¤šè½¦è¾†API
                        await showSimeonVehicles(dealershipName);
                        return;
                    case 'luxury_autos':
                        // è±ªåè½¦è¡Œä½¿ç”¨å¤šè½¦è¾†API
                        await showLuxuryVehicles(dealershipName);
                        return;
                    default:
                        console.error('æœªçŸ¥çš„è½¦è¡Œç±»å‹:', dealershipType);
                        return;
                }
                
                // è·å–å•ä¸ªè½¦è¡Œçš„è½¦è¾†ä¿¡æ¯ï¼ˆä»…èµŒåœºï¼‰
                const response = await fetch(apiEndpoint);
                const result = await response.json();
                
                if (result.success && result.data && result.data.vehicle) {
                    showVehiclePopup([result.data.vehicle], dealershipName, vehicleTypes[0]);
                } else {
                    console.error('è·å–è½¦è¾†ä¿¡æ¯å¤±è´¥:', result.error);
                    alert('è·å–è½¦è¾†ä¿¡æ¯å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                }
            } catch (error) {
                console.error('APIè¯·æ±‚é”™è¯¯:', error);
                alert('ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            }
        }
        
        // æ˜¾ç¤ºè½¦å‹ä¼šè½¦è¾†ï¼ˆåŒ…å«å¤šç§ç±»å‹ï¼‰
        async function showCarMeetVehicles(dealershipName) {
            try {
                const endpoints = [
                    { url: 'https://api-gta.antwen.com/api/dealerships/car-meet-prize', name: 'è½¦å‹ä¼šå¥–å“è½½å…·' },
                    { url: 'https://api-gta.antwen.com/api/dealerships/promo-test', name: 'æµ‹è¯•è½½å…·' },
                    { url: 'https://api-gta.antwen.com/api/dealerships/hsw-test', name: 'HSWè½½å…·' }
                ];
                
                const vehicles = [];
                const vehicleTypes = [];
                
                for (const endpoint of endpoints) {
                    try {
                        const response = await fetch(endpoint.url);
                        const result = await response.json();
                        
                        if (result.success && result.data) {
                            if (result.data.vehicle) {
                                // å•ä¸ªè½¦è¾†
                                vehicles.push(result.data.vehicle);
                                vehicleTypes.push(endpoint.name);
                            } else if (result.data.vehicles && Array.isArray(result.data.vehicles)) {
                                // å¤šä¸ªè½¦è¾†
                                result.data.vehicles.forEach(vehicle => {
                                    vehicles.push(vehicle);
                                    vehicleTypes.push(endpoint.name);
                                });
                            }
                        }
                    } catch (error) {
                        console.warn(`è·å–${endpoint.name}å¤±è´¥:`, error);
                    }
                }
                
                if (vehicles.length > 0) {
                    showVehiclePopup(vehicles, dealershipName, vehicleTypes);
                } else {
                    alert('æ²¡æœ‰è·å–åˆ°ä»»ä½•è½¦è¾†ä¿¡æ¯');
                }
            } catch (error) {
                console.error('è·å–è½¦å‹ä¼šè½¦è¾†ä¿¡æ¯å¤±è´¥:', error);
                alert('ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            }
        }
        
        // æ˜¾ç¤ºè¥¿ç±³æ©è½¦è¾†
        async function showSimeonVehicles(dealershipName) {
            try {
                const response = await fetch('https://api-gta.antwen.com/api/dealerships/simeon-test');
                const result = await response.json();
                
                if (result.success && result.data && result.data.vehicles) {
                    showVehiclePopup(result.data.vehicles, dealershipName, 'è¥¿ç±³æ©æµ‹è¯•è½½å…·');
                } else {
                    console.error('è·å–è¥¿ç±³æ©è½¦è¾†ä¿¡æ¯å¤±è´¥:', result.error);
                    alert('è·å–è½¦è¾†ä¿¡æ¯å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                }
            } catch (error) {
                console.error('è·å–è¥¿ç±³æ©è½¦è¾†ä¿¡æ¯å¤±è´¥:', error);
                alert('ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            }
        }
        
        // æ˜¾ç¤ºè±ªåè½¦è¾†
        async function showLuxuryVehicles(dealershipName) {
            try {
                const response = await fetch('https://api-gta.antwen.com/api/dealerships/luxury-showcase');
                const result = await response.json();
                
                if (result.success && result.data && result.data.vehicles) {
                    showVehiclePopup(result.data.vehicles, dealershipName, 'è±ªåè½¦å±•å…');
                } else {
                    console.error('è·å–è±ªåè½¦è¾†ä¿¡æ¯å¤±è´¥:', result.error);
                    alert('è·å–è½¦è¾†ä¿¡æ¯å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                }
            } catch (error) {
                console.error('è·å–è±ªåè½¦è¾†ä¿¡æ¯å¤±è´¥:', error);
                alert('ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            }
        }
        
        // æ˜¾ç¤ºè½¦è¾†å¼¹çª—
        function showVehiclePopup(vehicles, dealershipName, vehicleTypes) {
            const popup = document.createElement('div');
            popup.className = 'vehicle-popup';
            popup.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                border: 3px solid #FFD700;
                border-radius: 15px;
                padding: 25px;
                z-index: 10000;
                max-width: 800px;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 10px 40px rgba(0,0,0,0.3);
                font-family: Arial, sans-serif;
                text-align: center;
            `;
            
            let popupContent = `
                <div style="margin-bottom: 20px; font-size: 24px; font-weight: bold; color: #333; border-bottom: 2px solid #FFD700; padding-bottom: 10px;">
                    ğŸ¦ ${dealershipName}è½¦è¡Œ
                </div>
            `;
            
            vehicles.forEach((vehicle, index) => {
                const vehicleType = Array.isArray(vehicleTypes) ? vehicleTypes[index] : vehicleTypes;
                const imageUrl = vehicle.img ? `https://eo-gta-images.antwen.com/${vehicle.img.replace(/^\/+/, '')}` : '';
                const detailUrl = vehicle.modelHash ? `/vehicles#/vehicle/${vehicle.modelHash.toLowerCase()}` : '';
                
                // å¤„ç†æ¶‚è£…ä»·æ ¼æ˜¾ç¤º
                let liveryPriceDisplay = '';
                if (vehicle.liveryPrice === 'free') {
                    liveryPriceDisplay = '<span style="color: #e91e63; font-weight: bold;">âœ¨ éšè—æ¶‚è£…</span>';
                } else if (vehicle.liveryPrice) {
                    liveryPriceDisplay = `<span style="color: #4caf50; font-weight: bold;">æ¶‚è£…ä»·æ ¼: ${vehicle.liveryPrice}</span>`;
                }
                
                popupContent += `
                    <div style="margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 10px; border-left: 4px solid #FFD700;">
                        <div style="font-weight: bold; color: #333; margin-bottom: 10px; font-size: 18px;">
                            ğŸš— ${vehicleType}
                        </div>
                        <div style="color: #333; font-size: 20px; font-weight: bold; margin-bottom: 15px;">
                            ${vehicle.name || 'æœªçŸ¥è½¦è¾†'}
                        </div>
                        ${imageUrl ? `
                            <img src="${imageUrl}" 
                                 alt="${vehicle.name}" 
                                 style="max-width: 100%; max-height: 300px; border-radius: 8px; margin-bottom: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                        ` : ''}
                        <div style="margin: 10px 0; display: flex; justify-content: space-around; flex-wrap: wrap; gap: 10px;">
                            <div style="background: white; padding: 8px 12px; border-radius: 6px; border: 1px solid #ddd;">
                                <strong>è½¦ç±»:</strong> ${vehicle.class || 'æœªçŸ¥'}
                            </div>
                            <div style="background: white; padding: 8px 12px; border-radius: 6px; border: 1px solid #ddd;">
                                <strong>ä»·æ ¼:</strong> ${vehicle.price || 'æœªçŸ¥'}
                            </div>
                            <div style="background: white; padding: 8px 12px; border-radius: 6px; border: 1px solid #ddd;">
                                <strong>çŠ¶æ€:</strong> ${vehicle.isPurchaseable ? 'å¯è´­ä¹°' : 'ä¸å¯è´­ä¹°'}
                            </div>
                        </div>
                        ${vehicle.liveryName ? `
                            <div style="margin: 10px 0; padding: 10px; background: white; border-radius: 6px; border: 1px solid #ddd;">
                                <strong>æ¶‚è£…:</strong> ${vehicle.liveryName}<br>
                                ${liveryPriceDisplay}
                            </div>
                        ` : ''}
                        ${detailUrl ? `
                            <a href="${detailUrl}" target="_blank" 
                               style="display: inline-block; margin-top: 10px; padding: 10px 20px; 
                                      background: #2196F3; color: white; text-decoration: none; 
                                      border-radius: 6px; font-weight: bold; transition: background 0.3s;"
                               onmouseover="this.style.background='#1976D2'" 
                               onmouseout="this.style.background='#2196F3'">
                                ğŸ” è½¦è¾†è¯¦ç»†ä¿¡æ¯
                            </a>
                        ` : ''}
                    </div>
                `;
            });
            
            popupContent += `
                <div style="margin-top: 20px; display: flex; justify-content: center; gap: 10px;">
                    <button id="close-vehicle-popup" 
                            style="padding: 12px 24px; 
                                   background: #f44336; color: white; 
                                   border: none; border-radius: 6px; 
                                   cursor: pointer; font-size: 16px;
                                   font-weight: bold; transition: background 0.3s;">
                        å…³é—­
                    </button>
                </div>
            `;
            
            popup.innerHTML = popupContent;
            
            // æ·»åŠ å…³é—­æŒ‰é’®äº‹ä»¶ç›‘å¬
            popup.querySelector('#close-vehicle-popup').addEventListener('click', () => {
                popup.remove();
            });
            
            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(popup);
            
            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
            popup.addEventListener('click', (e) => e.stopPropagation());
            
            // ä½¿ç”¨setTimeoutå»¶è¿Ÿæ·»åŠ documentç‚¹å‡»äº‹ä»¶ï¼Œé¿å…ç«‹å³è§¦å‘
            setTimeout(() => {
                const closePopupHandler = (e) => {
                    if (!popup.contains(e.target)) {
                        popup.remove();
                        document.removeEventListener('click', closePopupHandler);
                    }
                };
                document.addEventListener('click', closePopupHandler);
            }, 100);
        }

        // æ£€æŸ¥ç‰¹æŠ€è·³è·ƒç‚¹ç‚¹å‡»äº‹ä»¶ï¼ˆç”¨äºæ ‡è®°å…ƒç´ ç›´æ¥ç‚¹å‡»ï¼‰
        function checkStuntJumpsClick(e) {
            // è·å–æ ‡è®°å…ƒç´ 
            const marker = e.target.closest('.item-marker');
            if (!marker) return;
            
            // è·å–ç´¢å¼•
            const index = parseInt(marker.dataset.index);
            
            // æ˜¾ç¤ºç‰©å“ä¿¡æ¯
            if (itemData.stunt_jumps && itemData.stunt_jumps[index]) {
                showItemInfo(itemData.stunt_jumps[index], 'stunt_jumps', index);
                
                // æ˜¾ç¤ºç‰¹æŠ€è·³è·ƒç‚¹å›¾ç‰‡å¼¹çª—
                showStuntJumpsImage(index);
            }
        }

        // æ˜¾ç¤ºç‰©å“ä¿¡æ¯
        function showItemInfo(item, type, index) {
            const titleMap = {
                stunt_jumps: 'ç‰¹æŠ€è·³è·ƒç‚¹',
                hidden_caches: 'éšè—åŒ…è£¹',
                shipwrecked: 'æ²‰èˆ¹',
                gun_van: 'æ­¦å™¨å¢å‹è½¦',
                ls_tags: 'LSæ¶‚é¸¦',
                spray: 'å–·ç½ä½ç½®',
                street_dealers: 'è¡—å¤´æ¯’è´©',
                playing_cards: 'çº¸ç‰Œ',
                smoke_on_the_water_product: 'åäº‘åé›¾é¦†äº§å“',
                action_figures: 'æ‰‹åŠ',
                yuanbao: 'å…ƒå®',
                ld_organics_products: 'æœ‰æœºåŠäº§å“',
                signal_jammers: 'ä¿¡å·å¹²æ‰°å™¨',
                jack_o_lanterns: 'å—ç“œç¯',
                payphone_hits: 'ç”µè¯æš—æ€',
                golf_holes: 'é«˜å°”å¤«çƒæ´',
                snowmen: 'é›ªäºº',
                rc_time_trial: 'RCæ—¶é—´æŒ‘æˆ˜èµ›',
                bike_time_trial: 'è‡ªè¡Œè½¦æ—¶é—´æŒ‘æˆ˜èµ›',
                skydives: 'è·³ä¼',
                gang_attacks: 'å¸®æ´¾æ”»å‡»'
            };


            // å¦‚æœæ²¡æœ‰æœ‰æ•ˆ itemï¼Œåˆ™ä¸æ˜¾ç¤ºå°ä¿¡æ¯é¢æ¿
            if (!item) {
                itemInfo.style.display = 'none';
                return;
            }

            // å¡«å……å°é¢æ¿æ–‡æœ¬å†…å®¹
            const title = titleMap[type] || type;
            const coords = (typeof item.x !== 'undefined' && typeof item.y !== 'undefined') ? `${item.x}, ${item.y}` : (item.coords ? String(item.coords) : 'æœªçŸ¥');
            const location = item.name || (typeof index !== 'undefined' ? `#${index}` : 'æœªçŸ¥');
            const details = item.info || item.details || item.description || 'æ— ';

            const titleEl = document.getElementById('item-title');
            const coordsEl = document.getElementById('item-coords');
            const locationEl = document.getElementById('item-location');
            const detailsEl = document.getElementById('item-details');

            if (titleEl) titleEl.textContent = title;
            if (coordsEl) coordsEl.textContent = `åæ ‡: ${coords}`;
            if (locationEl) locationEl.textContent = `ä½ç½®: ${location}`;
            if (detailsEl) detailsEl.textContent = `è¯¦ç»†ä¿¡æ¯: ${details}`;

            // å¯¹äºä¼šæ˜¾ç¤ºå¤§å¼¹çª—/å›¾ç‰‡çš„ç±»å‹ï¼Œä¸æ˜¾ç¤ºå°æ–‡æœ¬é¢æ¿ï¼Œé¿å…é‡å¤
            const imageTypes = new Set([
                'ld_organics_products',
                'signal_jammers',
                'playing_cards',
                'smoke_on_the_water_product',
                'action_figures',
                'yuanbao',
                'shipwrecked',
                'payphone_hits',
                'golf_holes',
                'snowmen',
                'dead_drop',
                'stunt_jumps',
                'spray',
                'gang_attacks'
            ]);

            if (!imageTypes.has(type)) {
                itemInfo.style.display = 'block';
            } else {
                // ç¡®ä¿éšè—å°é¢æ¿ï¼ˆå¤§å¼¹çª—ä¼šåŒæ—¶æ˜¾ç¤ºï¼‰
                itemInfo.style.display = 'none';
            }

            // å¦‚æœæ˜¯æœ‰æœºåŠäº§å“ï¼Œæ˜¾ç¤ºå›¾ç‰‡å¼¹çª—
            if (type === 'ld_organics_products') {
                showOrganicFarmImage(index);
            }
            
            // å¦‚æœæ˜¯ä¿¡å·å¹²æ‰°å™¨ï¼Œæ˜¾ç¤ºå›¾ç‰‡å¼¹çª—
            if (type === 'signal_jammers') {
                showSignalJammerImage(index);
            }
            
            // å¦‚æœæ˜¯çº¸ç‰Œï¼Œæ˜¾ç¤ºå›¾ç‰‡å¼¹çª—
            if (type === 'playing_cards') {
                showPlayingCardsImage(index);
            }
            
            // å¦‚æœæ˜¯åäº‘åé›¾é¦†äº§å“ï¼Œæ˜¾ç¤ºå›¾ç‰‡å¼¹çª—
            if (type === 'smoke_on_the_water_product') {
                showSmokeProductImage(index);
            }
            
            // å¦‚æœæ˜¯æ‰‹åŠï¼Œæ˜¾ç¤ºå›¾ç‰‡å¼¹çª—
            if (type === 'action_figures') {
                showActionFiguresImage(index);
            }
            
            // å¦‚æœæ˜¯å…ƒå®ï¼Œæ˜¾ç¤ºå›¾ç‰‡å¼¹çª—
            if (type === 'yuanbao') {
                showYuanbaoImage(index);
            }
            
            // å¦‚æœæ˜¯æ²‰èˆ¹ï¼Œæ˜¾ç¤ºå›¾ç‰‡å¼¹çª—
            if (type === 'shipwrecked') {
                showShipwrecksImage(index);
            }
            
            // å¦‚æœæ˜¯ç”µè¯æš—æ€ï¼Œæ˜¾ç¤ºå›¾ç‰‡å¼¹çª—
            if (type === 'payphone_hits') {
                showPayphoneHitsImage(index);
            }
            
            // å¦‚æœæ˜¯é«˜å°”å¤«çƒæ´ï¼Œæ˜¾ç¤ºå›¾ç‰‡å¼¹çª—
            if (type === 'golf_holes') {
                showGolfHolesImage(index);
            }
            
            // å¦‚æœæ˜¯é›ªäººï¼Œæ˜¾ç¤ºå›¾ç‰‡å¼¹çª—
            if (type === 'snowmen') {
                showSnowmenImage(index);
            }
            
            // å¦‚æœæ˜¯æ°æ‹‰å¾·åŒ…è£¹ï¼Œæ˜¾ç¤ºå›¾ç‰‡å¼¹çª—
            if (type === 'dead_drop') {
                showDeadDropImage(index);
            }
            
            // å¦‚æœæ˜¯å¸®æ´¾æ”»å‡»ï¼Œæ˜¾ç¤ºå¼¹çª—
            if (type === 'gang_attacks') {
                showGangAttackPopup(item, index);
            }
        }

        function hideItemInfo() {
            itemInfo.style.display = 'none';
        }

        // æ˜¾ç¤ºRCæ—¶é—´æŒ‘æˆ˜èµ›å¼¹çª—
        function showRCTimeTrialPopup(item, index) {
            // åˆ›å»ºå¼¹çª—
            const popup = document.createElement('div');
            popup.className = 'rc-time-trial-popup';
            popup.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                border: 3px solid #FF5722;
                border-radius: 12px;
                padding: 20px;
                z-index: 10000;
                max-width: 400px;
                max-height: 80vh;
                box-shadow: 0 8px 32px rgba(0,0,0,0.3);
                font-family: Arial, sans-serif;
                text-align: center;
            `;

            // å¼¹çª—å†…å®¹
            popup.innerHTML = `
                <div style="margin-bottom: 20px; font-size: 24px; font-weight: bold; color: #FF5722;">
                    ğŸ RCæ—¶é—´æŒ‘æˆ˜èµ›
                </div>
                <div style="margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #FF5722;">
                    <div style="font-weight: bold; color: #FF5722; margin-bottom: 8px; font-size: 16px;">ğŸ—ºï¸ åœ°ç‚¹</div>
                    <div style="color: #333; font-size: 18px; margin-bottom: 15px;">${item.name || 'æœªçŸ¥åœ°ç‚¹'}</div>
                    
                    <div style="font-weight: bold; color: #FF5722; margin-bottom: 8px; font-size: 16px;">â±ï¸ æ—¶é—´è¦æ±‚</div>
                    <div style="color: #333; font-size: 20px; font-weight: bold; background: #fff3e0; padding: 8px; border-radius: 4px;">${item.time || 'æœªçŸ¥æ—¶é—´'}</div>
                </div>
                
                <div style="margin: 15px 0; padding: 12px; background: #fff3e0; border-radius: 6px; color: #e65100; font-size: 14px; line-height: 1.4;">
                    ğŸ† æŒ‘æˆ˜æç¤ºï¼šä½¿ç”¨RCè½¦åœ¨é™å®šæ—¶é—´å†…å®Œæˆèµ›é“ï¼
                </div>
                
                <button id="close-rc-popup-btn" 
                        style="padding: 12px 24px; 
                               background: #FF5722; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;
                               font-weight: bold;
                               transition: background-color 0.3s;
                               margin-right: 10px;">
                    å…³é—­
                </button>
                <button id="hide-rc-marker-btn" 
                        style="padding: 12px 24px; 
                               background: #666; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;
                               transition: background-color 0.3s;">
                    éšè—æ ‡è®°
                </button>
            `;

            // æ·»åŠ å…³é—­æŒ‰é’®äº‹ä»¶ç›‘å¬
            const closeBtn = popup.querySelector('#close-rc-popup-btn');
            closeBtn.addEventListener('click', () => {
                popup.remove();
            });

            // æ·»åŠ éšè—æŒ‰é’®äº‹ä»¶ç›‘å¬
            const hideBtn = popup.querySelector('#hide-rc-marker-btn');
            hideBtn.addEventListener('click', () => {
                // æ‰¾åˆ°å¯¹åº”çš„RCæ ‡è®°å¹¶è®¾ç½®é€æ˜åº¦ä¸º25%
                const rcMarkers = document.querySelectorAll('.item-marker');
                rcMarkers.forEach(marker => {
                    const img = marker.querySelector('img');
                    if (img && img.src && img.src.includes('rctt.png') && marker.dataset.index == index) {
                        marker.style.opacity = '0.25';
                        popup.remove();
                    }
                });
            });

            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(popup);

            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
            popup.addEventListener('click', (e) => e.stopPropagation());
            
            // ä½¿ç”¨setTimeoutå»¶è¿Ÿæ·»åŠ documentç‚¹å‡»äº‹ä»¶ï¼Œé¿å…ç«‹å³è§¦å‘
            setTimeout(() => {
                const closePopupHandler = (e) => {
                    if (!popup.contains(e.target)) {
                        popup.remove();
                        document.removeEventListener('click', closePopupHandler);
                    }
                };
                document.addEventListener('click', closePopupHandler);
            }, 100);
        }

        // æ˜¾ç¤ºè‡ªè¡Œè½¦æ—¶é—´æŒ‘æˆ˜èµ›å¼¹çª—
        function showBikeTimeTrialPopup(item, index) {
            // åˆ›å»ºå¼¹çª—
            const popup = document.createElement('div');
            popup.className = 'bike-time-trial-popup';
            popup.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                border: 3px solid #4CAF50;
                border-radius: 12px;
                padding: 20px;
                z-index: 10000;
                max-width: 400px;
                max-height: 80vh;
                box-shadow: 0 8px 32px rgba(0,0,0,0.3);
                font-family: Arial, sans-serif;
                text-align: center;
            `;

            // å¼¹çª—å†…å®¹
            popup.innerHTML = `
                <div style="margin-bottom: 20px; font-size: 24px; font-weight: bold; color: #4CAF50;">
                    ğŸš´ è‡ªè¡Œè½¦æ—¶é—´æŒ‘æˆ˜èµ›
                </div>
                <div style="margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #4CAF50;">
                    <div style="font-weight: bold; color: #4CAF50; margin-bottom: 8px; font-size: 16px;">ğŸ—ºï¸ åœ°ç‚¹</div>
                    <div style="color: #333; font-size: 18px; margin-bottom: 15px;">${item.name || 'æœªçŸ¥åœ°ç‚¹'}</div>
                    
                    <div style="font-weight: bold; color: #4CAF50; margin-bottom: 8px; font-size: 16px;">â±ï¸ æ—¶é—´è¦æ±‚</div>
                    <div style="color: #333; font-size: 20px; font-weight: bold; background: #e8f5e8; padding: 8px; border-radius: 4px;">${item.time || 'æœªçŸ¥æ—¶é—´'}</div>
                </div>
                
                <div style="margin: 15px 0; padding: 12px; background: #e8f5e8; border-radius: 6px; color: #2e7d32; font-size: 14px; line-height: 1.4;">
                    ğŸ† æŒ‘æˆ˜æç¤ºï¼šä½¿ç”¨è‡ªè¡Œè½¦åœ¨é™å®šæ—¶é—´å†…å®Œæˆèµ›é“ï¼
                </div>
                
                <button id="close-bike-popup-btn" 
                        style="padding: 12px 24px; 
                               background: #4CAF50; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;
                               font-weight: bold;
                               transition: background-color 0.3s;
                               margin-right: 10px;">
                    å…³é—­
                </button>
                <button id="hide-bike-marker-btn" 
                        style="padding: 12px 24px; 
                               background: #666; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;
                               transition: background-color 0.3s;">
                    éšè—æ ‡è®°
                </button>
            `;

            // æ·»åŠ å…³é—­æŒ‰é’®äº‹ä»¶ç›‘å¬
            const closeBtn = popup.querySelector('#close-bike-popup-btn');
            closeBtn.addEventListener('click', () => {
                popup.remove();
            });

            // æ·»åŠ éšè—æŒ‰é’®äº‹ä»¶ç›‘å¬
            const hideBtn = popup.querySelector('#hide-bike-marker-btn');
            hideBtn.addEventListener('click', () => {
                // æ‰¾åˆ°å¯¹åº”çš„è‡ªè¡Œè½¦æ ‡è®°å¹¶è®¾ç½®é€æ˜åº¦ä¸º25%
                const bikeMarkers = document.querySelectorAll('.item-marker');
                bikeMarkers.forEach(marker => {
                    const img = marker.querySelector('img');
                    if (img && img.src && img.src.includes('btt.png') && marker.dataset.index == index) {
                        marker.style.opacity = '0.25';
                        popup.remove();
                    }
                });
            });

            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(popup);

            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
            popup.addEventListener('click', (e) => e.stopPropagation());
            
            // ä½¿ç”¨setTimeoutå»¶è¿Ÿæ·»åŠ documentç‚¹å‡»äº‹ä»¶ï¼Œé¿å…ç«‹å³è§¦å‘
            setTimeout(() => {
                const closePopupHandler = (e) => {
                    if (!popup.contains(e.target)) {
                        popup.remove();
                        document.removeEventListener('click', closePopupHandler);
                    }
                };
                document.addEventListener('click', closePopupHandler);
            }, 100);
        }

        // æ˜¾ç¤ºä¿¡å·å¹²æ‰°å™¨å›¾ç‰‡å¼¹çª—
        function showSignalJammerImage(index) {
            // åºå·ä»1å¼€å§‹
             const sequenceNumber = index + 1;
             // 1-9ä½¿ç”¨å•ä¸ªæ•°å­—ï¼Œ10+ä½¿ç”¨ä¸¤ä½æ•°
             const paddedNumber = sequenceNumber < 10 ? sequenceNumber.toString() : sequenceNumber.toString().padStart(2, '0');
             const imageUrl = `https://eo-gta-maps.antwen.com/collectibles_images/signal_jammers/signal_jammers_${paddedNumber}.webp`;
            
            // åˆ›å»ºå¼¹çª—
            const popup = document.createElement('div');
            popup.className = 'signal-jammer-popup';
            popup.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                border: 3px solid #2196F3;
                border-radius: 12px;
                padding: 20px;
                z-index: 10000;
                max-width: 80vw;
                max-height: 80vh;
                box-shadow: 0 8px 32px rgba(0,0,0,0.3);
                font-family: Arial, sans-serif;
                text-align: center;
            `;

            // å¼¹çª—å†…å®¹
            popup.innerHTML = `
                <div style="margin-bottom: 15px; font-size: 20px; font-weight: bold; color: #1976D2;">
                    ğŸ“¡ ä¿¡å·å¹²æ‰°å™¨ #${sequenceNumber}
                </div>
                <img src="${imageUrl}" 
                     alt="ä¿¡å·å¹²æ‰°å™¨ #${sequenceNumber}" 
                     style="max-width: 100%; max-height: 60vh; border-radius: 8px; margin-bottom: 15px;">
                <div style="margin-bottom: 15px; color: #666; font-size: 14px;">
                    å¯åœ¨ä¸Šå›¾ä½ç½®æ‰¾åˆ°ï¼
                </div>
                <div style="margin: 15px 0; padding: 12px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #2196F3;">
                    <div style="font-weight: bold; color: #1976D2; margin-bottom: 5px;">ğŸ¯ æ”¶é›†å¥–åŠ±</div>
                    <div style="color: #666; font-size: 14px; line-height: 1.4;">
                        æ¶ˆç­å…¨éƒ¨çš„50ä¸ªå¹²æ‰°å™¨å¯è§£é”èµŒåœºè±ªåŠ«éšè—é»‘å®¢ï¼šé˜¿ç»´Â·æ–½ç“¦å…¹æ›¼
                    </div>
                </div>
                <button id="close-signal-popup-btn" 
                         style="padding: 10px 20px; 
                                background: #2196F3; color: white; 
                                border: none; border-radius: 6px; 
                                cursor: pointer; font-size: 16px;
                                transition: background-color 0.3s;
                                margin-right: 10px;">
                     å…³é—­
                 </button>
                 <button id="hide-signal-jammer-btn" 
                         style="padding: 10px 20px; 
                                background: #666; color: white; 
                                border: none; border-radius: 6px; 
                                cursor: pointer; font-size: 16px;
                                transition: background-color 0.3s;">
                     éšè—
                 </button>
            `;

            // æ·»åŠ å…³é—­æŒ‰é’®äº‹ä»¶ç›‘å¬
             const closeBtn = popup.querySelector('#close-signal-popup-btn');
             closeBtn.addEventListener('click', () => {
                 popup.remove();
             });

             // æ·»åŠ éšè—æŒ‰é’®äº‹ä»¶ç›‘å¬
             const hideBtn = popup.querySelector('#hide-signal-jammer-btn');
             hideBtn.addEventListener('click', () => {
                 // æ‰¾åˆ°å¯¹åº”çš„ä¿¡å·å¹²æ‰°å™¨æ ‡è®°å¹¶è®¾ç½®é€æ˜åº¦ä¸º25%
                 const jammerMarkers = document.querySelectorAll('.item-marker');
                 jammerMarkers.forEach(marker => {
                     const img = marker.querySelector('img');
                     if (img && img.src && img.src.includes('signal_jammer') && marker.dataset.index == index) {
                         marker.style.opacity = '0.25';
                         // å°†éšè—æŒ‰é’®æ”¹ä¸ºæ˜¾ç¤ºæŒ‰é’®
                         hideBtn.textContent = 'æ˜¾ç¤º';
                         hideBtn.style.background = '#4CAF50';
                         hideBtn.id = 'show-signal-jammer-btn';
                         
                         // ç§»é™¤æ—§çš„ç‚¹å‡»äº‹ä»¶ï¼Œæ·»åŠ æ–°çš„æ˜¾ç¤ºäº‹ä»¶
                         const newShowBtn = hideBtn.cloneNode(true);
                         hideBtn.replaceWith(newShowBtn);
                         newShowBtn.addEventListener('click', () => {
                             // æ¢å¤é€æ˜åº¦ä¸º100%
                             const currentMarker = document.querySelector(`.item-marker[data-index="${index}"]`);
                             if (currentMarker) {
                                 currentMarker.style.opacity = '1';
                             }
                             popup.remove();
                         });
                     }
                 });
             });

            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(popup);

            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
            popup.addEventListener('click', (e) => e.stopPropagation());
            
            // ä½¿ç”¨setTimeoutå»¶è¿Ÿæ·»åŠ documentç‚¹å‡»äº‹ä»¶ï¼Œé¿å…ç«‹å³è§¦å‘
            setTimeout(() => {
                const closePopupHandler = (e) => {
                    if (!popup.contains(e.target)) {
                        popup.remove();
                        document.removeEventListener('click', closePopupHandler);
                    }
                };
                document.addEventListener('click', closePopupHandler);
            }, 100);
        }

        // æ˜¾ç¤ºå—ç“œç¯å›¾ç‰‡å¼¹çª—
        function showJackOLanternImage(index) {
            // åºå·ä»1å¼€å§‹
            const sequenceNumber = index + 1;
            const imageUrl = `https://eo-gta-maps.antwen.com/collectibles_images/lantern/lantern_${sequenceNumber.toString().padStart(2, '0')}.webp`;
            
            // åˆ›å»ºå¼¹çª—
            const popup = document.createElement('div');
            popup.className = 'jack-o-lantern-popup';
            popup.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                border: 3px solid #f26f17;
                border-radius: 12px;
                padding: 20px;
                z-index: 10000;
                max-width: 80vw;
                max-height: 80vh;
                box-shadow: 0 8px 32px rgba(0,0,0,0.3);
                font-family: Arial, sans-serif;
                text-align: center;
            `;

            // å¼¹çª—å†…å®¹
            popup.innerHTML = `
                <div style="margin-bottom: 15px; font-size: 20px; font-weight: bold; color: #f26f17;">
                    ğŸƒ å—ç“œç¯ #${sequenceNumber}
                </div>
                <img src="${imageUrl}" 
                     alt="å—ç“œç¯ #${sequenceNumber}" 
                     style="max-width: 100%; max-height: 60vh; border-radius: 8px; margin-bottom: 15px;">
                <div style="margin-bottom: 15px; color: #666; font-size: 14px;">
                    å¯åœ¨ä¸Šå›¾ä½ç½®æ‰¾åˆ°ï¼
                </div>
                <div style="margin: 15px 0; padding: 12px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #f26f17;">
                    <div style="font-weight: bold; color: #f26f17; margin-bottom: 5px;">ğŸ¯ æ”¶é›†å¥–åŠ±</div>
                    <div style="color: #666; font-size: 14px; line-height: 1.4;">
                        æ”¶é›†å…¨éƒ¨å—ç“œç¯å¯è·å¾—ç‰¹æ®Šä¸‡åœ£èŠ‚å¥–åŠ±ï¼
                    </div>
                </div>
                <button id="hide-jack-o-lantern-btn" 
                        style="padding: 10px 20px; 
                               background: #f26f17; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;">
                    éšè—æ ‡è®°
                </button>
            `;

            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(popup);

            // éšè—æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            const hideBtn = document.getElementById('hide-jack-o-lantern-btn');
            hideBtn.addEventListener('click', () => {
                 // æ‰¾åˆ°å¯¹åº”çš„æ ‡è®°å¹¶è®¾ç½®é€æ˜åº¦ä¸º25%
                 document.querySelectorAll('.item-marker').forEach(marker => {
                     const img = marker.querySelector('img');
                     if (img && img.src && img.src.includes('data:image/svg+xml') && marker.dataset.index == index) {
                         marker.style.opacity = '0.25';
                         // å°†éšè—æŒ‰é’®æ”¹ä¸ºæ˜¾ç¤ºæŒ‰é’®
                         hideBtn.textContent = 'æ˜¾ç¤º';
                         hideBtn.style.background = '#4CAF50';
                         hideBtn.id = 'show-jack-o-lantern-btn';
                         
                         // ç§»é™¤æ—§çš„ç‚¹å‡»äº‹ä»¶ï¼Œæ·»åŠ æ–°çš„æ˜¾ç¤ºäº‹ä»¶
                         const newShowBtn = hideBtn.cloneNode(true);
                         hideBtn.replaceWith(newShowBtn);
                         newShowBtn.addEventListener('click', () => {
                             // æ¢å¤é€æ˜åº¦ä¸º100%
                             const currentMarker = document.querySelector(`.item-marker[data-index="${index}"]`);
                             if (currentMarker) {
                                 currentMarker.style.opacity = '1';
                             }
                             popup.remove();
                         });
                     }
                 });
             });

            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
            popup.addEventListener('click', (e) => e.stopPropagation());
            
            // ä½¿ç”¨setTimeoutå»¶è¿Ÿæ·»åŠ documentç‚¹å‡»äº‹ä»¶ï¼Œé¿å…ç«‹å³è§¦å‘
            setTimeout(() => {
                const closePopupHandler = (e) => {
                    if (!popup.contains(e.target)) {
                        popup.remove();
                        document.removeEventListener('click', closePopupHandler);
                    }
                };
                document.addEventListener('click', closePopupHandler);
            }, 100);
        }

        // æ˜¾ç¤ºçº¸ç‰Œå›¾ç‰‡å¼¹çª—
        function showPlayingCardsImage(index) {
            // åºå·ä»1å¼€å§‹
            const sequenceNumber = index + 1;
            const imageUrl = `https://eo-gta-maps.antwen.com/collectibles_images/playing_cards/playing_cards_${sequenceNumber}.webp`;
            
            // åˆ›å»ºå¼¹çª—
            const popup = document.createElement('div');
            popup.className = 'playing-cards-popup';
            popup.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                border: 3px solid #9C27B0;
                border-radius: 12px;
                padding: 20px;
                z-index: 10000;
                max-width: 80vw;
                max-height: 80vh;
                box-shadow: 0 8px 32px rgba(0,0,0,0.3);
                font-family: Arial, sans-serif;
                text-align: center;
            `;

            // å¼¹çª—å†…å®¹
            popup.innerHTML = `
                <div style="margin-bottom: 15px; font-size: 20px; font-weight: bold; color: #7B1FA2;">
                    ğŸƒ çº¸ç‰Œ #${sequenceNumber}
                </div>
                <img src="${imageUrl}" 
                     alt="çº¸ç‰Œ #${sequenceNumber}" 
                     style="max-width: 100%; max-height: 60vh; border-radius: 8px; margin-bottom: 15px;">
                <div style="margin-bottom: 15px; color: #666; font-size: 14px;">
                    å¯åœ¨ä¸Šå›¾ä½ç½®æ‰¾åˆ°ï¼
                </div>
                <div style="margin: 15px 0; padding: 12px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #9C27B0;">
                    <div style="font-weight: bold; color: #7B1FA2; margin-bottom: 5px;">ğŸ¯ æ”¶é›†å¥–åŠ±</div>
                    <div style="color: #666; font-size: 14px; line-height: 1.4;">
                        æ”¶é›†æ‰€æœ‰54å¼ çº¸ç‰Œå¯è·å¾—ï¼šç‰¹æ®Šæœè£…å¥–åŠ±èµŒåœºè±ªèµŒå®¢å¥—è£…
                    </div>
                </div>
                <button id="hide-playing-cards-btn" 
                        style="padding: 10px 20px; margin-right: 10px;
                               background: #4CAF50; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;
                               transition: background-color 0.3s;">
                    éšè—æ ‡è®°
                </button>
                <button id="close-playing-cards-btn" 
                        style="padding: 10px 20px; 
                               background: #f44336; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;
                               transition: background-color 0.3s;">
                    å…³é—­
                </button>
            `;

            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(popup);

            // æ·»åŠ éšè—æŒ‰é’®äº‹ä»¶ç›‘å¬
            const hideBtn = popup.querySelector('#hide-playing-cards-btn');
            hideBtn.addEventListener('click', () => {
                 // æ‰¾åˆ°å¯¹åº”çš„æ ‡è®°å¹¶è®¾ç½®é€æ˜åº¦ä¸º25%
                 document.querySelectorAll('.item-marker').forEach(marker => {
                     const img = marker.querySelector('img');
                     if (img && img.src && img.src.includes('playing_cards') && marker.dataset.index == index) {
                         marker.style.opacity = '0.25';
                         // å°†éšè—æŒ‰é’®æ”¹ä¸ºæ˜¾ç¤ºæŒ‰é’®
                         hideBtn.textContent = 'æ˜¾ç¤º';
                         hideBtn.style.background = '#2196F3';
                         hideBtn.id = 'show-playing-cards-btn';
                         
                         // ç§»é™¤æ—§çš„ç‚¹å‡»äº‹ä»¶ï¼Œæ·»åŠ æ–°çš„æ˜¾ç¤ºäº‹ä»¶
                         const newShowBtn = hideBtn.cloneNode(true);
                         hideBtn.replaceWith(newShowBtn);
                         newShowBtn.addEventListener('click', () => {
                             // æ¢å¤é€æ˜åº¦ä¸º100%
                             const currentMarker = document.querySelector(`.item-marker[data-index="${index}"]`);
                             if (currentMarker) {
                                 currentMarker.style.opacity = '1';
                             }
                             popup.remove();
                         });
                     }
                 });
             });

            // æ·»åŠ å…³é—­æŒ‰é’®äº‹ä»¶ç›‘å¬
            const closeBtn = popup.querySelector('#close-playing-cards-btn');
            closeBtn.addEventListener('click', () => {
                popup.remove();
            });

            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
            popup.addEventListener('click', (e) => e.stopPropagation());
            
            // ä½¿ç”¨setTimeoutå»¶è¿Ÿæ·»åŠ documentç‚¹å‡»äº‹ä»¶ï¼Œé¿å…ç«‹å³è§¦å‘
            setTimeout(() => {
                const closePopupHandler = (e) => {
                    if (!popup.contains(e.target)) {
                        popup.remove();
                        document.removeEventListener('click', closePopupHandler);
                    }
                };
                document.addEventListener('click', closePopupHandler);
            }, 100);
        }

        // æ˜¾ç¤ºåäº‘åé›¾é¦†äº§å“å›¾ç‰‡å¼¹çª—
        function showSmokeProductImage(index) {
            // åºå·ä»1å¼€å§‹
            const sequenceNumber = index + 1;
            const imageUrl = `https://eo-gta-maps.antwen.com/collectibles_images/smoke_on_the_water_product/smoke_on_the_water_product_${sequenceNumber}.webp`;
            
            // åˆ›å»ºå¼¹çª—
            const popup = document.createElement('div');
            popup.className = 'smoke-product-popup';
            popup.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                border: 3px solid #FF9800;
                border-radius: 12px;
                padding: 20px;
                z-index: 10000;
                max-width: 80vw;
                max-height: 80vh;
                box-shadow: 0 8px 32px rgba(0,0,0,0.3);
                font-family: Arial, sans-serif;
                text-align: center;
            `;

            // å¼¹çª—å†…å®¹
            popup.innerHTML = `
                <div style="margin-bottom: 15px; font-size: 20px; font-weight: bold; color: #F57C00;">
                    ğŸ’¨ åäº‘åé›¾é¦†äº§å“ #${sequenceNumber}
                </div>
                <img src="${imageUrl}" 
                     alt="åäº‘åé›¾é¦†äº§å“ #${sequenceNumber}" 
                     style="max-width: 100%; max-height: 60vh; border-radius: 8px; margin-bottom: 15px;">
                <div style="margin-bottom: 15px; color: #666; font-size: 14px;">
                    å¯åœ¨ä¸Šå›¾ä½ç½®æ‰¾åˆ°ï¼
                </div>
                <div style="margin: 15px 0; padding: 12px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #FF9800;">
                    <div style="font-weight: bold; color: #F57C00; margin-bottom: 5px;">ğŸ¯ æ”¶é›†å¥–åŠ±</div>
                    <div style="color: #666; font-size: 14px; line-height: 1.4;">
                        æ”¶é›†æ‰€æœ‰åäº‘åé›¾é¦†äº§å“å¯è·å¾—ï¼š<br>
                        â€¢ ç‰¹æ®Šè½½å…·å¥–åŠ±<br>
                        â€¢ æ¸¸æˆå¸å¥–åŠ±<br>
                        â€¢ è§£é”éšè—æˆå°±
                    </div>
                </div>
                <button id="hide-smoke-product-btn" 
                        style="padding: 10px 20px; margin-right: 10px;
                               background: #4CAF50; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;
                               transition: background-color 0.3s;">
                    éšè—æ ‡è®°
                </button>
                <button id="close-smoke-product-btn" 
                        style="padding: 10px 20px; 
                               background: #f44336; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;
                               transition: background-color 0.3s;">
                    å…³é—­
                </button>
            `;

            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(popup);

            // æ·»åŠ éšè—æŒ‰é’®äº‹ä»¶ç›‘å¬
            const hideBtn = popup.querySelector('#hide-smoke-product-btn');
            hideBtn.addEventListener('click', () => {
                 // æ‰¾åˆ°å¯¹åº”çš„æ ‡è®°å¹¶è®¾ç½®é€æ˜åº¦ä¸º25%
                 document.querySelectorAll('.item-marker').forEach(marker => {
                     const img = marker.querySelector('img');
                     if (img && img.src && img.src.includes('smoke_on_the_water_product') && marker.dataset.index == index) {
                         marker.style.opacity = '0.25';
                         // å°†éšè—æŒ‰é’®æ”¹ä¸ºæ˜¾ç¤ºæŒ‰é’®
                         hideBtn.textContent = 'æ˜¾ç¤º';
                         hideBtn.style.background = '#2196F3';
                         hideBtn.id = 'show-smoke-product-btn';
                         
                         // ç§»é™¤æ—§çš„ç‚¹å‡»äº‹ä»¶ï¼Œæ·»åŠ æ–°çš„æ˜¾ç¤ºäº‹ä»¶
                         const newShowBtn = hideBtn.cloneNode(true);
                         hideBtn.replaceWith(newShowBtn);
                         newShowBtn.addEventListener('click', () => {
                             // æ¢å¤é€æ˜åº¦ä¸º100%
                             const currentMarker = document.querySelector(`.item-marker[data-index="${index}"]`);
                             if (currentMarker) {
                                 currentMarker.style.opacity = '1';
                             }
                             popup.remove();
                         });
                     }
                 });
             });

            // æ·»åŠ å…³é—­æŒ‰é’®äº‹ä»¶ç›‘å¬
            const closeBtn = popup.querySelector('#close-smoke-product-btn');
            closeBtn.addEventListener('click', () => {
                popup.remove();
            });

            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
            popup.addEventListener('click', (e) => e.stopPropagation());
            
            // ä½¿ç”¨setTimeoutå»¶è¿Ÿæ·»åŠ documentç‚¹å‡»äº‹ä»¶ï¼Œé¿å…ç«‹å³è§¦å‘
            setTimeout(() => {
                const closePopupHandler = (e) => {
                    if (!popup.contains(e.target)) {
                        popup.remove();
                        document.removeEventListener('click', closePopupHandler);
                    }
                };
                document.addEventListener('click', closePopupHandler);
            }, 100);
        }

        // æ˜¾ç¤ºæ‰‹åŠå›¾ç‰‡å¼¹çª—
        function showActionFiguresImage(index) {
            // åºå·ä»1å¼€å§‹
            const sequenceNumber = index + 1;
            const imageUrl = `https://eo-gta-maps.antwen.com/collectibles_images/action_figures/action_figures_${sequenceNumber}.webp`;
            
            // åˆ›å»ºå¼¹çª—
            const popup = document.createElement('div');
            popup.className = 'action-figures-popup';
            popup.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                border: 3px solid #E91E63;
                border-radius: 12px;
                padding: 20px;
                z-index: 10000;
                max-width: 80vw;
                max-height: 80vh;
                box-shadow: 0 8px 32px rgba(0,0,0,0.3);
                font-family: Arial, sans-serif;
                text-align: center;
            `;

            // å¼¹çª—å†…å®¹
            popup.innerHTML = `
                <div style="margin-bottom: 15px; font-size: 20px; font-weight: bold; color: #C2185B;">
                    ğŸ­ æ‰‹åŠ #${sequenceNumber}
                </div>
                <img src="${imageUrl}" 
                     alt="æ‰‹åŠ #${sequenceNumber}" 
                     style="max-width: 100%; max-height: 60vh; border-radius: 8px; margin-bottom: 15px;">
                <div style="margin-bottom: 15px; color: #666; font-size: 14px;">
                    å¯åœ¨ä¸Šå›¾ä½ç½®æ‰¾åˆ°ï¼
                </div>
                <div style="margin: 15px 0; padding: 12px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #E91E63;">
                    <div style="font-weight: bold; color: #C2185B; margin-bottom: 5px;">ğŸ¯ æ”¶é›†å¥–åŠ±</div>
                    <div style="color: #666; font-size: 14px; line-height: 1.4;">
                        æ”¶é›†æ‰€æœ‰æ‰‹åŠå¯è·å¾—ï¼š<br>
                        â€¢ ç‰¹æ®Šè½½å…·å¥–åŠ±<br>
                        â€¢ æ¸¸æˆå¸å¥–åŠ±<br>
                        â€¢ è§£é”éšè—æˆå°±
                    </div>
                </div>
                <button id="hide-action-figures-btn" 
                        style="padding: 10px 20px; margin-right: 10px;
                               background: #4CAF50; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;
                               transition: background-color 0.3s;">
                    éšè—æ ‡è®°
                </button>
                <button id="close-action-figures-btn" 
                        style="padding: 10px 20px; 
                               background: #f44336; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;
                               transition: background-color 0.3s;">
                    å…³é—­
                </button>
            `;

            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(popup);

            // æ·»åŠ éšè—æŒ‰é’®äº‹ä»¶ç›‘å¬
            const hideBtn = popup.querySelector('#hide-action-figures-btn');
            hideBtn.addEventListener('click', () => {
                 // æ‰¾åˆ°å¯¹åº”çš„æ ‡è®°å¹¶è®¾ç½®é€æ˜åº¦ä¸º25%
                 document.querySelectorAll('.item-marker').forEach(marker => {
                     const img = marker.querySelector('img');
                     if (img && img.src && img.src.includes('action_figures') && marker.dataset.index == index) {
                         marker.style.opacity = '0.25';
                         // å°†éšè—æŒ‰é’®æ”¹ä¸ºæ˜¾ç¤ºæŒ‰é’®
                         hideBtn.textContent = 'æ˜¾ç¤º';
                         hideBtn.style.background = '#2196F3';
                         hideBtn.id = 'show-action-figures-btn';
                         
                         // ç§»é™¤æ—§çš„ç‚¹å‡»äº‹ä»¶ï¼Œæ·»åŠ æ–°çš„æ˜¾ç¤ºäº‹ä»¶
                         const newShowBtn = hideBtn.cloneNode(true);
                         hideBtn.replaceWith(newShowBtn);
                         newShowBtn.addEventListener('click', () => {
                             // æ¢å¤é€æ˜åº¦ä¸º100%
                             const currentMarker = document.querySelector(`.item-marker[data-index="${index}"]`);
                             if (currentMarker) {
                                 currentMarker.style.opacity = '1';
                             }
                             popup.remove();
                         });
                     }
                 });
             });

            // æ·»åŠ å…³é—­æŒ‰é’®äº‹ä»¶ç›‘å¬
            const closeBtn = popup.querySelector('#close-action-figures-btn');
            closeBtn.addEventListener('click', () => {
                popup.remove();
            });

            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
            popup.addEventListener('click', (e) => e.stopPropagation());
            
            // ä½¿ç”¨setTimeoutå»¶è¿Ÿæ·»åŠ documentç‚¹å‡»äº‹ä»¶ï¼Œé¿å…ç«‹å³è§¦å‘
            setTimeout(() => {
                const closePopupHandler = (e) => {
                    if (!popup.contains(e.target)) {
                        popup.remove();
                        document.removeEventListener('click', closePopupHandler);
                    }
                };
                document.addEventListener('click', closePopupHandler);
            }, 100);
        }

        // æ˜¾ç¤ºå…ƒå®å›¾ç‰‡å¼¹çª—
        function showYuanbaoImage(index) {
            // åºå·ä»1å¼€å§‹
            const sequenceNumber = index + 1;
            const imageUrl = `https://eo-gta-maps.antwen.com/collectibles_images/yuanbao/yuanbao_${sequenceNumber}.webp`;
            
            // åˆ›å»ºå¼¹çª—
            const popup = document.createElement('div');
            popup.className = 'yuanbao-popup';
            popup.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                border: 3px solid #FFD700;
                border-radius: 12px;
                padding: 20px;
                z-index: 10000;
                max-width: 80vw;
                max-height: 80vh;
                box-shadow: 0 8px 32px rgba(0,0,0,0.3);
                font-family: Arial, sans-serif;
                text-align: center;
            `;

            // å¼¹çª—å†…å®¹
            popup.innerHTML = `
                <div style="margin-bottom: 15px; font-size: 20px; font-weight: bold; color: #B8860B;">
                    ğŸª™ å…ƒå® #${sequenceNumber}
                </div>
                <img src="${imageUrl}" 
                     alt="å…ƒå® #${sequenceNumber}" 
                     style="max-width: 100%; max-height: 60vh; border-radius: 8px; margin-bottom: 15px;">
                <div style="margin-bottom: 15px; color: #666; font-size: 14px;">
                    å¯åœ¨ä¸Šå›¾ä½ç½®æ‰¾åˆ°ï¼
                </div>
                <div style="margin: 15px 0; padding: 12px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #FFD700;">
                    <div style="font-weight: bold; color: #B8860B; margin-bottom: 5px;">ğŸ¯ æ”¶é›†å¥–åŠ±</div>
                    <div style="color: #666; font-size: 14px; line-height: 1.4;">
                        æ”¶é›†æ‰€æœ‰å…ƒå®å¯è·å¾—ï¼š<br>
                        â€¢ é«˜é¢æ¸¸æˆå¸å¥–åŠ±<br>
                        â€¢ ç‰¹æ®Šæœè£…å¥–åŠ±<br>
                        â€¢ è§£é”éšè—æˆå°±
                    </div>
                </div>
                <button id="hide-yuanbao-btn" 
                        style="padding: 10px 20px; margin-right: 10px;
                               background: #4CAF50; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;
                               transition: background-color 0.3s;">
                    éšè—æ ‡è®°
                </button>
                <button id="close-yuanbao-btn" 
                        style="padding: 10px 20px; 
                               background: #f44336; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;
                               transition: background-color 0.3s;">
                    å…³é—­
                </button>
            `;

            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(popup);

            // æ·»åŠ éšè—æŒ‰é’®äº‹ä»¶ç›‘å¬
            const hideBtn = popup.querySelector('#hide-yuanbao-btn');
            hideBtn.addEventListener('click', () => {
                 // æ‰¾åˆ°å¯¹åº”çš„æ ‡è®°å¹¶è®¾ç½®é€æ˜åº¦ä¸º25%
                 document.querySelectorAll('.item-marker').forEach(marker => {
                     const img = marker.querySelector('img');
                     if (img && img.src && img.src.includes('yuanbao') && marker.dataset.index == index) {
                         marker.style.opacity = '0.25';
                         // å°†éšè—æŒ‰é’®æ”¹ä¸ºæ˜¾ç¤ºæŒ‰é’®
                         hideBtn.textContent = 'æ˜¾ç¤º';
                         hideBtn.style.background = '#2196F3';
                         hideBtn.id = 'show-yuanbao-btn';
                         
                         // ç§»é™¤æ—§çš„ç‚¹å‡»äº‹ä»¶ï¼Œæ·»åŠ æ–°çš„æ˜¾ç¤ºäº‹ä»¶
                         const newShowBtn = hideBtn.cloneNode(true);
                         hideBtn.replaceWith(newShowBtn);
                         newShowBtn.addEventListener('click', () => {
                             // æ¢å¤é€æ˜åº¦ä¸º100%
                             const currentMarker = document.querySelector(`.item-marker[data-index="${index}"]`);
                             if (currentMarker) {
                                 currentMarker.style.opacity = '1';
                             }
                             popup.remove();
                         });
                     }
                 });
             });

            // æ·»åŠ å…³é—­æŒ‰é’®äº‹ä»¶ç›‘å¬
            const closeBtn = popup.querySelector('#close-yuanbao-btn');
            closeBtn.addEventListener('click', () => {
                popup.remove();
            });

            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
            popup.addEventListener('click', (e) => e.stopPropagation());
            
            // ä½¿ç”¨setTimeoutå»¶è¿Ÿæ·»åŠ documentç‚¹å‡»äº‹ä»¶ï¼Œé¿å…ç«‹å³è§¦å‘
            setTimeout(() => {
                const closePopupHandler = (e) => {
                    if (!popup.contains(e.target)) {
                        popup.remove();
                        document.removeEventListener('click', closePopupHandler);
                    }
                };
                document.addEventListener('click', closePopupHandler);
            }, 100);
        }

        // æ˜¾ç¤ºæ²‰èˆ¹å›¾ç‰‡å¼¹çª—
        function showShipwrecksImage(index) {
            // ä»APIæ¶ˆæ¯ä¸­æå–æ²‰èˆ¹ç¼–å·
            let sequenceNumber = index + 1; // é»˜è®¤ä½¿ç”¨index+1
            
            // å¦‚æœæœ‰APIæ¶ˆæ¯ï¼Œå°è¯•ä»ä¸­æå–æ­£ç¡®çš„ç¼–å·
            if (itemData.shipwreckedMessage) {
                const match = itemData.shipwreckedMessage.match(/#(\d+)/);
                if (match && match[1]) {
                    sequenceNumber = parseInt(match[1]);
                    console.log('ä»APIæ¶ˆæ¯ä¸­æå–çš„æ²‰èˆ¹ç¼–å·:', sequenceNumber);
                }
            }
            
            console.log('æ²‰èˆ¹sequenceNumber:', sequenceNumber);
            const imageUrl = `https://eo-gta-maps.antwen.com/collectibles_images/shipwrecks/shipwrecks_${sequenceNumber}.webp`;
            
            // åˆ›å»ºå¼¹çª—
            const popup = document.createElement('div');
            popup.className = 'shipwrecks-popup';
            popup.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                border: 3px solid #795548;
                border-radius: 12px;
                padding: 20px;
                z-index: 10000;
                max-width: 80vw;
                max-height: 80vh;
                box-shadow: 0 8px 32px rgba(0,0,0,0.3);
                font-family: Arial, sans-serif;
                text-align: center;
            `;

            // å¼¹çª—å†…å®¹
            popup.innerHTML = `
                <div style="margin-bottom: 15px; font-size: 20px; font-weight: bold; color: #5D4037;">
                    âš“ æ²‰èˆ¹ #${sequenceNumber}
                </div>
                <img src="${imageUrl}" 
                     alt="æ²‰èˆ¹ #${sequenceNumber}" 
                     style="max-width: 100%; max-height: 60vh; border-radius: 8px; margin-bottom: 15px;">
                <div style="margin-bottom: 15px; color: #666; font-size: 14px;">
                    å¯åœ¨ä¸Šå›¾ä½ç½®æ‰¾åˆ°ï¼
                </div>
                <div style="margin: 15px 0; padding: 12px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #795548;">
                    <div style="font-weight: bold; color: #5D4037; margin-bottom: 5px;">ğŸ¯ æ”¶é›†å¥–åŠ±</div>
                    <div style="color: #666; font-size: 14px; line-height: 1.4;">
                        æ”¶é›†æ‰€æœ‰æ²‰èˆ¹å¯è·å¾—ï¼šè¾¹å¢ƒå¥—è£…
                    </div>
                </div>
                <button id="hide-shipwrecks-btn" 
                        style="padding: 10px 20px; margin-right: 10px;
                               background: #4CAF50; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;
                               transition: background-color 0.3s;">
                    éšè—æ ‡è®°
                </button>
                <button id="close-shipwrecks-btn" 
                        style="padding: 10px 20px; 
                               background: #f44336; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;
                               transition: background-color 0.3s;">
                    å…³é—­
                </button>
            `;

            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(popup);

            // æ·»åŠ éšè—æŒ‰é’®äº‹ä»¶ç›‘å¬
            const hideBtn = popup.querySelector('#hide-shipwrecks-btn');
            hideBtn.addEventListener('click', () => {
                 // æ‰¾åˆ°å¯¹åº”çš„æ ‡è®°å¹¶è®¾ç½®é€æ˜åº¦ä¸º25%
                 document.querySelectorAll('.item-marker').forEach(marker => {
                     const img = marker.querySelector('img');
                     if (img && img.src && img.src.includes('shipwrecked') && marker.dataset.index == index) {
                         marker.style.opacity = '0.25';
                         // å°†éšè—æŒ‰é’®æ”¹ä¸ºæ˜¾ç¤ºæŒ‰é’®
                         hideBtn.textContent = 'æ˜¾ç¤º';
                         hideBtn.style.background = '#2196F3';
                         hideBtn.id = 'show-shipwrecks-btn';
                         
                         // ç§»é™¤æ—§çš„ç‚¹å‡»äº‹ä»¶ï¼Œæ·»åŠ æ–°çš„æ˜¾ç¤ºäº‹ä»¶
                         const newShowBtn = hideBtn.cloneNode(true);
                         hideBtn.replaceWith(newShowBtn);
                         newShowBtn.addEventListener('click', () => {
                             // æ¢å¤é€æ˜åº¦ä¸º100%
                             const currentMarker = document.querySelector(`.item-marker[data-index="${index}"]`);
                             if (currentMarker) {
                                 currentMarker.style.opacity = '1';
                             }
                             popup.remove();
                         });
                     }
                 });
             });

            // æ·»åŠ å…³é—­æŒ‰é’®äº‹ä»¶ç›‘å¬
            const closeBtn = popup.querySelector('#close-shipwrecks-btn');
            closeBtn.addEventListener('click', () => {
                popup.remove();
            });

            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
            popup.addEventListener('click', (e) => e.stopPropagation());
            
            // ä½¿ç”¨setTimeoutå»¶è¿Ÿæ·»åŠ documentç‚¹å‡»äº‹ä»¶ï¼Œé¿å…ç«‹å³è§¦å‘
            setTimeout(() => {
                const closePopupHandler = (e) => {
                    if (!popup.contains(e.target)) {
                        popup.remove();
                        document.removeEventListener('click', closePopupHandler);
                    }
                };
                document.addEventListener('click', closePopupHandler);
            }, 100);
        }

        // æ˜¾ç¤ºç”µè¯æš—æ€å›¾ç‰‡å¼¹çª—
        function showPayphoneHitsImage(index) {
            // åºå·ä»1å¼€å§‹
            const sequenceNumber = index + 1;            
            // åˆ›å»ºå¼¹çª—
            const popup = document.createElement('div');
            popup.className = 'payphone-hits-popup';
            popup.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                border: 3px solid #E91E63;
                border-radius: 12px;
                padding: 20px;
                z-index: 10000;
                max-width: 80vw;
                max-height: 80vh;
                box-shadow: 0 8px 32px rgba(0,0,0,0.3);
                font-family: Arial, sans-serif;
                text-align: center;
            `;

            // å¼¹çª—å†…å®¹
            popup.innerHTML = `
                <div style="margin-bottom: 15px; font-size: 20px; font-weight: bold; color: #C2185B;">
                    ğŸ“ ç”µè¯æš—æ€ #${sequenceNumber}
                </div>
                <div style="margin-bottom: 15px; color: #666; font-size: 14px;">
                </div>
                <div style="margin: 15px 0; padding: 12px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #E91E63;">
                    <div style="font-weight: bold; color: #C2185B; margin-bottom: 5px;">ğŸ¯ ä»»åŠ¡è¯´æ˜</div>
                    <div style="color: #666; font-size: 14px; line-height: 1.4;">
                        éœ€è¦è´­ä¹°äº‹åŠ¡æ‰€å®Œæˆä¸€ä¸ªå®‰ä¿åˆçº¦è§£é”
                    </div>
                </div>
                <button id="hide-payphone-hits-btn" 
                        style="padding: 10px 20px; margin-right: 10px;
                               background: #E91E63; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;
                               transition: background-color 0.3s;">
                    éšè—æ ‡è®°
                </button>
                <button id="close-payphone-hits-btn" 
                        style="padding: 10px 20px; 
                               background: #f44336; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;
                               transition: background-color 0.3s;">
                    å…³é—­
                </button>
            `;

            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(popup);

            // æ·»åŠ éšè—æŒ‰é’®äº‹ä»¶ç›‘å¬
            const hideBtn = popup.querySelector('#hide-payphone-hits-btn');
            hideBtn.addEventListener('click', () => {
                 // æ‰¾åˆ°å¯¹åº”çš„æ ‡è®°å¹¶è®¾ç½®é€æ˜åº¦ä¸º25%
                 document.querySelectorAll('.item-marker').forEach(marker => {
                     const img = marker.querySelector('img');
                     if (img && img.src && img.src.includes('payphone_hits') && marker.dataset.index == index) {
                         marker.style.opacity = '0.25';
                         // å°†éšè—æŒ‰é’®æ”¹ä¸ºæ˜¾ç¤ºæŒ‰é’®
                         hideBtn.textContent = 'æ˜¾ç¤º';
                         hideBtn.style.background = '#2196F3';
                         hideBtn.id = 'show-payphone-hits-btn';
                         
                         // ç§»é™¤æ—§çš„ç‚¹å‡»äº‹ä»¶ï¼Œæ·»åŠ æ–°çš„æ˜¾ç¤ºäº‹ä»¶
                         const newShowBtn = hideBtn.cloneNode(true);
                         hideBtn.replaceWith(newShowBtn);
                         newShowBtn.addEventListener('click', () => {
                             // æ¢å¤é€æ˜åº¦ä¸º100%
                             const currentMarker = document.querySelector(`.item-marker[data-index="${index}"]`);
                             if (currentMarker) {
                                 currentMarker.style.opacity = '1';
                             }
                             popup.remove();
                         });
                     }
                 });
             });

            // æ·»åŠ å…³é—­æŒ‰é’®äº‹ä»¶ç›‘å¬
            const closeBtn = popup.querySelector('#close-payphone-hits-btn');
            closeBtn.addEventListener('click', () => {
                popup.remove();
            });

            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
            popup.addEventListener('click', (e) => e.stopPropagation());
            
            // ä½¿ç”¨setTimeoutå»¶è¿Ÿæ·»åŠ documentç‚¹å‡»äº‹ä»¶ï¼Œé¿å…ç«‹å³è§¦å‘
            setTimeout(() => {
                const closePopupHandler = (e) => {
                    if (!popup.contains(e.target)) {
                        popup.remove();
                        document.removeEventListener('click', closePopupHandler);
                    }
                };
                document.addEventListener('click', closePopupHandler);
            }, 100);
        }

        // æ˜¾ç¤ºé«˜å°”å¤«çƒæ´å›¾ç‰‡å¼¹çª—
        function showGolfHolesImage(index) {
            // åºå·ä»1å¼€å§‹
            const sequenceNumber = index + 1;
            const imageUrl = `https://eo-gta-maps.antwen.com/collectibles_images/golf_holes/golf_holes_${sequenceNumber}.webp`;
            
            // åˆ›å»ºå¼¹çª—
            const popup = document.createElement('div');
            popup.className = 'golf-holes-popup';
            popup.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                border: 3px solid #4CAF50;
                border-radius: 12px;
                padding: 20px;
                z-index: 10000;
                max-width: 80vw;
                max-height: 80vh;
                box-shadow: 0 8px 32px rgba(0,0,0,0.3);
                font-family: Arial, sans-serif;
                text-align: center;
            `;

            // å¼¹çª—å†…å®¹
            popup.innerHTML = `
                <div style="margin-bottom: 15px; font-size: 20px; font-weight: bold; color: #2E7D32;">
                    â›³ é«˜å°”å¤«çƒæ´ #${sequenceNumber}
                </div>
                <img src="${imageUrl}" 
                     alt="é«˜å°”å¤«çƒæ´ #${sequenceNumber}" 
                     style="max-width: 100%; max-height: 60vh; border-radius: 8px; margin-bottom: 15px;">
                <div style="margin-bottom: 15px; color: #666; font-size: 14px;">
                    å¯åœ¨ä¸Šå›¾ä½ç½®æ‰¾åˆ°ï¼
                </div>
                <div style="margin: 15px 0; padding: 12px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #4CAF50;">
                    <div style="font-weight: bold; color: #2E7D32; margin-bottom: 5px;">ğŸ¯ æ”¶é›†å¥–åŠ±</div>
                    <div style="color: #666; font-size: 14px; line-height: 1.4;">
                        å®Œæˆæ‰€æœ‰é«˜å°”å¤«çƒæ´æŒ‘æˆ˜å¯è·å¾—ç‰¹æ®Šå¥–åŠ±
                    </div>
                </div>
                <button id="hide-golf-holes-btn" 
                        style="padding: 10px 20px; margin-right: 10px;
                               background: #4CAF50; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;
                               transition: background-color 0.3s;">
                    éšè—æ ‡è®°
                </button>
                <button id="close-golf-holes-btn" 
                        style="padding: 10px 20px; 
                               background: #f44336; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;
                               transition: background-color 0.3s;">
                    å…³é—­
                </button>
            `;

            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(popup);

            // æ·»åŠ éšè—æŒ‰é’®äº‹ä»¶ç›‘å¬
            const hideBtn = popup.querySelector('#hide-golf-holes-btn');
            hideBtn.addEventListener('click', () => {
                 // æ‰¾åˆ°å¯¹åº”çš„æ ‡è®°å¹¶è®¾ç½®é€æ˜åº¦ä¸º25%
                 document.querySelectorAll('.item-marker').forEach(marker => {
                     const img = marker.querySelector('img');
                     if (img && img.src && img.src.includes('golf_holes') && marker.dataset.index == index) {
                         marker.style.opacity = '0.25';
                         // å°†éšè—æŒ‰é’®æ”¹ä¸ºæ˜¾ç¤ºæŒ‰é’®
                         hideBtn.textContent = 'æ˜¾ç¤º';
                         hideBtn.style.background = '#2196F3';
                         hideBtn.id = 'show-golf-holes-btn';
                         
                         // ç§»é™¤æ—§çš„ç‚¹å‡»äº‹ä»¶ï¼Œæ·»åŠ æ–°çš„æ˜¾ç¤ºäº‹ä»¶
                         const newShowBtn = hideBtn.cloneNode(true);
                         hideBtn.replaceWith(newShowBtn);
                         newShowBtn.addEventListener('click', () => {
                             // æ¢å¤é€æ˜åº¦ä¸º100%
                             const currentMarker = document.querySelector(`.item-marker[data-index="${index}"]`);
                             if (currentMarker) {
                                 currentMarker.style.opacity = '1';
                             }
                             popup.remove();
                         });
                     }
                 });
             });

            // æ·»åŠ å…³é—­æŒ‰é’®äº‹ä»¶ç›‘å¬
            const closeBtn = popup.querySelector('#close-golf-holes-btn');
            closeBtn.addEventListener('click', () => {
                popup.remove();
            });

            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
            popup.addEventListener('click', (e) => e.stopPropagation());
            
            // ä½¿ç”¨setTimeoutå»¶è¿Ÿæ·»åŠ documentç‚¹å‡»äº‹ä»¶ï¼Œé¿å…ç«‹å³è§¦å‘
            setTimeout(() => {
                const closePopupHandler = (e) => {
                    if (!popup.contains(e.target)) {
                        popup.remove();
                        document.removeEventListener('click', closePopupHandler);
                    }
                };
                document.addEventListener('click', closePopupHandler);
            }, 100);
        }

        // æ˜¾ç¤ºå–·ç½ä½ç½®å¼¹çª—
        function showSprayImage(index) {
            // åºå·ä»1å¼€å§‹
            const sequenceNumber = index + 1;
            const imageUrl = `https://eo-gta-maps.antwen.com/collectibles_images/spray/spray_${sequenceNumber}.webp`;
            
            // åˆ›å»ºå¼¹çª—
            const popup = document.createElement('div');
            popup.className = 'spray-popup';
            popup.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                border: 3px solid #2196F3;
                border-radius: 12px;
                padding: 20px;
                z-index: 10000;
                max-width: 80vw;
                max-height: 80vh;
                box-shadow: 0 8px 32px rgba(0,0,0,0.3);
                font-family: Arial, sans-serif;
                text-align: center;
            `;

            // å¼¹çª—å†…å®¹
            popup.innerHTML = `
                <div style="margin-bottom: 15px; font-size: 20px; font-weight: bold; color: #2196F3;">
                    ğŸ¨ å–·ç½ä½ç½® #${sequenceNumber}
                </div>
                <img src="${imageUrl}"
                     alt="å–·ç½ä½ç½® #${sequenceNumber}"
                     style="max-width: 100%; max-height: 60vh; border-radius: 8px; margin-bottom: 15px;">
                <div style="margin-bottom: 15px; color: #666; font-size: 14px;">
                    å¯åœ¨ä¸Šå›¾ä½ç½®æ‰¾åˆ°ï¼
                </div>
                <div style="margin: 15px 0; padding: 12px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #2196F3;">
                    <div style="font-weight: bold; color: #2196F3; margin-bottom: 5px;">ğŸ¯ æ”¶é›†è¯´æ˜</div>
                    <div style="color: #666; font-size: 14px; line-height: 1.4;">
                        æ‰¾åˆ°å–·ç½ä½ç½®ï¼Œæ”¶é›†å–·ç½é“å…·ï¼
                    </div>
                </div>
                <button id="hide-spray-btn"
                        style="padding: 10px 20px; margin-right: 10px;
                               background: #2196F3; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;
                               transition: background-color 0.3s;">
                    éšè—æ ‡è®°
                </button>
                <button id="close-spray-btn"
                        style="padding: 10px 20px; 
                               background: #f44336; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;
                               transition: background-color 0.3s;">
                    å…³é—­
                </button>
            `;

            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(popup);

            // æ·»åŠ éšè—æŒ‰é’®äº‹ä»¶ç›‘å¬
            const hideBtn = popup.querySelector('#hide-spray-btn');
            hideBtn.addEventListener('click', () => {
                 // æ‰¾åˆ°å¯¹åº”çš„æ ‡è®°å¹¶è®¾ç½®é€æ˜åº¦ä¸º25%
                 document.querySelectorAll('.item-marker').forEach(marker => {
                     const img = marker.querySelector('img');
                     if (img && img.src && img.src.includes('spray') && marker.dataset.index == index) {
                         marker.style.opacity = '0.25';
                         // å°†éšè—æŒ‰é’®æ”¹ä¸ºæ˜¾ç¤ºæŒ‰é’®
                         hideBtn.textContent = 'æ˜¾ç¤º';
                         hideBtn.style.background = '#4CAF50';
                         hideBtn.id = 'show-spray-btn';
                           
                         // ç§»é™¤æ—§çš„ç‚¹å‡»äº‹ä»¶ï¼Œæ·»åŠ æ–°çš„æ˜¾ç¤ºäº‹ä»¶
                         const newShowBtn = hideBtn.cloneNode(true);
                         hideBtn.replaceWith(newShowBtn);
                         newShowBtn.addEventListener('click', () => {
                             // æ¢å¤é€æ˜åº¦ä¸º100%
                             const currentMarker = document.querySelector(`.item-marker[data-index="${index}"]`);
                             if (currentMarker) {
                                 currentMarker.style.opacity = '1';
                             }
                             popup.remove();
                         });
                     }
                 });
             });

            // æ·»åŠ å…³é—­æŒ‰é’®äº‹ä»¶ç›‘å¬
            const closeBtn = popup.querySelector('#close-spray-btn');
            closeBtn.addEventListener('click', () => {
                popup.remove();
            });

            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
            popup.addEventListener('click', (e) => e.stopPropagation());
            
            // ä½¿ç”¨setTimeoutå»¶è¿Ÿæ·»åŠ documentç‚¹å‡»äº‹ä»¶ï¼Œé¿å…ç«‹å³è§¦å‘
            setTimeout(() => {
                const closePopupHandler = (e) => {
                    if (!popup.contains(e.target)) {
                        popup.remove();
                        document.removeEventListener('click', closePopupHandler);
                    }
                };
                document.addEventListener('click', closePopupHandler);
            }, 100);
        }

        // æ˜¾ç¤ºç‰¹æŠ€è·³è·ƒç‚¹å¼¹çª—
        function showStuntJumpsImage(index) {
            // åºå·ä»1å¼€å§‹
            const sequenceNumber = index + 1;
            const imageUrl = `https://eo-gta-maps.antwen.com/collectibles_images/stunt_jumps/stunt_jumps_${sequenceNumber}.webp`;
            
            // åˆ›å»ºå¼¹çª—
            const popup = document.createElement('div');
            popup.className = 'stunt-jumps-popup';
            popup.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                border: 3px solid #388E3C;
                border-radius: 12px;
                padding: 20px;
                z-index: 10000;
                max-width: 80vw;
                max-height: 80vh;
                box-shadow: 0 8px 32px rgba(0,0,0,0.3);
                font-family: Arial, sans-serif;
                text-align: center;
            `;

            // å¼¹çª—å†…å®¹
            popup.innerHTML = `
                <div style="margin-bottom: 15px; font-size: 20px; font-weight: bold; color: #388E3C;">
                    ğŸš€ ç‰¹æŠ€è·³è·ƒç‚¹ #${sequenceNumber}
                </div>
                <img src="${imageUrl}"
                     alt="ç‰¹æŠ€è·³è·ƒç‚¹ #${sequenceNumber}"
                     style="max-width: 100%; max-height: 60vh; border-radius: 8px; margin-bottom: 15px;">
                <div style="margin-bottom: 15px; color: #666; font-size: 14px;">
                    å¯åœ¨ä¸Šå›¾ä½ç½®æ‰¾åˆ°ï¼
                </div>
                <div style="margin: 15px 0; padding: 12px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #388E3C;">
                    <div style="font-weight: bold; color: #388E3C; margin-bottom: 5px;">ğŸ¯ æŒ‘æˆ˜è¯´æ˜</div>
                    <div style="color: #666; font-size: 14px; line-height: 1.4;">
                        é©¾é©¶è½¦è¾†å®Œæˆç‰¹æŠ€è·³è·ƒï¼Œè·å¾—é«˜åˆ†å’Œå¥–åŠ±ï¼
                    </div>
                </div>
                <button id="hide-stunt-jumps-btn"
                        style="padding: 10px 20px; margin-right: 10px;
                               background: #388E3C; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;
                               transition: background-color 0.3s;">
                    éšè—æ ‡è®°
                </button>
                <button id="close-stunt-jumps-btn"
                        style="padding: 10px 20px; 
                               background: #f44336; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;
                               transition: background-color 0.3s;">
                    å…³é—­
                </button>
            `;

            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(popup);

            // æ·»åŠ éšè—æŒ‰é’®äº‹ä»¶ç›‘å¬
            const hideBtn = popup.querySelector('#hide-stunt-jumps-btn');
            hideBtn.addEventListener('click', () => {
                 // æ‰¾åˆ°å¯¹åº”çš„æ ‡è®°å¹¶è®¾ç½®é€æ˜åº¦ä¸º25%
                 document.querySelectorAll('.item-marker').forEach(marker => {
                     const img = marker.querySelector('img');
                     if (img && img.src && img.src.includes('stunt_jumps') && marker.dataset.index == index) {
                         marker.style.opacity = '0.25';
                         // å°†éšè—æŒ‰é’®æ”¹ä¸ºæ˜¾ç¤ºæŒ‰é’®
                         hideBtn.textContent = 'æ˜¾ç¤º';
                         hideBtn.style.background = '#2196F3';
                         hideBtn.id = 'show-stunt-jumps-btn';
                          
                         // ç§»é™¤æ—§çš„ç‚¹å‡»äº‹ä»¶ï¼Œæ·»åŠ æ–°çš„æ˜¾ç¤ºäº‹ä»¶
                         const newShowBtn = hideBtn.cloneNode(true);
                         hideBtn.replaceWith(newShowBtn);
                         newShowBtn.addEventListener('click', () => {
                             // æ¢å¤é€æ˜åº¦ä¸º100%
                             const currentMarker = document.querySelector(`.item-marker[data-index="${index}"]`);
                             if (currentMarker) {
                                 currentMarker.style.opacity = '1';
                             }
                             popup.remove();
                         });
                     }
                 });
             });

            // æ·»åŠ å…³é—­æŒ‰é’®äº‹ä»¶ç›‘å¬
            const closeBtn = popup.querySelector('#close-stunt-jumps-btn');
            closeBtn.addEventListener('click', () => {
                popup.remove();
            });

            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
            popup.addEventListener('click', (e) => e.stopPropagation());
            
            // ä½¿ç”¨setTimeoutå»¶è¿Ÿæ·»åŠ documentç‚¹å‡»äº‹ä»¶ï¼Œé¿å…ç«‹å³è§¦å‘
            setTimeout(() => {
                const closePopupHandler = (e) => {
                    if (!popup.contains(e.target)) {
                        popup.remove();
                        document.removeEventListener('click', closePopupHandler);
                    }
                };
                document.addEventListener('click', closePopupHandler);
            }, 100);
        }

        function showSnowmenImage(index) {
            // åºå·ä»1å¼€å§‹
            const sequenceNumber = index + 1;
            const imageUrl = `https://eo-gta-maps.antwen.com/collectibles_images/snowmen/snowmen_${sequenceNumber}.webp`;
            
            // åˆ›å»ºå¼¹çª—
            const popup = document.createElement('div');
            popup.className = 'snowmen-popup';
            popup.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                border: 3px solid #03A9F4;
                border-radius: 12px;
                padding: 20px;
                z-index: 10000;
                max-width: 80vw;
                max-height: 80vh;
                box-shadow: 0 8px 32px rgba(0,0,0,0.3);
                font-family: Arial, sans-serif;
                text-align: center;
            `;

            // å¼¹çª—å†…å®¹
            popup.innerHTML = `
                <div style="margin-bottom: 15px; font-size: 20px; font-weight: bold; color: #0288D1;">
                    â›„ é›ªäºº #${sequenceNumber}
                </div>
                <img src="${imageUrl}" 
                     alt="é›ªäºº #${sequenceNumber}" 
                     style="max-width: 100%; max-height: 60vh; border-radius: 8px; margin-bottom: 15px;">
                <div style="margin-bottom: 15px; color: #666; font-size: 14px;">
                    å¯åœ¨ä¸Šå›¾ä½ç½®æ‰¾åˆ°ï¼
                </div>
                <div style="margin: 15px 0; padding: 12px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #03A9F4;">
                    <div style="font-weight: bold; color: #0288D1; margin-bottom: 5px;">ğŸ¯ æ”¶é›†å¥–åŠ±</div>
                    <div style="color: #666; font-size: 14px; line-height: 1.4;">
                        æ”¶é›†æ‰€æœ‰é›ªäººå¯è·å¾—å†¬å­£ä¸»é¢˜å¥–åŠ±
                    </div>
                </div>
                <button id="hide-snowmen-btn" 
                        style="padding: 10px 20px; margin-right: 10px;
                               background: #03A9F4; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;
                               transition: background-color 0.3s;">
                    éšè—æ ‡è®°
                </button>
                <button id="close-snowmen-btn" 
                        style="padding: 10px 20px; 
                               background: #f44336; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;
                               transition: background-color 0.3s;">
                    å…³é—­
                </button>
            `;

            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(popup);

            // æ·»åŠ éšè—æŒ‰é’®äº‹ä»¶ç›‘å¬
            const hideBtn = popup.querySelector('#hide-snowmen-btn');
            hideBtn.addEventListener('click', () => {
                 // æ‰¾åˆ°å¯¹åº”çš„æ ‡è®°å¹¶è®¾ç½®é€æ˜åº¦ä¸º25%
                 document.querySelectorAll('.item-marker').forEach(marker => {
                     const img = marker.querySelector('img');
                     if (img && img.src && img.src.includes('snowmen') && marker.dataset.index == index) {
                         marker.style.opacity = '0.25';
                         // å°†éšè—æŒ‰é’®æ”¹ä¸ºæ˜¾ç¤ºæŒ‰é’®
                         hideBtn.textContent = 'æ˜¾ç¤º';
                         hideBtn.style.background = '#2196F3';
                         hideBtn.id = 'show-snowmen-btn';
                         
                         // ç§»é™¤æ—§çš„ç‚¹å‡»äº‹ä»¶ï¼Œæ·»åŠ æ–°çš„æ˜¾ç¤ºäº‹ä»¶
                         const newShowBtn = hideBtn.cloneNode(true);
                         hideBtn.replaceWith(newShowBtn);
                         newShowBtn.addEventListener('click', () => {
                             // æ¢å¤é€æ˜åº¦ä¸º100%
                             const currentMarker = document.querySelector(`.item-marker[data-index="${index}"]`);
                             if (currentMarker) {
                                 currentMarker.style.opacity = '1';
                             }
                             popup.remove();
                         });
                     }
                 });
             });

            // æ·»åŠ å…³é—­æŒ‰é’®äº‹ä»¶ç›‘å¬
            const closeBtn = popup.querySelector('#close-snowmen-btn');
            closeBtn.addEventListener('click', () => {
                popup.remove();
            });

            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
            popup.addEventListener('click', (e) => e.stopPropagation());
            
            // ä½¿ç”¨setTimeoutå»¶è¿Ÿæ·»åŠ documentç‚¹å‡»äº‹ä»¶ï¼Œé¿å…ç«‹å³è§¦å‘
            setTimeout(() => {
                const closePopupHandler = (e) => {
                    if (!popup.contains(e.target)) {
                        popup.remove();
                        document.removeEventListener('click', closePopupHandler);
                    }
                };
                document.addEventListener('click', closePopupHandler);
            }, 100);
        }

        // æ˜¾ç¤ºè·³ä¼å¼¹çª—
        function showSkydivesPopup(item, index) {
            // åˆ›å»ºå¼¹çª—
            const popup = document.createElement('div');
            popup.className = 'skydives-popup';
            popup.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                border: 3px solid #2196F3;
                border-radius: 12px;
                padding: 20px;
                z-index: 10000;
                max-width: 400px;
                max-height: 80vh;
                box-shadow: 0 8px 32px rgba(0,0,0,0.3);
                font-family: Arial, sans-serif;
                text-align: center;
            `;

            // å¼¹çª—å†…å®¹
            popup.innerHTML = `
                <div style="margin-bottom: 20px; font-size: 24px; font-weight: bold; color: #2196F3;">
                    ğŸª‚ è·³ä¼æŒ‘æˆ˜
                </div>
                <div style="margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #2196F3;">
                    <div style="font-weight: bold; color: #2196F3; margin-bottom: 8px; font-size: 16px;">ğŸ—ºï¸ åœ°ç‚¹</div>
                    <div style="color: #333; font-size: 18px; margin-bottom: 15px;">${item.name || 'æœªçŸ¥åœ°ç‚¹'}</div>
                </div>
                
                <div style="margin: 15px 0; padding: 12px; background: #e3f2fd; border-radius: 6px; color: #1565c0; font-size: 14px; line-height: 1.6;">
                    ğŸ† <strong>æ¯æ—¥è·³ä¼æŒ‘æˆ˜</strong><br>
                    â€¢ æ¯å¤©å…±æœ‰10ä¸ªè·³ä¼ä½ç½®<br>
                    â€¢ å®Œæˆå¯è·å¾—<strong>ç»éªŒå€¼</strong>å’Œ<strong>æ¸¸æˆå¸å¥–åŠ±</strong><br>
                    â€¢ ä»é«˜ç©ºè·³ä¸‹ï¼Œä½“éªŒæé™åˆºæ¿€ï¼
                </div>
                
                <button id="close-skydive-popup-btn" 
                        style="padding: 12px 24px; 
                               background: #2196F3; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;
                               font-weight: bold;
                               transition: background-color 0.3s;
                               margin-right: 10px;">
                    å…³é—­
                </button>
                <button id="hide-skydive-marker-btn" 
                        style="padding: 12px 24px; 
                               background: #666; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;
                               transition: background-color 0.3s;">
                    éšè—æ ‡è®°
                </button>
            `;

            // æ·»åŠ å…³é—­æŒ‰é’®äº‹ä»¶ç›‘å¬
            const closeBtn = popup.querySelector('#close-skydive-popup-btn');
            closeBtn.addEventListener('click', () => {
                popup.remove();
            });

            // æ·»åŠ éšè—æŒ‰é’®äº‹ä»¶ç›‘å¬
            const hideBtn = popup.querySelector('#hide-skydive-marker-btn');
            hideBtn.addEventListener('click', () => {
                // æ‰¾åˆ°å¯¹åº”çš„è·³ä¼æ ‡è®°å¹¶è®¾ç½®é€æ˜åº¦ä¸º25%
                const skydiveMarkers = document.querySelectorAll('.item-marker');
                skydiveMarkers.forEach(marker => {
                    const img = marker.querySelector('img');
                    if (img && img.src && img.src.includes('skydive.png') && marker.dataset.index == index) {
                        marker.style.opacity = '0.25';
                        popup.remove();
                    }
                });
            });

            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(popup);

            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
            popup.addEventListener('click', (e) => e.stopPropagation());
            
            // ä½¿ç”¨setTimeoutå»¶è¿Ÿæ·»åŠ documentç‚¹å‡»äº‹ä»¶ï¼Œé¿å…ç«‹å³è§¦å‘
            setTimeout(() => {
                const closePopupHandler = (e) => {
                    if (!popup.contains(e.target)) {
                        popup.remove();
                        document.removeEventListener('click', closePopupHandler);
                    }
                };
                document.addEventListener('click', closePopupHandler);
            }, 100);
        }

        // æ˜¾ç¤ºæ°æ‹‰å¾·åŒ…è£¹å›¾ç‰‡å¼¹çª—
        function showDeadDropImage(index) {
            // åºå·ä»1å¼€å§‹
            const sequenceNumber = index + 1;
            const imageUrl = `https://eo-gta-maps.antwen.com/collectibles_images/dead_drop/dead_drop_${sequenceNumber}.webp`;
            
            // åˆ›å»ºå¼¹çª—
            const popup = document.createElement('div');
            popup.className = 'dead-drop-popup';
            popup.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                border: 3px solid #9C6EAF;
                border-radius: 12px;
                padding: 20px;
                z-index: 10000;
                max-width: 80vw;
                max-height: 80vh;
                box-shadow: 0 8px 32px rgba(0,0,0,0.3);
                font-family: Arial, sans-serif;
                text-align: center;
            `;

            // å¼¹çª—å†…å®¹
            popup.innerHTML = `
                <div style="margin-bottom: 15px; font-size: 20px; font-weight: bold; color: #9C6EAF;">
                    ğŸ“¦ æ°æ‹‰å¾·åŒ…è£¹ #${sequenceNumber}
                </div>
                <img src="${imageUrl}" 
                     alt="æ°æ‹‰å¾·åŒ…è£¹ #${sequenceNumber}" 
                     style="max-width: 100%; max-height: 60vh; border-radius: 8px; margin-bottom: 15px;">
                <div style="margin-bottom: 15px; color: #666; font-size: 14px;">
                    å¯åœ¨ä¸Šå›¾ä½ç½®æ‰¾åˆ°ï¼
                </div>
                <div style="margin: 15px 0; padding: 12px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #9C6EAF;">
                    <div style="font-weight: bold; color: #9C6EAF; margin-bottom: 5px;">ğŸ¯ ä»»åŠ¡è¯´æ˜</div>
                    <div style="color: #666; font-size: 14px; line-height: 1.4;">
                        æ°æ‹‰å¾·æä¾›çš„ç§˜å¯†åŒ…è£¹æŠ•é€’ç‚¹ï¼Œå®Œæˆå¯è·å¾—ä¸°åšå¥–åŠ±
                    </div>
                </div>
                <button id="hide-dead-drop-btn" 
                        style="padding: 10px 20px; margin-right: 10px;
                               background: #9C6EAF; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;
                               transition: background-color 0.3s;">
                    éšè—æ ‡è®°
                </button>
                <button id="close-dead-drop-btn" 
                        style="padding: 10px 20px; 
                               background: #f44336; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;
                               transition: background-color 0.3s;">
                    å…³é—­
                </button>
                
            `;

            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(popup);

            // æ·»åŠ éšè—æŒ‰é’®äº‹ä»¶ç›‘å¬
            const hideBtn = popup.querySelector('#hide-dead-drop-btn');
            hideBtn.addEventListener('click', () => {
                 // æ‰¾åˆ°å¯¹åº”çš„æ ‡è®°å¹¶è®¾ç½®é€æ˜åº¦ä¸º25%
                 document.querySelectorAll('.item-marker').forEach(marker => {
                     const img = marker.querySelector('img');
                     if (img && img.src && img.src.includes('dead_drop') && marker.dataset.index == index) {
                         marker.style.opacity = '0.25';
                         // å°†éšè—æŒ‰é’®æ”¹ä¸ºæ˜¾ç¤ºæŒ‰é’®
                         hideBtn.textContent = 'æ˜¾ç¤º';
                         hideBtn.style.background = '#2196F3';
                         hideBtn.id = 'show-dead-drop-btn';
                         
                         // ç§»é™¤æ—§çš„ç‚¹å‡»äº‹ä»¶ï¼Œæ·»åŠ æ–°çš„æ˜¾ç¤ºäº‹ä»¶
                         const newShowBtn = hideBtn.cloneNode(true);
                         hideBtn.replaceWith(newShowBtn);
                         newShowBtn.addEventListener('click', () => {
                             // æ¢å¤é€æ˜åº¦ä¸º100%
                             const currentMarker = document.querySelector(`.item-marker[data-index="${index}"]`);
                             if (currentMarker) {
                                 currentMarker.style.opacity = '1';
                             }
                             popup.remove();
                         });
                     }
                 });
             });

            // æ·»åŠ å…³é—­æŒ‰é’®äº‹ä»¶ç›‘å¬
            const closeBtn = popup.querySelector('#close-dead-drop-btn');
            closeBtn.addEventListener('click', () => {
                popup.remove();
            });

            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
            popup.addEventListener('click', (e) => e.stopPropagation());
            
            // ä½¿ç”¨setTimeoutå»¶è¿Ÿæ·»åŠ documentç‚¹å‡»äº‹ä»¶ï¼Œé¿å…ç«‹å³è§¦å‘
            setTimeout(() => {
                const closePopupHandler = (e) => {
                    if (!popup.contains(e.target)) {
                        popup.remove();
                        document.removeEventListener('click', closePopupHandler);
                    }
                };
                document.addEventListener('click', closePopupHandler);
            }, 100);
        }

        // æ˜¾ç¤ºæœ‰æœºåŠäº§å“å›¾ç‰‡å¼¹çª—
        function showOrganicFarmImage(index) {
            // åºå·ä»1å¼€å§‹
            const sequenceNumber = index + 1;
            const imageUrl = `https://eo-gta-maps.antwen.com/collectibles_images/ld_organics/ld_organics_${sequenceNumber.toString().padStart(2, '0')}.webp`;
            
            // åˆ›å»ºå¼¹çª—
            const popup = document.createElement('div');
            popup.className = 'organic-farm-popup';
            popup.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                border: 3px solid #4CAF50;
                border-radius: 12px;
                padding: 20px;
                z-index: 10000;
                max-width: 80vw;
                max-height: 80vh;
                box-shadow: 0 8px 32px rgba(0,0,0,0.3);
                font-family: Arial, sans-serif;
                text-align: center;
            `;

            // å¼¹çª—å†…å®¹
            popup.innerHTML = `
                <div style="margin-bottom: 15px; font-size: 20px; font-weight: bold; color: #2E7D32;">
                    ğŸŒ¿ æœ‰æœºåŠäº§å“ #${sequenceNumber}
                </div>
                <img src="${imageUrl}" 
                     alt="æœ‰æœºåŠäº§å“ #${sequenceNumber}" 
                     style="max-width: 100%; max-height: 60vh; border-radius: 8px; margin-bottom: 15px;">
                <div style="margin-bottom: 15px; color: #666; font-size: 14px;">
                    å¯åœ¨ä¸Šå›¾ä½ç½®æ‰¾åˆ°ï¼
                </div>
                <div style="margin: 15px 0; padding: 12px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #4CAF50;">
                    <div style="font-weight: bold; color: #2E7D32; margin-bottom: 5px;">ğŸ¯ æ”¶é›†å¥–åŠ±</div>
                    <div style="color: #666; font-size: 14px; line-height: 1.4;">
                        æ”¶é›†å…¨éƒ¨æœ‰æœºåŠäº§å“å¯è·å¾—ç‰¹æ®Šè¡£æœå’Œå¸½å­å¥–åŠ±ï¼
                    </div>
                </div>
                <button id="hide-organic-popup-btn" 
                        style="padding: 10px 20px; margin-right: 10px;
                               background: #4CAF50; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;
                               transition: background-color 0.3s;">
                    éšè—æ ‡è®°
                </button>
                <button id="close-organic-popup-btn" 
                        style="padding: 10px 20px; 
                               background: #f44336; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;
                               transition: background-color 0.3s;">
                    å…³é—­
                </button>
            `;

            // æ·»åŠ éšè—æŒ‰é’®äº‹ä»¶ç›‘å¬
            const hideBtn = popup.querySelector('#hide-organic-popup-btn');
            hideBtn.addEventListener('click', () => {
                 // æ‰¾åˆ°å¯¹åº”çš„æ ‡è®°å¹¶è®¾ç½®é€æ˜åº¦ä¸º25%
                 document.querySelectorAll('.item-marker').forEach(marker => {
                     const img = marker.querySelector('img');
                     if (img && img.src && img.src.includes('organic_farm') && marker.dataset.index == index) {
                         marker.style.opacity = '0.25';
                         // å°†éšè—æŒ‰é’®æ”¹ä¸ºæ˜¾ç¤ºæŒ‰é’®
                         hideBtn.textContent = 'æ˜¾ç¤º';
                         hideBtn.style.background = '#2196F3';
                         hideBtn.id = 'show-organic-popup-btn';
                         
                         // ç§»é™¤æ—§çš„ç‚¹å‡»äº‹ä»¶ï¼Œæ·»åŠ æ–°çš„æ˜¾ç¤ºäº‹ä»¶
                         const newShowBtn = hideBtn.cloneNode(true);
                         hideBtn.replaceWith(newShowBtn);
                         newShowBtn.addEventListener('click', () => {
                             // æ¢å¤é€æ˜åº¦ä¸º100%
                             const currentMarker = document.querySelector(`.item-marker[data-index="${index}"]`);
                             if (currentMarker) {
                                 currentMarker.style.opacity = '1';
                             }
                             popup.remove();
                         });
                     }
                 });
             });

            // æ·»åŠ å…³é—­æŒ‰é’®äº‹ä»¶ç›‘å¬
            const closeBtn = popup.querySelector('#close-organic-popup-btn');
            closeBtn.addEventListener('click', () => {
                popup.remove();
            });

            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(popup);

            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
            popup.addEventListener('click', (e) => e.stopPropagation());
            
            // ä½¿ç”¨setTimeoutå»¶è¿Ÿæ·»åŠ documentç‚¹å‡»äº‹ä»¶ï¼Œé¿å…ç«‹å³è§¦å‘
            setTimeout(() => {
                const closePopupHandler = (e) => {
                    if (!popup.contains(e.target)) {
                        popup.remove();
                        document.removeEventListener('click', closePopupHandler);
                    }
                };
                document.addEventListener('click', closePopupHandler);
            }, 100);
        }

    // é¡¶éƒ¨ old select å·²ç§»é™¤ï¼›ä¾§è¾¹æ å¤é€‰æ¡†ä¸ reset æŒ‰é’®ç®¡ç† activeItemTypes

        // åœ°å›¾äº‹ä»¶
        map.on('move', updateTilePanePosition); // æ”¹ä¸ºmoveäº‹ä»¶å®ç°å®æ—¶è·Ÿéš
        map.on('moveend', updateTilePanePosition);
        map.on('zoomend', () => {
            const z = map.getZoom();
            const centerPixel = map.project(map.getCenter(), z);
            resetViewForZoom(z, { x: centerPixel.x, y: centerPixel.y });
            updateTilePanePosition();
            probeTilesForStyleAndZoom(currentStyle, z);
        });

        // åœ°å›¾ç‚¹å‡»äº‹ä»¶ - æ£€æµ‹åæ ‡å€¼
        const mapContainer = document.getElementById('map-container');
        mapContainer.addEventListener('click', (e) => {
            // è·å–ç‚¹å‡»ä½ç½®ç›¸å¯¹äºåœ°å›¾å®¹å™¨çš„åæ ‡
            const rect = mapContainer.getBoundingClientRect();
            const clickX = e.clientX - rect.left;
            const clickY = e.clientY - rect.top;
            
            const z = map.getZoom();
            const level = getLevelByZoom(z);
            if (!level) return;
            
            const totalWidth = level.cols * TILE_SIZE;
            const totalHeight = level.rows * TILE_SIZE;
            
            // è·å–åœ°å›¾å®¹å™¨çš„å˜æ¢ä¿¡æ¯
            const transform = tilePaneDom.style.transform;
            const translateX = parseInt(transform.match(/translate\(([-\d.]+)px/)[1]) || 0;
            const translateY = parseInt(transform.match(/translate\([-\d.]+px,\s*([-\d.]+)px/)[1]) || 0;
            
            // è®¡ç®—ç‚¹å‡»ä½ç½®åœ¨ç“¦ç‰‡å®¹å™¨ä¸­çš„åƒç´ åæ ‡
            const tileX = clickX - translateX;
            const tileY = clickY - translateY;
            
            // å°†åƒç´ åæ ‡è½¬æ¢ä¸ºæ¸¸æˆåæ ‡
            const percentX = tileX / totalWidth;
            const percentY = tileY / totalHeight;
            
            const gameX = GAME_LEFT + percentX * (GAME_RIGHT - GAME_LEFT);
            const gameY = GAME_TOP - percentY * (GAME_TOP - GAME_BOTTOM);
            
            console.log('ç‚¹å‡»åæ ‡:', {
                container: { x: clickX, y: clickY },
                tile: { x: tileX, y: tileY },
                game: { x: gameX.toFixed(2), y: gameY.toFixed(2) }
            });

            // æ£€æµ‹æ˜¯å¦ç‚¹å‡»åœ¨æ­¦å™¨å¢å‹è½¦é™„è¿‘
            checkGunVanClick(gameX, gameY);
            
            // æ£€æµ‹æ˜¯å¦ç‚¹å‡»åœ¨è¡—å¤´æ¯’è´©é™„è¿‘
            checkStreetDealersClick(gameX, gameY);
            
            // æ£€æµ‹æ˜¯å¦ç‚¹å‡»åœ¨æœ‰æœºåŠäº§å“é™„è¿‘
            checkOrganicFarmClick(gameX, gameY);
            
            // æ£€æµ‹æ˜¯å¦ç‚¹å‡»åœ¨ä¿¡å·å¹²æ‰°å™¨é™„è¿‘
            checkSignalJammerClick(gameX, gameY);
            
            // æ£€æµ‹æ˜¯å¦ç‚¹å‡»åœ¨å—ç“œç¯é™„è¿‘
            checkJackOLanternClick(gameX, gameY);
            
            // æ£€æµ‹æ˜¯å¦ç‚¹å‡»åœ¨çº¸ç‰Œé™„è¿‘
            checkPlayingCardsClick(gameX, gameY);
            
            // æ£€æµ‹æ˜¯å¦ç‚¹å‡»åœ¨åäº‘åé›¾é¦†äº§å“é™„è¿‘
            checkSmokeProductClick(gameX, gameY);
            
            // æ£€æµ‹æ˜¯å¦ç‚¹å‡»åœ¨æ‰‹åŠé™„è¿‘
            checkActionFiguresClick(gameX, gameY);
            
            // æ£€æµ‹æ˜¯å¦ç‚¹å‡»åœ¨å…ƒå®é™„è¿‘
            checkYuanbaoClick(gameX, gameY);
            
            // æ£€æµ‹æ˜¯å¦ç‚¹å‡»åœ¨æ²‰èˆ¹é™„è¿‘
            checkShipwrecksClick(gameX, gameY);
            
            // æ£€æµ‹æ˜¯å¦ç‚¹å‡»åœ¨ç”µè¯æš—æ€é™„è¿‘
            checkPayphoneHitsClick(gameX, gameY);
            
            // æ£€æµ‹æ˜¯å¦ç‚¹å‡»åœ¨é«˜å°”å¤«çƒæ´é™„è¿‘
            checkGolfHolesClick(gameX, gameY);
            
            // æ£€æµ‹æ˜¯å¦ç‚¹å‡»åœ¨é›ªäººé™„è¿‘
            checkSnowmenClick(gameX, gameY);
            
            // æ£€æµ‹æ˜¯å¦ç‚¹å‡»åœ¨ç‰¹æŠ€è·³è·ƒç‚¹é™„è¿‘
            checkStuntJumpsClickNew(gameX, gameY);
            
            // æ£€æµ‹æ˜¯å¦ç‚¹å‡»åœ¨æ°æ‹‰å¾·åŒ…è£¹é™„è¿‘
            checkDeadDropClick(gameX, gameY);
            
            // æ£€æµ‹æ˜¯å¦ç‚¹å‡»åœ¨LSæ¶‚é¸¦é™„è¿‘
            checkLSTagsClick(gameX, gameY);
            
            // æ£€æµ‹æ˜¯å¦ç‚¹å‡»åœ¨å–·ç½é™„è¿‘
            checkSprayClickNew(gameX, gameY);
            
            // æ£€æµ‹æ˜¯å¦ç‚¹å‡»åœ¨RCæ—¶é—´æŒ‘æˆ˜èµ›é™„è¿‘
            checkRCTimeTrialClickNew(gameX, gameY);
            
            // æ£€æµ‹æ˜¯å¦ç‚¹å‡»åœ¨è‡ªè¡Œè½¦æ—¶é—´æŒ‘æˆ˜èµ›é™„è¿‘
            checkBikeTimeTrialClickNew(gameX, gameY);
            
            // æ£€æµ‹æ˜¯å¦ç‚¹å‡»åœ¨è·³ä¼é™„è¿‘
            checkSkydivesClickNew(gameX, gameY);
            
            // æ£€æµ‹æ˜¯å¦ç‚¹å‡»åœ¨è½¦è¡Œé™„è¿‘
            checkDealershipClick(gameX, gameY);
            
            // æ£€æµ‹æ˜¯å¦ç‚¹å‡»åœ¨å¸®æ´¾æ”»å‡»é™„è¿‘
            checkGangAttackClick(gameX, gameY);
        });

        // æ£€æµ‹æ­¦å™¨å¢å‹è½¦ç‚¹å‡»
        function checkGunVanClick(clickX, clickY) {
            const GUN_VAN_RADIUS = 100; // æ£€æµ‹åŠå¾„100å•ä½
            
            // æ£€æŸ¥å½“å‰æ˜¯å¦æ˜¾ç¤ºæ­¦å™¨å¢å‹è½¦ï¼ˆæ”¯æŒå¤šé€‰ï¼‰
            if (activeItemTypes.has('gun_van') && itemData.gun_van) {
                // æ£€æŸ¥ç‚¹å‡»ä½ç½®æ˜¯å¦åœ¨ä»»æ„æ­¦å™¨å¢å‹è½¦é™„è¿‘
                const nearbyVan = itemData.gun_van.find(van => {
                    const distance = Math.sqrt(Math.pow(van.x - clickX, 2) + Math.pow(van.y - clickY, 2));
                    return distance <= GUN_VAN_RADIUS;
                });

                if (nearbyVan) {
                    console.log('ç‚¹å‡»äº†æ­¦å™¨å¢å‹è½¦é™„è¿‘:', nearbyVan.name);
                    showGunVanWeapons();
                }
            }
        }

        // æ£€æµ‹è¡—å¤´æ¯’è´©ç‚¹å‡»
        function checkStreetDealersClick(clickX, clickY) {
            const STREET_DEALER_RADIUS = 100; // æ£€æµ‹åŠå¾„100å•ä½
            
            // æ£€æŸ¥å½“å‰æ˜¯å¦æ˜¾ç¤ºè¡—å¤´æ¯’è´©ï¼ˆæ”¯æŒå¤šé€‰ï¼‰
            if (activeItemTypes.has('street_dealers') && itemData.street_dealers) {
                // æ£€æŸ¥ç‚¹å‡»ä½ç½®æ˜¯å¦åœ¨ä»»æ„è¡—å¤´æ¯’è´©é™„è¿‘
                const nearbyDealer = itemData.street_dealers.find(dealer => {
                    const distance = Math.sqrt(Math.pow(dealer.x - clickX, 2) + Math.pow(dealer.y - clickY, 2));
                    return distance <= STREET_DEALER_RADIUS;
                });

                if (nearbyDealer) {
                    console.log('ç‚¹å‡»äº†è¡—å¤´æ¯’è´©é™„è¿‘:', nearbyDealer.name);
                    showStreetDealersInfo();
                }
            }
        }

        // æ£€æµ‹æœ‰æœºåŠäº§å“ç‚¹å‡»
        function checkOrganicFarmClick(clickX, clickY) {
            const ORGANIC_FARM_RADIUS = 100; // æ£€æµ‹åŠå¾„100å•ä½
            
            // æ£€æŸ¥å½“å‰æ˜¯å¦æ˜¾ç¤ºæœ‰æœºåŠäº§å“ï¼ˆæ”¯æŒå¤šé€‰ï¼‰
            if (activeItemTypes.has('ld_organics_products') && itemData.ld_organics_products) {
                // æ£€æŸ¥ç‚¹å‡»ä½ç½®æ˜¯å¦åœ¨ä»»æ„æœ‰æœºåŠäº§å“é™„è¿‘
                const nearbyProduct = itemData.ld_organics_products.find((product, index) => {
                    const distance = Math.sqrt(Math.pow(product.x - clickX, 2) + Math.pow(product.y - clickY, 2));
                    return distance <= ORGANIC_FARM_RADIUS;
                });

                if (nearbyProduct) {
                    console.log('ç‚¹å‡»äº†æœ‰æœºåŠäº§å“é™„è¿‘:', nearbyProduct.name);
                    // æ‰¾åˆ°å¯¹åº”çš„ç´¢å¼•
                    const productIndex = itemData.ld_organics_products.findIndex(product => 
                        product.x === nearbyProduct.x && product.y === nearbyProduct.y
                    );
                    showOrganicFarmImage(productIndex);
                }
            }
        }

        // æ£€æµ‹ä¿¡å·å¹²æ‰°å™¨ç‚¹å‡»
        function checkSignalJammerClick(clickX, clickY) {
            const SIGNAL_JAMMER_RADIUS = 100; // æ£€æµ‹åŠå¾„100å•ä½
            
            // æ£€æŸ¥å½“å‰æ˜¯å¦æ˜¾ç¤ºä¿¡å·å¹²æ‰°å™¨ï¼ˆæ”¯æŒå¤šé€‰ï¼‰
            if (activeItemTypes.has('signal_jammers') && itemData.signal_jammers) {
                // æ£€æŸ¥ç‚¹å‡»ä½ç½®æ˜¯å¦åœ¨ä»»æ„ä¿¡å·å¹²æ‰°å™¨é™„è¿‘
                const nearbyJammer = itemData.signal_jammers.find((jammer, index) => {
                    const distance = Math.sqrt(Math.pow(jammer.x - clickX, 2) + Math.pow(jammer.y - clickY, 2));
                    return distance <= SIGNAL_JAMMER_RADIUS;
                });

                if (nearbyJammer) {
                    console.log('ç‚¹å‡»äº†ä¿¡å·å¹²æ‰°å™¨é™„è¿‘:', nearbyJammer.name);
                    // æ‰¾åˆ°å¯¹åº”çš„ç´¢å¼•
                    const jammerIndex = itemData.signal_jammers.findIndex(jammer => 
                        jammer.x === nearbyJammer.x && jammer.y === nearbyJammer.y
                    );
                    showSignalJammerImage(jammerIndex);
                }
            }
        }

        // æ£€æµ‹å—ç“œç¯ç‚¹å‡»
        function checkJackOLanternClick(clickX, clickY) {
            const JACK_O_LANTERN_RADIUS = 100; // æ£€æµ‹åŠå¾„100å•ä½
            
            // æ£€æŸ¥å½“å‰æ˜¯å¦æ˜¾ç¤ºå—ç“œç¯ï¼ˆæ”¯æŒå¤šé€‰ï¼‰
            if (activeItemTypes.has('jack_o_lanterns') && itemData.jack_o_lanterns) {
                // æ£€æŸ¥ç‚¹å‡»ä½ç½®æ˜¯å¦åœ¨ä»»æ„å—ç“œç¯é™„è¿‘
                const nearbyLantern = itemData.jack_o_lanterns.find((lantern, index) => {
                    const distance = Math.sqrt(Math.pow(lantern.x - clickX, 2) + Math.pow(lantern.y - clickY, 2));
                    return distance <= JACK_O_LANTERN_RADIUS;
                });

                if (nearbyLantern) {
                    console.log('ç‚¹å‡»äº†å—ç“œç¯é™„è¿‘:', nearbyLantern.name);
                    // æ‰¾åˆ°å¯¹åº”çš„ç´¢å¼•
                    const lanternIndex = itemData.jack_o_lanterns.findIndex(lantern => 
                        lantern.x === nearbyLantern.x && lantern.y === nearbyLantern.y
                    );
                    showJackOLanternImage(lanternIndex);
                }
            }
        }
        
        // æ£€æµ‹LSæ¶‚é¸¦ç‚¹å‡»
        function checkLSTagsClick(clickX, clickY) {
            const LS_TAGS_RADIUS = 100; // æ£€æµ‹åŠå¾„100å•ä½
            
            // æ£€æŸ¥å½“å‰æ˜¯å¦æ˜¾ç¤ºLSæ¶‚é¸¦ï¼ˆæ”¯æŒå¤šé€‰ï¼‰
            if (activeItemTypes.has('ls_tags') && itemData.ls_tags) {
                // æ£€æŸ¥ç‚¹å‡»ä½ç½®æ˜¯å¦åœ¨ä»»æ„LSæ¶‚é¸¦é™„è¿‘
                const nearbyTag = itemData.ls_tags.find((tag, index) => {
                    const distance = Math.sqrt(Math.pow(tag.x - clickX, 2) + Math.pow(tag.y - clickY, 2));
                    return distance <= LS_TAGS_RADIUS;
                });

                if (nearbyTag) {
                    console.log('ç‚¹å‡»äº†LSæ¶‚é¸¦é™„è¿‘:', nearbyTag.name || `LSæ¶‚é¸¦ #${nearbyTag.sequenceNumber}`);
                    showLSTagsImage(nearbyTag);
                }
            }
        }
        
        // æ˜¾ç¤ºLSæ¶‚é¸¦å¼¹çª—
        function showLSTagsImage(tag) {
            // ä½¿ç”¨APIè¿”å›çš„ç¼–å·æ•°å­—
            const sequenceNumber = tag.sequenceNumber;
            const imageUrl = `https://eo-gta-maps.antwen.com/collectibles_images/ls_tags/ls_tags_${sequenceNumber}.webp`;
            
            // åˆ›å»ºå¼¹çª—
            const popup = document.createElement('div');
            popup.className = 'ls-tags-popup';
            popup.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                border: 3px solid #FF5722;
                border-radius: 12px;
                padding: 20px;
                z-index: 10000;
                max-width: 80vw;
                max-height: 80vh;
                box-shadow: 0 8px 32px rgba(0,0,0,0.3);
                font-family: Arial, sans-serif;
                text-align: center;
            `;

            // å¼¹çª—å†…å®¹
            popup.innerHTML = `
                <div style="margin-bottom: 15px; font-size: 20px; font-weight: bold; color: #E64A19;">
                    ğŸ¨ LSæ¶‚é¸¦ #${sequenceNumber}
                </div>
                <img src="${imageUrl}"
                     alt="LSæ¶‚é¸¦ #${sequenceNumber}"
                     style="max-width: 100%; max-height: 60vh; border-radius: 8px; margin-bottom: 15px;">
                <div style="margin-bottom: 15px; color: #666; font-size: 14px;">
                    å¯åœ¨ä¸Šå›¾ä½ç½®æ‰¾åˆ°ï¼
                </div>
                <div style="margin: 15px 0; padding: 12px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #FF5722;">
                    <div style="font-weight: bold; color: #E64A19; margin-bottom: 5px;">ğŸ¯ æ”¶é›†è¯´æ˜</div>
                    <div style="color: #666; font-size: 14px; line-height: 1.4;">
                        æ‰¾åˆ°å¹¶æ”¶é›†æ‰€æœ‰LSæ¶‚é¸¦ï¼Œè§£é”ç‹¬ç‰¹å¥–åŠ±ï¼
                    </div>
                </div>
                <button id="hide-ls-tags-btn"
                        style="padding: 10px 20px; margin-right: 10px;
                               background: #FF5722; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;
                               transition: background-color 0.3s;">
                    éšè—æ ‡è®°
                </button>
                <button id="close-ls-tags-btn"
                        style="padding: 10px 20px; 
                               background: #f44336; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;
                               transition: background-color 0.3s;">
                    å…³é—­
                </button>
            `;

            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(popup);

            // æ·»åŠ éšè—æŒ‰é’®äº‹ä»¶ç›‘å¬
            const hideBtn = popup.querySelector('#hide-ls-tags-btn');
            hideBtn.addEventListener('click', () => {
                 // æ‰¾åˆ°å¯¹åº”çš„æ ‡è®°å¹¶è®¾ç½®é€æ˜åº¦ä¸º25%
                 document.querySelectorAll('.item-marker').forEach(marker => {
                     const img = marker.querySelector('img');
                     const markerIndex = parseInt(marker.dataset.index);
                     const itemTag = itemData.ls_tags[markerIndex];
                     if (img && img.src && img.src.includes('ls_tags') && itemTag && itemTag.sequenceNumber === tag.sequenceNumber) {
                         marker.style.opacity = '0.25';
                         // å°†éšè—æŒ‰é’®æ”¹ä¸ºæ˜¾ç¤ºæŒ‰é’®
                         hideBtn.textContent = 'æ˜¾ç¤º';
                         hideBtn.style.background = '#2196F3';
                         hideBtn.id = 'show-ls-tags-btn';
                            
                         // ç§»é™¤æ—§çš„ç‚¹å‡»äº‹ä»¶ï¼Œæ·»åŠ æ–°çš„æ˜¾ç¤ºäº‹ä»¶
                         const newShowBtn = hideBtn.cloneNode(true);
                         hideBtn.replaceWith(newShowBtn);
                         newShowBtn.addEventListener('click', () => {
                             // æ¢å¤é€æ˜åº¦ä¸º100%
                             document.querySelectorAll('.item-marker').forEach(m => {
                                 const mImg = m.querySelector('img');
                                 const mIndex = parseInt(m.dataset.index);
                                 const mTag = itemData.ls_tags[mIndex];
                                 if (mImg && mImg.src && mImg.src.includes('ls_tags') && mTag && mTag.sequenceNumber === tag.sequenceNumber) {
                                     m.style.opacity = '1';
                                 }
                             });
                             popup.remove();
                         });
                     }
                 });
             });

            // æ·»åŠ å…³é—­æŒ‰é’®äº‹ä»¶ç›‘å¬
            const closeBtn = popup.querySelector('#close-ls-tags-btn');
            closeBtn.addEventListener('click', () => {
                popup.remove();
            });

            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
            popup.addEventListener('click', (e) => e.stopPropagation());
            
            // ä½¿ç”¨setTimeoutå»¶è¿Ÿæ·»åŠ documentç‚¹å‡»äº‹ä»¶ï¼Œé¿å…ç«‹å³è§¦å‘
            setTimeout(() => {
                const closePopupHandler = (e) => {
                    if (!popup.contains(e.target)) {
                        popup.remove();
                        document.removeEventListener('click', closePopupHandler);
                    }
                };
                document.addEventListener('click', closePopupHandler);
            }, 100);
        }
        
        // æ£€æµ‹çº¸ç‰Œç‚¹å‡»
        function checkPlayingCardsClick(clickX, clickY) {
            const PLAYING_CARDS_RADIUS = 100; // æ£€æµ‹åŠå¾„100å•ä½
            
            // æ£€æŸ¥å½“å‰æ˜¯å¦æ˜¾ç¤ºçº¸ç‰Œï¼ˆæ”¯æŒå¤šé€‰ï¼‰
            if (activeItemTypes.has('playing_cards') && itemData.playing_cards) {
                // æ£€æŸ¥ç‚¹å‡»ä½ç½®æ˜¯å¦åœ¨ä»»æ„çº¸ç‰Œé™„è¿‘
                const nearbyCard = itemData.playing_cards.find((card, index) => {
                    const distance = Math.sqrt(Math.pow(card.x - clickX, 2) + Math.pow(card.y - clickY, 2));
                    return distance <= PLAYING_CARDS_RADIUS;
                });

                if (nearbyCard) {
                    console.log('ç‚¹å‡»äº†çº¸ç‰Œé™„è¿‘:', nearbyCard.name);
                    // æ‰¾åˆ°å¯¹åº”çš„ç´¢å¼•
                    const cardIndex = itemData.playing_cards.findIndex(card => 
                        card.x === nearbyCard.x && card.y === nearbyCard.y
                    );
                    showPlayingCardsImage(cardIndex);
                }
            }
        }
        
        // æ£€æµ‹åäº‘åé›¾é¦†äº§å“ç‚¹å‡»
        function checkSmokeProductClick(clickX, clickY) {
            const SMOKE_PRODUCT_RADIUS = 100; // æ£€æµ‹åŠå¾„100å•ä½
            
            // æ£€æŸ¥å½“å‰æ˜¯å¦æ˜¾ç¤ºåäº‘åé›¾é¦†äº§å“ï¼ˆæ”¯æŒå¤šé€‰ï¼‰
            if (activeItemTypes.has('smoke_on_the_water_product') && itemData.smoke_on_the_water_product) {
                // æ£€æŸ¥ç‚¹å‡»ä½ç½®æ˜¯å¦åœ¨ä»»æ„åäº‘åé›¾é¦†äº§å“é™„è¿‘
                const nearbyProduct = itemData.smoke_on_the_water_product.find((product, index) => {
                    const distance = Math.sqrt(Math.pow(product.x - clickX, 2) + Math.pow(product.y - clickY, 2));
                    return distance <= SMOKE_PRODUCT_RADIUS;
                });

                if (nearbyProduct) {
                    console.log('ç‚¹å‡»äº†åäº‘åé›¾é¦†äº§å“é™„è¿‘:', nearbyProduct.name);
                    // æ‰¾åˆ°å¯¹åº”çš„ç´¢å¼•
                    const productIndex = itemData.smoke_on_the_water_product.findIndex(product => 
                        product.x === nearbyProduct.x && product.y === nearbyProduct.y
                    );
                    showSmokeProductImage(productIndex);
                }
            }
        }
        
        // æ£€æµ‹æ‰‹åŠç‚¹å‡»
        function checkActionFiguresClick(clickX, clickY) {
            const ACTION_FIGURES_RADIUS = 100; // æ£€æµ‹åŠå¾„100å•ä½
            
            // æ£€æŸ¥å½“å‰æ˜¯å¦æ˜¾ç¤ºæ‰‹åŠï¼ˆæ”¯æŒå¤šé€‰ï¼‰
            if (activeItemTypes.has('action_figures') && itemData.action_figures) {
                // æ£€æŸ¥ç‚¹å‡»ä½ç½®æ˜¯å¦åœ¨ä»»æ„æ‰‹åŠé™„è¿‘
                const nearbyFigure = itemData.action_figures.find((figure, index) => {
                    const distance = Math.sqrt(Math.pow(figure.x - clickX, 2) + Math.pow(figure.y - clickY, 2));
                    return distance <= ACTION_FIGURES_RADIUS;
                });

                if (nearbyFigure) {
                    console.log('ç‚¹å‡»äº†æ‰‹åŠé™„è¿‘:', nearbyFigure.name);
                    // æ‰¾åˆ°å¯¹åº”çš„ç´¢å¼•
                    const figureIndex = itemData.action_figures.findIndex(figure => 
                        figure.x === nearbyFigure.x && figure.y === nearbyFigure.y
                    );
                    showActionFiguresImage(figureIndex);
                }
            }
        }
        
        // æ£€æµ‹å…ƒå®ç‚¹å‡»
        function checkYuanbaoClick(clickX, clickY) {
            const YUANBAO_RADIUS = 100; // æ£€æµ‹åŠå¾„100å•ä½
            
            // æ£€æŸ¥å½“å‰æ˜¯å¦æ˜¾ç¤ºå…ƒå®ï¼ˆæ”¯æŒå¤šé€‰ï¼‰
            if (activeItemTypes.has('yuanbao') && itemData.yuanbao) {
                // æ£€æŸ¥ç‚¹å‡»ä½ç½®æ˜¯å¦åœ¨ä»»æ„å…ƒå®é™„è¿‘
                const nearbyYuanbao = itemData.yuanbao.find((yuanbao, index) => {
                    const distance = Math.sqrt(Math.pow(yuanbao.x - clickX, 2) + Math.pow(yuanbao.y - clickY, 2));
                    return distance <= YUANBAO_RADIUS;
                });

                if (nearbyYuanbao) {
                    console.log('ç‚¹å‡»äº†å…ƒå®é™„è¿‘:', nearbyYuanbao.name);
                    // æ‰¾åˆ°å¯¹åº”çš„ç´¢å¼•
                    const yuanbaoIndex = itemData.yuanbao.findIndex(yuanbao => 
                        yuanbao.x === nearbyYuanbao.x && yuanbao.y === nearbyYuanbao.y
                    );
                    showYuanbaoImage(yuanbaoIndex);
                }
            }
        }
        
        // æ£€æµ‹æ²‰èˆ¹ç‚¹å‡»
        function checkShipwrecksClick(clickX, clickY) {
            const SHIPWRECKS_RADIUS = 100; // æ£€æµ‹åŠå¾„100å•ä½
            
            // æ£€æŸ¥å½“å‰æ˜¯å¦æ˜¾ç¤ºæ²‰èˆ¹ï¼ˆæ”¯æŒå¤šé€‰ï¼‰
            if (activeItemTypes.has('shipwrecked') && itemData.shipwrecked) {
                // æ£€æŸ¥ç‚¹å‡»ä½ç½®æ˜¯å¦åœ¨ä»»æ„æ²‰èˆ¹é™„è¿‘
                const nearbyShipwreck = itemData.shipwrecked.find((shipwreck, index) => {
                    const distance = Math.sqrt(Math.pow(shipwreck.x - clickX, 2) + Math.pow(shipwreck.y - clickY, 2));
                    return distance <= SHIPWRECKS_RADIUS;
                });

                if (nearbyShipwreck) {
                    console.log('ç‚¹å‡»äº†æ²‰èˆ¹é™„è¿‘:', nearbyShipwreck.name);
                    // æ‰¾åˆ°å¯¹åº”çš„ç´¢å¼•
                    const shipwreckIndex = itemData.shipwrecked.findIndex(shipwreck => 
                        shipwreck.x === nearbyShipwreck.x && shipwreck.y === nearbyShipwreck.y
                    );
                    showShipwrecksImage(shipwreckIndex);
                }
            }
        }
        
        // æ£€æµ‹ç”µè¯æš—æ€ç‚¹å‡»
        function checkPayphoneHitsClick(clickX, clickY) {
            const PAYPHONE_HITS_RADIUS = 100; // æ£€æµ‹åŠå¾„100å•ä½
            
            // æ£€æŸ¥å½“å‰æ˜¯å¦æ˜¾ç¤ºç”µè¯æš—æ€ï¼ˆæ”¯æŒå¤šé€‰ï¼‰
            if (activeItemTypes.has('payphone_hits') && itemData.payphone_hits) {
                // æ£€æŸ¥ç‚¹å‡»ä½ç½®æ˜¯å¦åœ¨ä»»æ„ç”µè¯æš—æ€é™„è¿‘
                const nearbyPayphoneHit = itemData.payphone_hits.find((payphoneHit, index) => {
                    const distance = Math.sqrt(Math.pow(payphoneHit.x - clickX, 2) + Math.pow(payphoneHit.y - clickY, 2));
                    return distance <= PAYPHONE_HITS_RADIUS;
                });

                if (nearbyPayphoneHit) {
                    console.log('ç‚¹å‡»äº†ç”µè¯æš—æ€é™„è¿‘:', nearbyPayphoneHit.name);
                    // æ‰¾åˆ°å¯¹åº”çš„ç´¢å¼•
                    const payphoneHitIndex = itemData.payphone_hits.findIndex(payphoneHit => 
                        payphoneHit.x === nearbyPayphoneHit.x && payphoneHit.y === nearbyPayphoneHit.y
                    );
                    showPayphoneHitsImage(payphoneHitIndex);
                }
            }
        }
        
        // æ£€æµ‹é«˜å°”å¤«çƒæ´ç‚¹å‡»
        function checkGolfHolesClick(clickX, clickY) {
            const GOLF_HOLES_RADIUS = 100; // æ£€æµ‹åŠå¾„100å•ä½
            
            // æ£€æŸ¥å½“å‰æ˜¯å¦æ˜¾ç¤ºé«˜å°”å¤«çƒæ´ï¼ˆæ”¯æŒå¤šé€‰ï¼‰
            if (activeItemTypes.has('golf_holes') && itemData.golf_holes) {
                // æ£€æŸ¥ç‚¹å‡»ä½ç½®æ˜¯å¦åœ¨ä»»æ„é«˜å°”å¤«çƒæ´é™„è¿‘
                const nearbyGolfHole = itemData.golf_holes.find((golfHole, index) => {
                    const distance = Math.sqrt(Math.pow(golfHole.x - clickX, 2) + Math.pow(golfHole.y - clickY, 2));
                    return distance <= GOLF_HOLES_RADIUS;
                });

                if (nearbyGolfHole) {
                    console.log('ç‚¹å‡»äº†é«˜å°”å¤«çƒæ´é™„è¿‘:', nearbyGolfHole.name);
                    // æ‰¾åˆ°å¯¹åº”çš„ç´¢å¼•
                    const golfHoleIndex = itemData.golf_holes.findIndex(golfHole => 
                        golfHole.x === nearbyGolfHole.x && golfHole.y === nearbyGolfHole.y
                    );
                    showGolfHolesImage(golfHoleIndex);
                }
            }
        }
        
        // æ£€æµ‹é›ªäººç‚¹å‡»
        function checkSnowmenClick(clickX, clickY) {
            const SNOWMEN_RADIUS = 100; // æ£€æµ‹åŠå¾„100å•ä½
            
            // æ£€æŸ¥å½“å‰æ˜¯å¦æ˜¾ç¤ºé›ªäººï¼ˆæ”¯æŒå¤šé€‰ï¼‰
            if (activeItemTypes.has('snowmen') && itemData.snowmen) {
                // æ£€æŸ¥ç‚¹å‡»ä½ç½®æ˜¯å¦åœ¨ä»»æ„é›ªäººé™„è¿‘
                const nearbySnowman = itemData.snowmen.find((snowman, index) => {
                    const distance = Math.sqrt(Math.pow(snowman.x - clickX, 2) + Math.pow(snowman.y - clickY, 2));
                    return distance <= SNOWMEN_RADIUS;
                });

                if (nearbySnowman) {
                    console.log('ç‚¹å‡»äº†é›ªäººé™„è¿‘:', nearbySnowman.name);
                    // æ‰¾åˆ°å¯¹åº”çš„ç´¢å¼•
                    const snowmanIndex = itemData.snowmen.findIndex(snowman => 
                        snowman.x === nearbySnowman.x && snowman.y === nearbySnowman.y
                    );
                    showSnowmenImage(snowmanIndex);
                }
            }
        }
        
        // æ£€æµ‹æ°æ‹‰å¾·åŒ…è£¹ç‚¹å‡»
        function checkDeadDropClick(clickX, clickY) {
            const DEAD_DROP_RADIUS = 100; // æ£€æµ‹åŠå¾„100å•ä½
            
            // æ£€æŸ¥å½“å‰æ˜¯å¦æ˜¾ç¤ºæ°æ‹‰å¾·åŒ…è£¹ï¼ˆæ”¯æŒå¤šé€‰ï¼‰
            if (activeItemTypes.has('dead_drop') && itemData.dead_drop) {
                // æ£€æŸ¥ç‚¹å‡»ä½ç½®æ˜¯å¦åœ¨ä»»æ„æ°æ‹‰å¾·åŒ…è£¹é™„è¿‘
                const nearbyDeadDrop = itemData.dead_drop.find((deadDrop, index) => {
                    const distance = Math.sqrt(Math.pow(deadDrop.x - clickX, 2) + Math.pow(deadDrop.y - clickY, 2));
                    return distance <= DEAD_DROP_RADIUS;
                });

                if (nearbyDeadDrop) {
                    console.log('ç‚¹å‡»äº†æ°æ‹‰å¾·åŒ…è£¹é™„è¿‘:', nearbyDeadDrop.name);
                    // æ‰¾åˆ°å¯¹åº”çš„ç´¢å¼•
                    const deadDropIndex = itemData.dead_drop.findIndex(deadDrop => 
                        deadDrop.x === nearbyDeadDrop.x && deadDrop.y === nearbyDeadDrop.y
                    );
                    showDeadDropImage(deadDropIndex);
                }
            }
        }
        
        // æ£€æµ‹å–·ç½ä½ç½®ç‚¹å‡»
        function checkSprayClick(e) {
            const marker = e.target.closest('.item-marker');
            if (!marker) return;
            
            // è·å–ç´¢å¼•
            const index = parseInt(marker.dataset.index);
            
            // æ˜¾ç¤ºç‰©å“ä¿¡æ¯
            if (itemData.spray && itemData.spray[index]) {
                showItemInfo(itemData.spray[index], 'spray', index);
                
                // æ˜¾ç¤ºå–·ç½ä½ç½®å›¾ç‰‡å¼¹çª—
                showSprayImage(index);
            }
        }

        // æ£€æµ‹ç‰¹æŠ€è·³è·ƒç‚¹ç‚¹å‡»ï¼ˆç”¨äºåœ°å›¾åæ ‡æ£€æµ‹ï¼‰
        function checkStuntJumpsClickNew(clickX, clickY) {
            const STUNT_JUMP_RADIUS = 100; // æ£€æµ‹åŠå¾„100å•ä½
            
            // æ£€æŸ¥å½“å‰æ˜¯å¦æ˜¾ç¤ºç‰¹æŠ€è·³è·ƒç‚¹ï¼ˆæ”¯æŒå¤šé€‰ï¼‰
            if (activeItemTypes.has('stunt_jumps') && itemData.stunt_jumps) {
                // æ£€æŸ¥ç‚¹å‡»ä½ç½®æ˜¯å¦åœ¨ä»»æ„ç‰¹æŠ€è·³è·ƒç‚¹é™„è¿‘
                const nearbyJump = itemData.stunt_jumps.find(jump => {
                    const distance = Math.sqrt(Math.pow(jump.x - clickX, 2) + Math.pow(jump.y - clickY, 2));
                    return distance <= STUNT_JUMP_RADIUS;
                });

                if (nearbyJump) {
                    console.log('ç‚¹å‡»äº†ç‰¹æŠ€è·³è·ƒç‚¹é™„è¿‘:', nearbyJump.name);
                    // æ‰¾åˆ°å¯¹åº”çš„ç´¢å¼•
                    const jumpIndex = itemData.stunt_jumps.findIndex(jump => 
                        jump.x === nearbyJump.x && jump.y === nearbyJump.y
                    );
                    
                    showItemInfo(nearbyJump, 'stunt_jumps', jumpIndex);
                    
                    // æ˜¾ç¤ºç‰¹æŠ€è·³è·ƒç‚¹å›¾ç‰‡å¼¹çª—
                    if (typeof showStuntJumpsImage === 'function') {
                        showStuntJumpsImage(jumpIndex);
                    }
                }
            }
        }
        
        // æ£€æµ‹å–·ç½ç‚¹å‡»ï¼ˆç”¨äºåœ°å›¾åæ ‡æ£€æµ‹ï¼‰
        function checkSprayClickNew(clickX, clickY) {
            const SPRAY_RADIUS = 100; // æ£€æµ‹åŠå¾„100å•ä½
            
            // æ£€æŸ¥å½“å‰æ˜¯å¦æ˜¾ç¤ºå–·ç½ä½ç½®ï¼ˆæ”¯æŒå¤šé€‰ï¼‰
            if (activeItemTypes.has('spray') && itemData.spray) {
                // æ£€æŸ¥ç‚¹å‡»ä½ç½®æ˜¯å¦åœ¨ä»»æ„å–·ç½é™„è¿‘
                const nearbySpray = itemData.spray.find(spray => {
                    const distance = Math.sqrt(Math.pow(spray.x - clickX, 2) + Math.pow(spray.y - clickY, 2));
                    return distance <= SPRAY_RADIUS;
                });

                if (nearbySpray) {
                    console.log('ç‚¹å‡»äº†å–·ç½é™„è¿‘:', nearbySpray.name);
                    // æ‰¾åˆ°å¯¹åº”çš„ç´¢å¼•
                    const sprayIndex = itemData.spray.findIndex(spray => 
                        spray.x === nearbySpray.x && spray.y === nearbySpray.y
                    );

                    // æ˜¾ç¤ºç‰©å“ä¿¡æ¯
                    if (itemData.spray && itemData.spray[sprayIndex]) {
                        showItemInfo(itemData.spray[sprayIndex], 'spray', sprayIndex);
                        
                        // æ˜¾ç¤ºå–·ç½ä½ç½®å›¾ç‰‡å¼¹çª—
                        showSprayImage(sprayIndex);
                    }
                }
            }
        }

        // æ£€æµ‹RCæ—¶é—´æŒ‘æˆ˜èµ›ç‚¹å‡»ï¼ˆåæ ‡æ£€æµ‹ï¼‰
        function checkRCTimeTrialClickNew(clickX, clickY) {
            const RC_TIME_TRIAL_RADIUS = 100; // æ£€æµ‹åŠå¾„100å•ä½
            
            // æ£€æŸ¥å½“å‰æ˜¯å¦æ˜¾ç¤ºRCæ—¶é—´æŒ‘æˆ˜èµ›ï¼ˆæ”¯æŒå¤šé€‰ï¼‰
            if (activeItemTypes.has('rc_time_trial') && itemData.rc_time_trial) {
                // æ£€æŸ¥ç‚¹å‡»ä½ç½®æ˜¯å¦åœ¨ä»»æ„RCæ—¶é—´æŒ‘æˆ˜èµ›é™„è¿‘
                const nearbyTrial = itemData.rc_time_trial.find(trial => {
                    const distance = Math.sqrt(Math.pow(trial.x - clickX, 2) + Math.pow(trial.y - clickY, 2));
                    return distance <= RC_TIME_TRIAL_RADIUS;
                });

                if (nearbyTrial) {
                    console.log('ç‚¹å‡»äº†RCæ—¶é—´æŒ‘æˆ˜èµ›é™„è¿‘:', nearbyTrial.name);
                    // æ‰¾åˆ°å¯¹åº”çš„ç´¢å¼•
                    const trialIndex = itemData.rc_time_trial.findIndex(trial => 
                        trial.x === nearbyTrial.x && trial.y === nearbyTrial.y
                    );
                    showRCTimeTrialPopup(nearbyTrial, trialIndex);
                }
            }
        }

        // æ£€æµ‹è‡ªè¡Œè½¦æ—¶é—´æŒ‘æˆ˜èµ›ç‚¹å‡»ï¼ˆåæ ‡æ£€æµ‹ï¼‰
        function checkBikeTimeTrialClickNew(clickX, clickY) {
            const BIKE_TIME_TRIAL_RADIUS = 100; // æ£€æµ‹åŠå¾„100å•ä½
            
            // æ£€æŸ¥å½“å‰æ˜¯å¦æ˜¾ç¤ºè‡ªè¡Œè½¦æ—¶é—´æŒ‘æˆ˜èµ›ï¼ˆæ”¯æŒå¤šé€‰ï¼‰
            if (activeItemTypes.has('bike_time_trial') && itemData.bike_time_trial) {
                // æ£€æŸ¥ç‚¹å‡»ä½ç½®æ˜¯å¦åœ¨ä»»æ„è‡ªè¡Œè½¦æ—¶é—´æŒ‘æˆ˜èµ›é™„è¿‘
                const nearbyTrial = itemData.bike_time_trial.find(trial => {
                    const distance = Math.sqrt(Math.pow(trial.x - clickX, 2) + Math.pow(trial.y - clickY, 2));
                    return distance <= BIKE_TIME_TRIAL_RADIUS;
                });

                if (nearbyTrial) {
                    console.log('ç‚¹å‡»äº†è‡ªè¡Œè½¦æ—¶é—´æŒ‘æˆ˜èµ›é™„è¿‘:', nearbyTrial.name);
                    // æ‰¾åˆ°å¯¹åº”çš„ç´¢å¼•
                    const trialIndex = itemData.bike_time_trial.findIndex(trial => 
                        trial.x === nearbyTrial.x && trial.y === nearbyTrial.y
                    );
                    showBikeTimeTrialPopup(nearbyTrial, trialIndex);
                }
            }
        }

        // æ£€æµ‹è·³ä¼ç‚¹å‡»ï¼ˆåæ ‡æ£€æµ‹ï¼‰
        function checkSkydivesClickNew(clickX, clickY) {
            const SKYDIVES_RADIUS = 100; // æ£€æµ‹åŠå¾„100å•ä½
            
            // æ£€æŸ¥å½“å‰æ˜¯å¦æ˜¾ç¤ºè·³ä¼ï¼ˆæ”¯æŒå¤šé€‰ï¼‰
            if (activeItemTypes.has('skydives') && itemData.skydives) {
                // æ£€æŸ¥ç‚¹å‡»ä½ç½®æ˜¯å¦åœ¨ä»»æ„è·³ä¼é™„è¿‘
                const nearbySkydive = itemData.skydives.find(skydive => {
                    const distance = Math.sqrt(Math.pow(skydive.x - clickX, 2) + Math.pow(skydive.y - clickY, 2));
                    return distance <= SKYDIVES_RADIUS;
                });

                if (nearbySkydive) {
                    console.log('ç‚¹å‡»äº†è·³ä¼é™„è¿‘:', nearbySkydive.name);
                    // æ‰¾åˆ°å¯¹åº”çš„ç´¢å¼•
                    const skydiveIndex = itemData.skydives.findIndex(skydive => 
                        skydive.x === nearbySkydive.x && skydive.y === nearbySkydive.y
                    );
                    showSkydivesPopup(nearbySkydive, skydiveIndex);
                }
            }
        }

        // æ£€æµ‹è½¦è¡Œç‚¹å‡»ï¼ˆåæ ‡æ£€æµ‹ï¼‰
        function checkDealershipClick(clickX, clickY) {
            const DEALERSHIP_RADIUS = 100; // æ£€æµ‹åŠå¾„100å•ä½
            
            // æ£€æŸ¥å½“å‰æ˜¯å¦æ˜¾ç¤ºè½¦è¡Œï¼ˆæ”¯æŒå¤šé€‰ï¼‰
            if (activeItemTypes.has('dealerships')) {
                // éå†æ‰€æœ‰è½¦è¡Œåæ ‡è¿›è¡Œæ£€æµ‹
                Object.keys(dealershipData).forEach(dealershipType => {
                    const dealership = dealershipData[dealershipType];
                    dealership.coordinates.forEach(coord => {
                        const distance = Math.sqrt(Math.pow(coord[0] - clickX, 2) + Math.pow(coord[1] - clickY, 2));
                        if (distance <= DEALERSHIP_RADIUS) {
                            console.log(`ç‚¹å‡»äº†${dealership.name}é™„è¿‘åŒºåŸŸ`);
                            showDealershipVehicles(dealershipType, dealership.name);
                        }
                    });
                });
            }
        }

        // æ£€æµ‹å¸®æ´¾æ”»å‡»ç‚¹å‡»ï¼ˆåæ ‡æ£€æµ‹ï¼‰
        function checkGangAttackClick(clickX, clickY) {
            const GANG_ATTACK_RADIUS = 100; // æ£€æµ‹åŠå¾„100å•ä½
            
            // æ£€æŸ¥å½“å‰æ˜¯å¦æ˜¾ç¤ºå¸®æ´¾æ”»å‡»ï¼ˆæ”¯æŒå¤šé€‰ï¼‰
            if (activeItemTypes.has('gang_attacks') && itemData.gang_attacks) {
                // æ£€æŸ¥ç‚¹å‡»ä½ç½®æ˜¯å¦åœ¨ä»»æ„å¸®æ´¾æ”»å‡»é™„è¿‘
                const nearbyAttack = itemData.gang_attacks.find((attack, index) => {
                    // é¦–å…ˆæ£€æŸ¥æ—¶é—´æ˜¯å¦åŒ¹é…
                    if (!isGangAttackActive(attack.time)) {
                        return false;
                    }
                    
                    const distance = Math.sqrt(Math.pow(attack.x - clickX, 2) + Math.pow(attack.y - clickY, 2));
                    return distance <= GANG_ATTACK_RADIUS;
                });

                if (nearbyAttack) {
                    console.log('ç‚¹å‡»äº†å¸®æ´¾æ”»å‡»é™„è¿‘:', nearbyAttack);
                    // æ‰¾åˆ°å¯¹åº”çš„ç´¢å¼•
                    const attackIndex = itemData.gang_attacks.findIndex(attack => 
                        attack.x === nearbyAttack.x && attack.y === nearbyAttack.y
                    );
                    showGangAttackPopup(nearbyAttack, attackIndex);
                }
            }
        }

        // æ˜¾ç¤ºå¸®æ´¾æ”»å‡»å¼¹çª—
        function showGangAttackPopup(item, index) {
            // åˆ›å»ºå¼¹çª—
            const popup = document.createElement('div');
            popup.className = 'gang-attack-popup';
            popup.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                border: 3px solid #ff0000;
                border-radius: 12px;
                padding: 20px;
                z-index: 10000;
                max-width: 400px;
                max-height: 80vh;
                box-shadow: 0 8px 32px rgba(0,0,0,0.3);
                font-family: Arial, sans-serif;
                text-align: center;
            `;

            // å¼¹çª—å†…å®¹
            popup.innerHTML = `
                <div style="margin-bottom: 20px; font-size: 24px; font-weight: bold; color: #ff0000;">
                    âš”ï¸ å¸®æ´¾æ”»å‡»
                </div>
                <div style="margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #ff0000;">
                    <div style="font-weight: bold; color: #ff0000; margin-bottom: 8px; font-size: 16px;">â° æ—¶é—´é™åˆ¶</div>
                    <div style="color: #333; font-size: 18px; margin-bottom: 15px;">${item.time || 'æœªçŸ¥æ—¶é—´'}</div>
                </div>
                
                <div style="margin: 15px 0; padding: 12px; background: #ffebee; border-radius: 6px; color: #c62828; font-size: 14px; line-height: 1.6;">
                    ğŸ¯ <strong>å¸®æ´¾æ”»å‡»äº‹ä»¶</strong><br>
                    â€¢ åœ¨æŒ‡å®šæ—¶é—´å†…å‰å¾€è¯¥åŒºåŸŸ<br>
                    â€¢ ä¸æ•Œå¯¹å¸®æ´¾æˆå‘˜æˆ˜æ–—<br>
                    â€¢ å®Œæˆå¯è·å¾—<strong>ç»éªŒå€¼</strong>å’Œ<strong>æ¸¸æˆå¸å¥–åŠ±</strong><br>
                    â€¢ æ³¨æ„å®‰å…¨ï¼Œå‡†å¤‡å……è¶³çš„æ­¦å™¨å’Œå¼¹è¯ï¼
                </div>
                
                <button id="close-gang-attack-popup-btn" 
                        style="padding: 12px 24px; 
                               background: #ff0000; color: white; 
                               border: none; border-radius: 6px; 
                               cursor: pointer; font-size: 16px;
                               font-weight: bold;
                               transition: background-color 0.3s;">
                    å…³é—­
                </button>
            `;

            // æ·»åŠ å…³é—­æŒ‰é’®äº‹ä»¶
            const closeBtn = popup.querySelector('#close-gang-attack-popup-btn');
            closeBtn.addEventListener('click', () => {
                popup.remove();
            });

            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
            popup.addEventListener('click', (e) => e.stopPropagation());
            
            // ä½¿ç”¨setTimeoutå»¶è¿Ÿæ·»åŠ documentç‚¹å‡»äº‹ä»¶ï¼Œé¿å…ç«‹å³è§¦å‘
            setTimeout(() => {
                const closePopupHandler = (e) => {
                    if (!popup.contains(e.target)) {
                        popup.remove();
                        document.removeEventListener('click', closePopupHandler);
                    }
                };
                document.addEventListener('click', closePopupHandler);
            }, 100);

            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(popup);
        }

        // æ˜¾ç¤ºæ­¦å™¨å¢å‹è½¦æ­¦å™¨ä¿¡æ¯
        function showGunVanWeapons() {
            // åŠ è½½labels.jsonæ•°æ®
            let labelsData = {};
            fetch('./src/data/labels.json')
                .then(response => response.json())
                .then(labels => {
                    labelsData = labels;
                    // ä»APIåŠ¨æ€è·å–æ­¦å™¨ä¿¡æ¯
                    return fetch('https://api-gta.antwen.com/api/items/gun-van');
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayGunVanWeapons(data.data.message, labelsData);
                    } else {
                        console.error('è·å–æ­¦å™¨å¢å‹è½¦ä¿¡æ¯å¤±è´¥:', data.error);
                        alert('è·å–æ­¦å™¨ä¿¡æ¯å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                    }
                })
                .catch(error => {
                    console.error('APIè¯·æ±‚é”™è¯¯:', error);
                    alert('ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
                });

            function displayGunVanWeapons(message, labels) {
                // è§£æAPIè¿”å›çš„æ¶ˆæ¯æ¥æå–æ­¦å™¨ä¿¡æ¯
                const lines = message.split('\n');
                const weapons = [];
                const throwables = [];
                let currentSection = '';

                lines.forEach(line => {
                    if (line.includes('æ­¦å™¨:')) {
                        currentSection = 'weapons';
                    } else if (line.includes('æŠ•æ·ç‰©:')) {
                        currentSection = 'throwables';
                    } else if (line.trim() && line.includes('-')) {
                        const match = line.match(/- (.+?) \((\d+)æŠ˜\)/);
                        if (match) {
                            // å°è¯•ä»labelsä¸­æŸ¥æ‰¾æ­¦å™¨çš„ä¸­æ–‡åç§°
                            let weaponName = match[1];
                            if (labels.hasOwnProperty(weaponName)) {
                                weaponName = labels[weaponName];
                            }
                            
                            const discountText = match[2] + 'æŠ˜';
                            
                            const weaponEntry = {
                                name: weaponName,
                                discountText: discountText
                            };

                            if (currentSection === 'weapons') {
                                weapons.push(weaponEntry);
                            } else if (currentSection === 'throwables') {
                                throwables.push(weaponEntry);
                            }
                        }
                    }
                });

                // åˆ›å»ºå¼¹çª—
                const popup = document.createElement('div');
                popup.className = 'gun-van-popup';
                popup.style.cssText = `
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: white;
                    border: 2px solid #333;
                    border-radius: 8px;
                    padding: 20px;
                    z-index: 1000;
                    max-width: 400px;
                    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                    font-family: Arial, sans-serif;
                `;

                // å¼¹çª—å†…å®¹
                popup.innerHTML = `
                    <div style="margin-bottom: 15px; font-size: 18px; font-weight: bold; color: #333;">
                        ğŸš æ­¦å™¨å¢å‹è½¦å•†å“ä¿¡æ¯
                    </div>
                    <div style="margin-bottom: 10px; font-weight: bold; color: #555;">ä¸»æ­¦å™¨:</div>
                    ${weapons.map(weapon => 
                            `<div style="margin: 5px 0; color: #666;">
                                ${weapon.name} - <span style="color: #e74c3c;">${weapon.discountText}</span>
                            </div>`
                        ).join('')}
                        <div style="margin: 10px 0; font-weight: bold; color: #555;">æŠ•æ·æ­¦å™¨:</div>
                        ${throwables.map(throwable => 
                            `<div style="margin: 5px 0; color: #666;">
                                ${throwable.name} - <span style="color: #e74c3c;">${throwable.discountText}</span>
                            </div>`
                        ).join('')}
                        <div style="margin-top: 15px; color: #666;">
                            é˜²å¼¹è¡£: <span style="color: #e74c3c;">9æŠ˜</span>
                        </div>
                    <button id="close-popup-btn" 
                            style="margin-top: 15px; padding: 8px 16px; 
                                   background: #e74c3c; color: white; 
                                   border: none; border-radius: 4px; 
                                   cursor: pointer;">
                        å…³é—­
                    </button>
                `;

                // æ·»åŠ å…³é—­æŒ‰é’®äº‹ä»¶ç›‘å¬
                const closeBtn = popup.querySelector('#close-popup-btn');
                closeBtn.addEventListener('click', () => {
                    popup.remove();
                });

                // æ·»åŠ åˆ°é¡µé¢
                document.body.appendChild(popup);

                // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
                popup.addEventListener('click', (e) => e.stopPropagation());
                
                // ä½¿ç”¨setTimeoutå»¶è¿Ÿæ·»åŠ documentç‚¹å‡»äº‹ä»¶ï¼Œé¿å…ç«‹å³è§¦å‘
                setTimeout(() => {
                    const closePopupHandler = (e) => {
                        if (!popup.contains(e.target)) {
                            popup.remove();
                            document.removeEventListener('click', closePopupHandler);
                        }
                    };
                    document.addEventListener('click', closePopupHandler);
                }, 100);
            }
        }

        // æ˜¾ç¤ºè¡—å¤´æ¯’è´©ä¿¡æ¯
        function showStreetDealersInfo() {
            // ä»APIåŠ¨æ€è·å–è¡—å¤´æ¯’è´©ä¿¡æ¯
            fetch('https://api-gta.antwen.com/api/items/street-dealers')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayStreetDealersInfo(data.data.message);
                    } else {
                        console.error('è·å–è¡—å¤´æ¯’è´©ä¿¡æ¯å¤±è´¥:', data.error);
                        alert('è·å–è¡—å¤´æ¯’è´©ä¿¡æ¯å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                    }
                })
                .catch(error => {
                    console.error('APIè¯·æ±‚é”™è¯¯:', error);
                    alert('ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
                });

            function displayStreetDealersInfo(message) {
                // åˆ›å»ºå¼¹çª—
                const popup = document.createElement('div');
                popup.className = 'street-dealers-popup';
                popup.style.cssText = `
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: white;
                    border: 2px solid #333;
                    border-radius: 8px;
                    padding: 20px;
                    z-index: 1000;
                    max-width: 500px;
                    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                    font-family: Arial, sans-serif;
                    max-height: 80vh;
                    overflow-y: auto;
                `;

                // å¼¹çª—å†…å®¹
                popup.innerHTML = `
                    <div style="margin-bottom: 15px; font-size: 18px; font-weight: bold; color: #333;">
                        ğŸ’Š è¡—å¤´æ¯’è´©å•†å“ä¿¡æ¯
                    </div>
                    <div style="white-space: pre-line; line-height: 1.5; color: #666;">
                        ${message.replace(/\n/g, '<br>')}
                    </div>
                    <button id="close-popup-btn" 
                            style="margin-top: 15px; padding: 8px 16px; 
                                   background: #e74c3c; color: white; 
                                   border: none; border-radius: 4px; 
                                   cursor: pointer;">
                        å…³é—­
                    </button>
                `;

                // æ·»åŠ å…³é—­æŒ‰é’®äº‹ä»¶ç›‘å¬
                const closeBtn = popup.querySelector('#close-popup-btn');
                closeBtn.addEventListener('click', () => {
                    popup.remove();
                });

                // æ·»åŠ åˆ°é¡µé¢
                document.body.appendChild(popup);

                // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
                popup.addEventListener('click', (e) => e.stopPropagation());
                
                // ä½¿ç”¨setTimeoutå»¶è¿Ÿæ·»åŠ documentç‚¹å‡»äº‹ä»¶ï¼Œé¿å…ç«‹å³è§¦å‘
                setTimeout(() => {
                    const closePopupHandler = (e) => {
                        if (!popup.contains(e.target)) {
                            popup.remove();
                            document.removeEventListener('click', closePopupHandler);
                        }
                    };
                    document.addEventListener('click', closePopupHandler);
                }, 100);
            }
        }

        // åˆå§‹åŠ è½½
        map.whenReady(() => {
            updateTilePanePosition();
            updateOriginMarker();
            probeTilesForStyleAndZoom(currentStyle, map.getZoom());
            loadItemData().then(() => {
                console.log('ç‰©å“æ•°æ®åŠ è½½å®Œæˆ');
            });
            
            // åˆå§‹åŒ–è½¦è¡Œæ ‡è®°
            initDealershipMarkers();
            
            // åˆå§‹åŒ–æ¸¸æˆæ—¶é—´å’Œå¤©æ°”æ˜¾ç¤º
            initGameTimeWeatherDisplay();
        });

        window.addEventListener('resize', () => {
            resetViewForZoom(map.getZoom());
            updateTilePanePosition();
        });

        // ç“¦ç‰‡æ–‡ä»¶æ£€æµ‹ï¼ˆä¿æŒåŸé€»è¾‘ï¼‰
        async function probeTilesForStyleAndZoom(style, zoom) {
            // ... åŸæœ‰ä»£ç ä¿æŒä¸å˜
        }

        // æ ¹æ®åœ°å›¾æ ·å¼è®¾ç½®èƒŒæ™¯è‰²
        function setBackgroundColorByStyle(style) {
            const backgroundColorMap = {
                'game': 'rgb(56, 73, 80)',
                'render': 'rgb(13, 43, 79)',
                'print': 'rgb(78, 177, 208)'
            };
            
            document.body.style.backgroundColor = backgroundColorMap[style] || '#1a1a1a';
        }
        
        // æ ·å¼é€‰æ‹©äº‹ä»¶
        styleSelect.addEventListener('change', (e) => {
            currentStyle = e.target.value;
            tileLayer.redraw();
            probeTilesForStyleAndZoom(currentStyle, map.getZoom());
            setBackgroundColorByStyle(currentStyle);
        });
        
        // åˆå§‹åŒ–èƒŒæ™¯è‰²
        setBackgroundColorByStyle(currentStyle);

            // åˆå§‹åŒ–ç‰©å“ä¿¡æ¯å¼¹çª—æ ·å¼ï¼ˆè¦†ç›–é»˜è®¤æ ·å¼ï¼‰
            function initItemInfoTextStyles() {
                const itemInfo = document.getElementById('item-info');
                itemInfo.style.display = 'none'; // ç¡®ä¿åˆå§‹çŠ¶æ€æ˜¯éšè—çš„
            }

            // æ˜¾ç¤ºç‰©å“ä¿¡æ¯ï¼ˆæ–‡æœ¬ç‰ˆï¼‰
            function showItemInfoText(title, coords, location, details) {
                const itemInfo = document.getElementById('item-info');
                document.getElementById('item-title').textContent = title;
                document.getElementById('item-coords').textContent = `åæ ‡: ${coords}`;
                document.getElementById('item-location').textContent = `ä½ç½®: ${location}`;
                document.getElementById('item-details').textContent = `è¯¦ç»†ä¿¡æ¯: ${details}`;
                
                // æ·»åŠ æ˜¾ç¤ºåŠ¨ç”»
                itemInfo.style.display = 'block';
                itemInfo.style.opacity = '0';
                itemInfo.style.transition = 'opacity 0.3s ease';
                
                // ä½¿ç”¨setTimeoutè§¦å‘é‡æ’å’Œè¿‡æ¸¡åŠ¨ç”»
                setTimeout(() => {
                    itemInfo.style.opacity = '1';
                }, 10);
            }

            // éšè—ç‰©å“ä¿¡æ¯ï¼ˆæ–‡æœ¬ç‰ˆï¼‰
            function hideItemInfoText() {
                const itemInfo = document.getElementById('item-info');
                itemInfo.style.opacity = '0';
                
                // ç­‰å¾…æ·¡å‡ºåŠ¨ç”»å®Œæˆåéšè—å…ƒç´ 
                setTimeout(() => {
                    itemInfo.style.display = 'none';
                }, 300);
            };

            // åˆå§‹åŒ–ç‰©å“ä¿¡æ¯å¼¹çª—æ ·å¼ï¼ˆæ–‡æœ¬ç‰ˆï¼‰
            initItemInfoTextStyles();

        // åˆå§‹æ¢æµ‹
        setTimeout(() => {
            probeTilesForStyleAndZoom(currentStyle, map.getZoom());
        }, 300);

        // ç§»åŠ¨ç«¯èœå•äº¤äº’ï¼ˆâ€œæ›´å¤šâ€æŒ‰é’®ï¼‰
        (function initMobileMenu() {
            const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
            const mobileMenu = document.getElementById('mobile-menu');
            if (!mobileMenuToggle || !mobileMenu) return;

            mobileMenuToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                mobileMenu.classList.toggle('show');
            });

            // ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­èœå•
            document.addEventListener('click', (e) => {
                if (!mobileMenu.contains(e.target) && e.target !== mobileMenuToggle) {
                    mobileMenu.classList.remove('show');
                }
            });
        })();

        // æ£€æŸ¥å¸®æ´¾æ”»å‡»æ—¶é—´æ˜¯å¦åŒ¹é…
        function isGangAttackActive(timeRange) {
            try {
                // è·å–å½“å‰æ¸¸æˆæ—¶é—´
                const timestamp = Math.floor(Date.now() / 1000);
                const currentHour = Math.floor(timestamp / 120) % 24;
                const currentMinute = Math.floor(timestamp / 2) % 60;
                const currentTime = currentHour * 60 + currentMinute; // è½¬æ¢ä¸ºåˆ†é’Ÿ
                
                // è§£ææ—¶é—´èŒƒå›´ "04:00 - 12:00"
                const [startTime, endTime] = timeRange.split(' - ');
                const [startHour, startMinute] = startTime.split(':').map(Number);
                const [endHour, endMinute] = endTime.split(':').map(Number);
                
                const startTimeMinutes = startHour * 60 + startMinute;
                const endTimeMinutes = endHour * 60 + endMinute;
                
                // æ£€æŸ¥å½“å‰æ—¶é—´æ˜¯å¦åœ¨èŒƒå›´å†…
                if (startTimeMinutes <= endTimeMinutes) {
                    // æ­£å¸¸èŒƒå›´ï¼Œå¦‚ 04:00 - 12:00
                    return currentTime >= startTimeMinutes && currentTime <= endTimeMinutes;
                } else {
                    // è·¨å¤©èŒƒå›´ï¼Œå¦‚ 22:00 - 06:00
                    return currentTime >= startTimeMinutes || currentTime <= endTimeMinutes;
                }
            } catch (error) {
                console.error('æ£€æŸ¥å¸®æ´¾æ”»å‡»æ—¶é—´å¤±è´¥:', error);
                return false;
            }
        }

        // æ¸¸æˆæ—¶é—´å’Œå¤©æ°”æ˜¾ç¤ºåŠŸèƒ½
        function initGameTimeWeatherDisplay() {
            // ç®€åŒ–æ ·å¼åˆ›å»ºï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»åœ¨å¤´éƒ¨å®šä¹‰äº†æ ·å¼

            // åˆ›å»ºæ˜¾ç¤ºå…ƒç´ 
            const displayElement = document.createElement('div');
            displayElement.id = 'game-time-weather';
            displayElement.className = 'nav-weather';
            displayElement.innerHTML = '<span style="color: white;">ğŸ• åŠ è½½ä¸­...</span>';
            // é»˜è®¤æ”¾åœ¨åœ°å›¾å®¹å™¨çš„å³ä¸Šè§’ï¼ˆä¼šåœ¨åˆå§‹åŒ–æ—¶ç§»åŠ¨åˆ°åˆé€‚ä½ç½®ï¼‰
            document.getElementById('map-container').appendChild(displayElement);

            // å¦‚æœæ˜¯ç§»åŠ¨ç«¯ï¼ˆå®½åº¦ <= 768pxï¼‰ï¼ŒæŠŠæ—¶é—´å¤©æ°”ç§»åŠ¨åˆ°ç§»åŠ¨èœå•é‡Œï¼Œé¿å…åº•éƒ¨ç©ºç™½
            function placeGameTimeWeatherForMobile() {
                const isMobile = window.matchMedia('(max-width: 768px)').matches;
                if (isMobile) {
                    // åœ¨ç§»åŠ¨ç«¯ï¼ŒæŠŠæ—¶é—´/å¤©æ°”æ”¾åœ¨æ ‡é¢˜å³è¾¹ï¼ˆh1.gta-title ä¹‹åï¼‰ï¼Œå¹¶å¼ºåˆ¶å¯è§æ ·å¼
                    const navLeft = document.querySelector('.gta-nav .nav-left');
                    if (navLeft) {
                        const titleEl = navLeft.querySelector('h1.gta-title');
                        if (titleEl) {
                            // æ— è®ºä¹‹å‰åœ¨å“ªï¼Œéƒ½æŠŠå…ƒç´ ç§»åˆ°æ ‡é¢˜åé¢
                            if (displayElement.parentElement) displayElement.parentElement.removeChild(displayElement);
                            titleEl.insertAdjacentElement('afterend', displayElement);
                            // å¼ºåˆ¶æ ·å¼ä»¥ç¡®ä¿å¯è§
                            displayElement.style.display = 'inline-flex';
                            displayElement.style.alignItems = 'center';
                            displayElement.style.marginLeft = '8px';
                            displayElement.style.color = 'white';
                            displayElement.style.fontSize = '13px';
                            displayElement.style.pointerEvents = 'none';
                            displayElement.style.background = 'transparent';
                            displayElement.style.padding = '0 6px';
                        }
                    }
                } else {
                    // æ¡Œé¢ç«¯ï¼šæ”¾åœ¨ nav-links ä¸­çš„â€œåœ¨çº¿æ–‡ä»¶â€ä¹‹åï¼ˆå¦‚æœå­˜åœ¨ï¼‰
                    const navLinks = document.querySelector('.gta-nav .nav-left .nav-links');
                    if (navLinks) {
                        // æ‰¾åˆ°ç¬¬äºŒä¸ªé“¾æ¥ï¼ˆåœ¨çº¿æ–‡ä»¶ï¼‰å¹¶åœ¨å…¶åæ’å…¥æ˜¾ç¤ºå…ƒç´ 
                        const anchors = navLinks.querySelectorAll('a');
                        const target = anchors[1] || navLinks.lastElementChild;
                        if (target && !navLinks.contains(displayElement)) {
                            // æ¢å¤æ ·å¼ä¸ºå†…è”èœå•é¡¹
                            displayElement.style.position = '';
                            displayElement.style.bottom = '';
                            displayElement.style.right = '';
                            displayElement.style.pointerEvents = 'none';
                            displayElement.style.background = 'transparent';
                            displayElement.style.padding = '0';
                            displayElement.style.border = 'none';
                            displayElement.style.boxShadow = 'none';
                            displayElement.style.minWidth = '0';
                            displayElement.style.textAlign = 'left';
                            target.insertAdjacentElement('afterend', displayElement);
                        }
                    } else {
                        // å›é€€ï¼šæ”¾å› map-container
                        const container = document.getElementById('map-container');
                        if (!container.contains(displayElement)) container.appendChild(displayElement);
                    }
                }
            }

            // è·å–å¹¶æ˜¾ç¤ºæ¸¸æˆæ—¶é—´å’Œå¤©æ°”
            function updateGameTimeWeather() {
                try {
                    // å®šä¹‰å¤©æ°”æ˜ å°„è¡¨å’Œæ˜ŸæœŸè¡¨
                    const WEATHERS = {
                      0: 'â˜ï¸å¤šäº‘', 4: 'ğŸŒ«ï¸è–„é›¾', 7: 'â›…å¤§éƒ¨å¤šäº‘', 11: 'â˜€ï¸æ™´æœ—', 14: 'ğŸŒ«ï¸è–„é›¾', 16: 'â˜€ï¸æ™´æœ—',
                      28: 'ğŸŒ«ï¸è–„é›¾', 31: 'â˜€ï¸æ™´æœ—', 41: 'ğŸŒé˜´éœ¾', 45: 'â˜ï¸å¤šäº‘', 52: 'ğŸŒ«ï¸è–„é›¾', 55: 'â˜ï¸å¤šäº‘',
                      62: 'ğŸŒé›¾å¤©', 66: 'â˜ï¸å¤šäº‘', 72: 'â˜ï¸å¤šäº‘', 78: 'ğŸŒé›¾å¤©', 82: 'â˜ï¸å¤šäº‘', 92: 'ğŸŒ¤ï¸å¤§éƒ¨æ™´æœ—',
                      104: 'â˜ï¸å¤šäº‘', 105: 'ğŸŒ¦ï¸æ¯›æ¯›é›¨', 108: 'â˜ï¸å¤šäº‘', 125: 'ğŸŒ«ï¸è–„é›¾', 128: 'â˜ï¸å¤šäº‘',
                      131: 'ğŸŒ§ï¸ä¸‹é›¨', 134: 'ğŸŒ¦ï¸æ¯›æ¯›é›¨', 137: 'â˜ï¸å¤šäº‘', 148: 'ğŸŒ«ï¸è–„é›¾', 151: 'â›…å¤§éƒ¨å¤šäº‘',
                      155: 'ğŸŒé›¾å¤©', 159: 'â˜€ï¸æ™´æœ—', 176: 'ğŸŒ¤ï¸å¤§éƒ¨æ™´æœ—', 196: 'ğŸŒé›¾å¤©', 201: 'â˜ï¸å¤šäº‘',
                      220: 'ğŸŒ«ï¸è–„é›¾', 222: 'ğŸŒ¤ï¸å¤§éƒ¨æ™´æœ—', 244: 'ğŸŒ«ï¸è–„é›¾', 246: 'ğŸŒ¤ï¸å¤§éƒ¨æ™´æœ—', 247: 'ğŸŒ§ï¸ä¸‹é›¨',
                      250: 'ğŸŒ¦ï¸æ¯›æ¯›é›¨', 252: 'â˜ï¸å¤šäº‘', 268: 'ğŸŒ«ï¸è–„é›¾', 270: 'â˜ï¸å¤šäº‘', 272: 'â˜ï¸å¤šäº‘',
                      277: 'â˜ï¸å¤šäº‘', 292: 'ğŸŒ«ï¸è–„é›¾', 295: 'â˜ï¸å¤šäº‘', 300: 'â›…å¤§éƒ¨å¤šäº‘',
                      306: 'â˜ï¸å¤šäº‘', 318: 'â›…å¤§éƒ¨å¤šäº‘', 330: 'â˜ï¸å¤šäº‘', 337: 'â˜€ï¸æ™´æœ—',
                      367: 'â˜ï¸å¤šäº‘', 369: 'ğŸŒ§ï¸ä¸‹é›¨', 376: 'ğŸŒ¦ï¸æ¯›æ¯›é›¨', 377: 'â˜ï¸å¤šäº‘'
                    };
                    
                    const WEEKDAYS = {
                      0: 'æ˜ŸæœŸæ—¥', 1: 'æ˜ŸæœŸä¸€', 2: 'æ˜ŸæœŸäºŒ', 3: 'æ˜ŸæœŸä¸‰', 4: 'æ˜ŸæœŸå››', 5: 'æ˜ŸæœŸäº”', 6: 'æ˜ŸæœŸå…­'
                    };
                    
                    // è·å–æ˜ŸæœŸå‡ 
                    function getWeekday() {
                      const timestamp = Math.floor(Date.now() / 1000);
                      const weekday_correction = Math.floor(timestamp / (365 * 2880)) % 7;
                      const weekdayIdx = Math.floor(timestamp / 2880 + 2 - weekday_correction) % 7;
                      return WEEKDAYS[weekdayIdx];
                    }
                    
                    // è·å–å°æ—¶å’Œåˆ†é’Ÿ
                    function getHourAndMinute() {
                      const timestamp = Math.floor(Date.now() / 1000);
                      const hour = Math.floor(timestamp / 120) % 24;
                      const minute = Math.floor(timestamp / 2) % 60;
                      const formatted_hour = hour < 10 ? '0' + hour : hour.toString();
                      const formatted_minute = minute < 10 ? '0' + minute : minute.toString();
                      return `${formatted_hour}:${formatted_minute}`;
                    }
                    
                    // è·å–å¤©æ°”è¯¦æƒ…
                    function getWeatherDetail() {
                      const timestamp = Math.floor(Date.now() / 1000);
                      const weather_period = timestamp / 120 % 384;
                      const periods = Object.keys(WEATHERS).map(Number).sort((a, b) => a - b);

                      // å½“å‰å¤©æ°”
                      let currIdx = 0;
                      for (let i = periods.length - 1; i >= 0; i--) {
                        if (periods[i] <= weather_period) {
                          currIdx = i;
                          break;
                        }
                      }
                      const currPeriod = periods[currIdx];
                      const currWeather = WEATHERS[currPeriod];

                      return currWeather;
                    }
                    
                    // æœ¬åœ°è®¡ç®—æ¸¸æˆæ—¶é—´å’Œå¤©æ°”
                    const weekday = getWeekday();
                    const time = getHourAndMinute();
                    const weatherDetail = getWeatherDetail();
                    
                    // æ ¹æ®å¤©æ°”è®¾ç½®emoji
                    let weatherEmoji = 'ğŸŒ¤ï¸';
                    const weather = weatherDetail.toLowerCase();
                    if (weather.includes('é›¨') || weather.includes('æ¯›æ¯›é›¨')) {
                        weatherEmoji = 'ğŸŒ§ï¸';
                    } else if (weather.includes('é›·') || weather.includes('thunder')) {
                        weatherEmoji = 'â›ˆï¸';
                    } else if (weather.includes('é›¾') || weather.includes('éœ¾')) {
                        weatherEmoji = 'ğŸŒ«ï¸';
                    } else if (weather.includes('é˜´') || weather.includes('cloud') || weather.includes('å¤šäº‘')) {
                        weatherEmoji = 'â˜ï¸';
                    } else if (weather.includes('æ™´') || weather.includes('clear') || weather.includes('sun') || weather.includes('æ™´æœ—')) {
                        weatherEmoji = 'â˜€ï¸';
                    }

                    // å¹³æ»‘æ›´æ–°æ–‡æœ¬ï¼šé¿å…æ”¹å˜èƒŒæ™¯é€æ˜åº¦ä»¥é˜²æ­¢é—ªçƒ
                    const newText = `${weekday} ${time} ${weatherEmoji}`;
                    const safeHtml = `<span style="color:white">${newText}</span>`;
                    if (displayElement.innerHTML !== safeHtml) {
                        // ä½¿ç”¨ innerHTML ä¸”å¸¦æ ·å¼ï¼Œç¡®ä¿åœ¨å¯¼èˆªä¸Šçš„å¯è§æ€§
                        displayElement.innerHTML = safeHtml;
                    }
                } catch (error) {
                    displayElement.textContent = 'âŒ è®¡ç®—å¤±è´¥';
                    console.error('è®¡ç®—æ¸¸æˆæ—¶é—´å’Œå¤©æ°”ä¿¡æ¯å¤±è´¥:', error);
                }
            }

            // åˆå§‹åŠ è½½
            updateGameTimeWeather();
            // æ”¾ç½®åˆ°åˆé€‚çš„ä½ç½®ï¼ˆåŸºäºå½“å‰å±å¹•å®½åº¦ï¼‰
            placeGameTimeWeatherForMobile();
            // å¼ºåˆ¶åˆ·æ–°æ–‡æœ¬å’Œå¯è§æ€§ä»¥é˜²æ­¢ç¬¬ä¸€æ¬¡æœªæ˜¾ç¤º
            try { updateGameTimeWeather(); if (displayElement) { displayElement.style.display = 'inline-flex'; displayElement.style.color='white'; } } catch(e) {}
            // åœ¨çª—å£å¤§å°å˜åŒ–æ—¶è°ƒæ•´ä½ç½®
            window.addEventListener('resize', placeGameTimeWeatherForMobile);
            // ç°å®5ç§’ç­‰äºæ¸¸æˆå†…1åˆ†é’Ÿï¼Œæ¯5ç§’æ›´æ–°ä¸€æ¬¡
            setInterval(updateGameTimeWeather, 1000);
            
            // æ¯30ç§’æ›´æ–°ä¸€æ¬¡å¸®æ´¾æ”»å‡»æ˜¾ç¤ºçŠ¶æ€
            setInterval(() => {
                if (activeItemTypes.has('gang_attacks')) {
                    updateItemMarkers();
                }
            }, 30000);
        }

        // ä½©é‡Œç§‘å²›æ ·å¼ï¼šä¾§è¾¹æ æŠ˜å /ç¼©æ”¾æŒ‰é’®ä¸å¤šé€‰æ ·å¼/é‡ç½®è¡Œä¸º
        (function initCayoStyleControls() {
            const panelToggle = document.getElementById('panel-toggle');
            const sidePanel = document.getElementById('side-panel');
            if (panelToggle && sidePanel) {
                panelToggle.addEventListener('click', () => {
                    sidePanel.classList.toggle('collapsed');
                    const icon = panelToggle.querySelector('i');
                    if (sidePanel.classList.contains('collapsed')) {
                        icon.classList.remove('fa-chevron-left');
                        icon.classList.add('fa-chevron-right');
                    } else {
                        icon.classList.remove('fa-chevron-right');
                        icon.classList.add('fa-chevron-left');
                    }
                });
                // é¢å¤–ç›‘å¬ï¼Œè¦†ç›–å¯èƒ½çš„äº‹ä»¶å†’æ³¡/é˜»æ­¢é—®é¢˜
                panelToggle.addEventListener('touchstart', (ev) => {
                    ev.preventDefault();
                    panelToggle.click();
                });
            }

            // ç¼©æ”¾æŒ‰é’®ç»‘å®š
            const zoomInBtn = document.getElementById('zoom-in');
            const zoomOutBtn = document.getElementById('zoom-out');
            if (zoomInBtn) zoomInBtn.addEventListener('click', () => map.zoomIn());
            if (zoomOutBtn) zoomOutBtn.addEventListener('click', () => map.zoomOut());

            // ä½¿ç”¨é™æ€é€‰é¡¹æ•°ç»„ç”Ÿæˆä¾§è¾¹æ å¤šé€‰é¡¹
            const sidebarContainer = document.getElementById('sidebar-item-selectors');
            if (sidebarContainer) {
                sidebarItemOptions.forEach(opt => {
                    const type = opt.value;
                    // åŒ…è£¹ä¸€å±‚ï¼Œä¾¿äºæ ·å¼æ§åˆ¶
                    const wrapper = document.createElement('div');
                    wrapper.className = 'item-checkbox-wrapper';

                    // å¤é€‰æ¡†
                    const chk = document.createElement('input');
                    chk.type = 'checkbox';
                    chk.className = 'item-checkbox';
                    chk.dataset.itemType = type;
                    chk.id = `sidebar-item-${type}`;

                    // label
                    const label = document.createElement('label');
                    label.setAttribute('for', chk.id);
                    label.style.display = 'flex';
                    label.style.alignItems = 'center';
                    label.style.gap = '8px';

                    // å›¾æ ‡
                    if (type !== 'dealerships' && type !== 'gang_attacks' && typeof itemIcons !== 'undefined' && itemIcons[type]) {
                        const ico = document.createElement('img');
                        ico.src = itemIcons[type];
                        ico.alt = '';
                        ico.className = 'item-icon';
                        label.appendChild(ico);
                    }

                    // æ–‡æœ¬
                    const span = document.createElement('span');
                    span.textContent = opt.text;
                    label.appendChild(span);

                    wrapper.appendChild(chk);
                    wrapper.appendChild(label);
                    sidebarContainer.appendChild(wrapper);

                    // å˜æ›´æ—¶æ›´æ–°æ˜¾ç¤ºçš„ markers
                    chk.addEventListener('change', (e) => {
                        const t = e.target.dataset.itemType;
                        if (e.target.checked) {
                            activeItemTypes.add(t);
                        } else {
                            activeItemTypes.delete(t);
                        }

                        if (activeItemTypes.size > 0) {
                            updateItemMarkers();
                            if (typeof updateDealershipMarkers === 'function') updateDealershipMarkers();
                            if (typeof updateTilePanePosition === 'function') updateTilePanePosition();
                        } else {
                            clearAllItemMarkers();
                            if (typeof updateDealershipMarkers === 'function') updateDealershipMarkers();
                            if (typeof updateTilePanePosition === 'function') updateTilePanePosition();
                        }
                    });
                });
            }

            // é‡ç½®æŒ‰é’®
            const resetBtn = document.getElementById('reset-checkboxes');
            if (resetBtn) {
                resetBtn.addEventListener('click', () => {
                    document.querySelectorAll('#sidebar-item-selectors .item-checkbox').forEach(c => c.checked = false);
                    // æ¸…ç©ºæ‰€æœ‰ item markers
                    clearAllItemMarkers();
                    // æ¸…ç©º activeItemTypesï¼Œç¡®ä¿é‡ç½®åä¸ä¼šåœ¨åç»­æ“ä½œä¸­é‡æ–°æ˜¾ç¤ºå·²å–æ¶ˆçš„ç±»å‹
                    try { if (activeItemTypes && typeof activeItemTypes.clear === 'function') activeItemTypes.clear(); } catch(e) {}
                    // åŒæ­¥æ›´æ–°è½¦è¡Œæ ‡è®°ï¼ˆå…¨éƒ¨éšè—ï¼‰å¹¶åˆ·æ–° tilePane ä½ç½®
                    if (typeof updateDealershipMarkers === 'function') updateDealershipMarkers();
                    if (typeof updateTilePanePosition === 'function') updateTilePanePosition();
                });
            }
        })();

        // é¢å¤–ä¿éšœï¼šå…¨å±€ç›‘å¬ï¼Œç”¨äºç‚¹å‡»ä¾§è¾¹æ å¤–éƒ¨æ—¶è‡ªåŠ¨æ”¶èµ·ä¾§è¾¹æ ï¼ˆé¿å…ä¸æŒ‰é’®çš„åŒé‡è§¦å‘å†²çªï¼‰
        document.addEventListener('click', (e) => {
            const sidePanel = document.getElementById('side-panel');
            if (!sidePanel) return;
            // å¦‚æœç‚¹å‡»äº†æŠ˜å æŒ‰é’®æœ¬èº«ï¼Œäº¤ç”±æŒ‰é’®çš„äº‹ä»¶å¤„ç†å™¨å¤„ç†ï¼Œé¿å…åŒé‡åˆ‡æ¢
            if (e.target.closest && e.target.closest('.side-panel-toggle')) return;
            // å¦‚æœå½“å‰æœªæŠ˜å ï¼Œä¸”ç‚¹å‡»ç›®æ ‡ä½äºä¾§è¾¹æ å¤–éƒ¨ï¼Œåˆ™æŠ˜å ä¾§è¾¹æ 
            if (!sidePanel.classList.contains('collapsed') && !sidePanel.contains(e.target)) {
                sidePanel.classList.add('collapsed');
                // æ›´æ–°æŒ‰é’®å›¾æ ‡ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
                const toggleBtn = document.querySelector('.side-panel-toggle');
                if (toggleBtn) {
                    const icon = toggleBtn.querySelector('i');
                    if (icon) {
                        icon.classList.remove('fa-chevron-left');
                        icon.classList.add('fa-chevron-right');
                    }
                }
            }
        });

        // è¾…åŠ©ï¼šæ¸…é™¤ç‰¹å®šç±»å‹çš„ item markersï¼ˆæ”¯æŒ itemMarkers ä¸º {type,index,el} ç»“æ„ï¼‰
        function clearItemMarkersOfType(type) {
            if (!itemMarkers || itemMarkers.length === 0) return;
            // è¿‡æ»¤å¹¶ç§»é™¤å¯¹åº”ç±»å‹çš„ DOM å…ƒç´ 
            const remaining = [];
            itemMarkers.forEach(m => {
                if (m && ((m.type && m.type === type) || (!m.type && m.dataset && m.dataset.type === type))) {
                    // m å¯èƒ½æ˜¯å¯¹è±¡ {type,index,el} æˆ–è€å¼ DOM å…ƒç´ 
                    const el = m.el ? m.el : m;
                    if (el && el.remove) el.remove();
                } else {
                    remaining.push(m);
                }
            });
            itemMarkers = remaining;
            // ä¸å†é‡ç½® currentItemTypeï¼Œè¿™æ ·åœ¨ multi-select åœºæ™¯ä¸‹ä¸ä¼šæ„å¤–æ¸…ç©ºå•é€‰çŠ¶æ€
        }

        // æ¸…é™¤æ‰€æœ‰ item markers
        function clearAllItemMarkers() {
            if (!itemMarkers || itemMarkers.length === 0) return;
            itemMarkers.forEach(m => {
                const el = m && m.el ? m.el : m;
                if (el && el.remove) el.remove();
            });
            itemMarkers = [];
            // ä¿æŒ currentItemType ä¸å˜ï¼Œè¿™é‡Œåªæ¸…ç†å¯è§†æ ‡è®°
        }



        // ä¿è¯ä¾§è¾¹æ å†…å®¹åœ¨ç§»åŠ¨ç«¯å¯æ»šåŠ¨ä¸”æ»šåŠ¨æ—¶ä¸è§¦å‘åœ°å›¾æ‹–åŠ¨
        document.addEventListener('DOMContentLoaded', function() {
            const sidePanelContent = document.querySelector('.side-panel-content');
            if (sidePanelContent) {
                // ä¼˜åŒ– CSSï¼šå¯ç”¨åŸç”Ÿå¹³æ»‘æ»šåŠ¨ï¼ˆiOSï¼‰
                sidePanelContent.style.webkitOverflowScrolling = 'touch';
                sidePanelContent.style.touchAction = 'pan-y';

                // é¼ æ ‡æ»šè½®ï¼ˆæ¡Œé¢ï¼‰æ»šåŠ¨æ—¶é˜»æ­¢äº‹ä»¶å†’æ³¡åˆ°åœ°å›¾
                sidePanelContent.addEventListener('wheel', function(e) {
                    const atTop = sidePanelContent.scrollTop === 0;
                    const atBottom = sidePanelContent.scrollTop + sidePanelContent.clientHeight >= sidePanelContent.scrollHeight - 1;
                    if ((e.deltaY < 0 && !atTop) || (e.deltaY > 0 && !atBottom)) {
                        e.stopPropagation();
                    }
                }, { passive: false });

                // ç§»åŠ¨ç«¯è§¦æ‘¸å¤„ç†ï¼šæ£€æµ‹å‚ç›´æ»‘åŠ¨å¹¶é˜»æ­¢å†’æ³¡ï¼Œä»è€Œé¿å…åœ°å›¾å“åº”
                let startY = 0;
                let startX = 0;
                let isScrolling = undefined;

                sidePanelContent.addEventListener('touchstart', function(e) {
                    if (e.touches && e.touches.length === 1) {
                        startY = e.touches[0].clientY;
                        startX = e.touches[0].clientX;
                        isScrolling = undefined; // æœªç¡®å®šæ–¹å‘
                    }
                }, { passive: true });

                sidePanelContent.addEventListener('touchmove', function(e) {
                    if (!(e.touches && e.touches.length === 1)) return;
                    const curY = e.touches[0].clientY;
                    const curX = e.touches[0].clientX;
                    const dy = Math.abs(curY - startY);
                    const dx = Math.abs(curX - startX);

                    if (typeof isScrolling === 'undefined') {
                        isScrolling = dy > dx; // å¦‚æœå‚ç›´ä½ç§»å¤§äºæ°´å¹³ä½ç§»ï¼Œåˆ¤å®šä¸ºæ»šåŠ¨
                    }

                    if (isScrolling) {
                        // å½“é¢æ¿å¯ä»¥ç»§ç»­æ»šåŠ¨æ—¶ï¼Œé˜»æ­¢äº‹ä»¶å†’æ³¡åˆ°åœ°å›¾
                        const atTop = sidePanelContent.scrollTop === 0;
                        const atBottom = sidePanelContent.scrollTop + sidePanelContent.clientHeight >= sidePanelContent.scrollHeight - 1;
                        const movingUp = (curY - startY) > 0;
                        const movingDown = !movingUp;

                        // å¦‚æœå°šæœªåˆ°è¾¾è¾¹ç•Œï¼Œåˆ™é˜»æ­¢å†’æ³¡ï¼ˆå…è®¸å®¹å™¨å†…éƒ¨æ»šåŠ¨ï¼‰
                        if ((movingUp && !atTop) || (movingDown && !atBottom)) {
                            e.stopPropagation();
                            // ä¸è°ƒç”¨ preventDefaultï¼šå…è®¸æ»šåŠ¨å‘ç”Ÿï¼ŒåŒæ—¶é˜»æ­¢åœ°å›¾æ•è·
                        }
                    }
                }, { passive: false });

                // æ¸…ç†çŠ¶æ€
                sidePanelContent.addEventListener('touchend', function() {
                    isScrolling = undefined;
                });
            }
        });
    </script>

    <script>
        // å¼ºåˆ¶åœ¨æ”¯æŒçš„æµè§ˆå™¨ä¸Šé˜»æ­¢æ‰‹åŠ¿ç¼©æ”¾ï¼ˆiOS çš„ gesture eventsï¼‰
        (function preventPinchZoom() {
            // Prevent iOS gesture events
            function stopEvent(e) { e.preventDefault(); }
            try {
                document.addEventListener('gesturestart', stopEvent, { passive: false });
                document.addEventListener('gesturechange', stopEvent, { passive: false });
                document.addEventListener('gestureend', stopEvent, { passive: false });
            } catch (err) {
                // æŸäº›æµè§ˆå™¨ä¸æ”¯æŒ gesture* äº‹ä»¶ï¼Œå¿½ç•¥é”™è¯¯
            }

            // Prevent pinch-zoom via two-finger touchmove
            document.addEventListener('touchstart', function(e) {
                if (e.touches && e.touches.length > 1) {
                    e.preventDefault();
                }
            }, { passive: false });

            document.addEventListener('touchmove', function(e) {
                if (e.touches && e.touches.length > 1) {
                    e.preventDefault();
                }
            }, { passive: false });

            // Prevent double-tap zoom (by blocking very quick successive touchend)
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function(e) {
                const now = Date.now();
                if (now - lastTouchEnd <= 300) {
                    e.preventDefault();
                }
                lastTouchEnd = now;
            }, { passive: false });

            // Prevent zooming with Ctrl + wheel (desktop/tablet)
            window.addEventListener('wheel', function(e) {
                if (e.ctrlKey) {
                    e.preventDefault();
                }
            }, { passive: false });
        })();
    </script>

</body>
</html>
