<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸»é¢˜ API æµ‹è¯•</title>
    <style>
        body {
            font-family: monospace;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        button {
            padding: 10px 20px;
            margin: 10px 5px;
            cursor: pointer;
            font-size: 16px;
        }
        pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>ğŸ¨ ä¸»é¢˜ API æµ‹è¯•å·¥å…·</h1>
    
    <h2>1. æµ‹è¯•è·å–ä¸»é¢˜</h2>
    <button onclick="testGetTheme()">GET /gta-db/api/theme/global</button>
    <pre id="get-result">ç‚¹å‡»æŒ‰é’®æµ‹è¯•...</pre>
    
    <h2>2. æµ‹è¯•æ›´æ–°ä¸»é¢˜</h2>
    <select id="theme-select">
        <option value="default">é»˜è®¤ä¸»é¢˜</option>
        <option value="halloween">ä¸‡åœ£èŠ‚ä¸»é¢˜</option>
        <option value="christmas">åœ£è¯èŠ‚ä¸»é¢˜</option>
        <option value="dark">æš—é»‘ä¸»é¢˜</option>
    </select>
    <button onclick="testUpdateTheme()">POST /gta-db/api/admin/update-theme</button>
    <pre id="post-result">é€‰æ‹©ä¸»é¢˜åç‚¹å‡»æŒ‰é’®æµ‹è¯•...</pre>
    
    <h2>3. API é…ç½®</h2>
    <p>å½“å‰ API åœ°å€: <strong id="api-base">åŠ è½½ä¸­...</strong></p>
    <button onclick="changeApiBase()">åˆ‡æ¢åˆ° Workers é»˜è®¤åŸŸå</button>
    
    <script src="/src/js/theme-manager.js"></script>
    <script>
        let API_BASE = 'https://theme-api.antwen.com';
        
        document.getElementById('api-base').textContent = API_BASE;
        
        function changeApiBase() {
            API_BASE = API_BASE.includes('antwen.com') 
                ? 'https://theme-api.dinghyv.workers.dev'
                : 'https://theme-api.antwen.com';
            document.getElementById('api-base').textContent = API_BASE;
            alert('API åœ°å€å·²åˆ‡æ¢åˆ°: ' + API_BASE);
        }
        
        async function testGetTheme() {
            const resultEl = document.getElementById('get-result');
            resultEl.textContent = 'â³ è¯·æ±‚ä¸­...';
            
            try {
                const url = `${API_BASE}/gta-db/api/theme/global?t=${Date.now()}`;
                console.log('GET:', url);
                
                const response = await fetch(url);
                const data = await response.json();
                
                resultEl.innerHTML = `<span class="success">âœ… æˆåŠŸ</span>\n\n${JSON.stringify(data, null, 2)}`;
                console.log('GET å“åº”:', data);
            } catch (error) {
                resultEl.innerHTML = `<span class="error">âŒ å¤±è´¥</span>\n\n${error.message}`;
                console.error('GET é”™è¯¯:', error);
            }
        }
        
        async function testUpdateTheme() {
            const resultEl = document.getElementById('post-result');
            const theme = document.getElementById('theme-select').value;
            
            resultEl.textContent = 'â³ è¯·æ±‚ä¸­...';
            
            try {
                const url = `${API_BASE}/gta-db/api/admin/update-theme`;
                const body = {
                    theme: theme,
                    timestamp: Date.now()
                };
                
                console.log('POST:', url);
                console.log('Body:', body);
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(body)
                });
                
                const data = await response.json();
                
                resultEl.innerHTML = `<span class="success">âœ… æˆåŠŸ</span>\n\nè¯·æ±‚:\n${JSON.stringify(body, null, 2)}\n\nå“åº”:\n${JSON.stringify(data, null, 2)}`;
                console.log('POST å“åº”:', data);
                
                // è‡ªåŠ¨åˆ·æ–°è·å–ç»“æœ
                setTimeout(testGetTheme, 1000);
            } catch (error) {
                resultEl.innerHTML = `<span class="error">âŒ å¤±è´¥</span>\n\n${error.message}`;
                console.error('POST é”™è¯¯:', error);
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯• GET
        window.onload = () => {
            testGetTheme();
        };
    </script>
</body>
</html>
