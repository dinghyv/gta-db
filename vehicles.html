<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GTA 载具百科</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" crossorigin="anonymous" />
    <style>
        /* GTA风格导航栏 - 深蓝色主题 */
        .gta-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(90deg, rgba(2, 42, 108, 0.95) 0%, rgba(10, 61, 143, 0.95) 100%);
            border-bottom: 2px solid #064e9f;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 16px rgba(2, 36, 91, 0.5);
        }

        /* 移动端菜单样式 */
        .mobile-menu {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: linear-gradient(90deg, rgba(2,42,108,0.95) 0%, rgba(10,61,143,0.95) 100%);
            border: 1px solid #064e9f;
            border-radius: 8px;
            padding: 10px;
            min-width: 200px;
            z-index: 1001;
            flex-direction: column;
            gap: 8px;
            color: #fff;
        }

        .mobile-menu.show {
            display: flex;
        }

        .gta-nav .nav-left {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-grow: 1;
        }

        .gta-title {
            font-family: 'Impact', sans-serif;
            color: white;
            font-size: 24px;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            margin: 0;
            display: flex;
            align-items: center;
            background: rgba(0,0,0,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .gta-title i {
            margin-right: 8px;
            color: var(--gta-primary);
        }

        .gta-nav .nav-right {
            display: flex;
            gap: 15px;
        }

        .nav-button {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .nav-button:hover {
            background: var(--gta-primary);
            color: var(--gta-bg-dark);
            box-shadow: 0 0 15px var(--gta-primary-glow);
            transform: translateY(-1px);
            border-color: var(--gta-accent);
        }

        .nav-button.back-button {
            background: var(--gta-secondary);
            border-color: var(--gta-secondary);
        }
        
        .nav-links {
            display: flex;
            gap: 15px;
            margin-left: 0;
            align-items: center;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            font-size: 14px;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .nav-links a:hover {
            background-color: rgba(255,255,255,.1);
        }
        
        .nav-buttons-desktop {
            display: flex;
            gap: 15px;
        }
        
        .nav-buttons-mobile {
            display: none;
        }
        
        .mobile-menu {
            display: none;
            position: absolute;
            top: 56px;
            right: 12px;
            background: linear-gradient(90deg, rgba(2,42,108,0.95) 0%, rgba(10,61,143,0.95) 100%);
            border: 1px solid #064e9f;
            padding: 10px;
            border-radius: 8px;
            z-index: 1100;
            box-shadow: 0 8px 26px rgba(3,34,80,0.55);
            flex-direction: column;
            gap: 8px;
            min-width: 160px;
            backdrop-filter: blur(6px);
            color: #fff;
        }
        
        .mobile-menu.show {
            display: flex;
        }
        
        /* Mobile nav */
        @media (max-width:768px) {
            .nav-links {
                display: none;
            }
            .nav-buttons-desktop {
                display: none;
            }
            .nav-buttons-mobile {
                display: block;
            }
            .gta-nav {
                padding: 8px 12px;
                flex-wrap: nowrap;
                align-items: center;
            }
            .gta-title {
                font-size: 18px;
                padding: 6px 10px;
                white-space: nowrap;
            }
            .mobile-menu .nav-button, .mobile-menu .nav-link {
                display: flex;
                align-items: center;
                gap: 8px;
                background: rgba(255,255,255,.06);
                color: white;
                padding: 8px 10px;
                border-radius: 8px;
                text-decoration: none;
                border: none;
                cursor: pointer;
            }
        }
        :root {
            --background-dark: #0a0a0a;
            --surface-dark: #1a1a1a;
            --surface-light: #262626;
            --primary-accent: #00d4ff;
            --secondary-accent: #ff6b35;
            --text-light: #ffffff;
            --text-muted: #a0a0a0;
            --text-dim: #666666;
            --success: #00ff88;
            --warning: #ffaa00;
            --danger: #ff4757;
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-accent: linear-gradient(135deg, #00d4ff 0%, #00ff88 100%);
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 20px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.5);
            --shadow-xl: 0 16px 64px rgba(0, 0, 0, 0.6);
        }

        * {
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            background: var(--background-dark);
            background-image:
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 212, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(255, 107, 53, 0.1) 0%, transparent 50%);
            color: var(--text-light);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
        }

        /* 滚动条美化 */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--surface-dark);
        }
        ::-webkit-scrollbar-thumb {
            background: var(--primary-accent);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #00a8cc;
        }

        /* 加载动画 */
        .loader {
            width: 50px;
            height: 50px;
            border: 3px solid var(--surface-light);
            border-top: 3px solid var(--primary-accent);
            border-radius: 50%;
            animation: spin 1s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 卡片美化 */
        .card {
            background: var(--surface-dark);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: var(--shadow-sm);
            position: relative;
            overflow: hidden;
            animation: fadeInUp 0.6s ease-out forwards;
            opacity: 0;
            transform: translateY(30px);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--primary-accent), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary-accent);
        }

        .card:hover::before {
            opacity: 1;
        }

        /* 筛选动画 */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            to {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
                max-height: 0;
            }
            to {
                opacity: 1;
                transform: translateY(0);
                max-height: 1000px;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.05);
                opacity: 0.8;
            }
        }

        .animate-fade-in {
            animation: fadeIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        .animate-bounce {
            animation: pulse 2s infinite;
        }

        .card.removing {
            animation: fadeOut 0.3s ease-out forwards;
        }

        .card.adding {
            animation: fadeInUp 0.5s ease-out forwards;
        }

        .card:nth-child(1) { animation-delay: 0ms; }
        .card:nth-child(2) { animation-delay: 50ms; }
        .card:nth-child(3) { animation-delay: 100ms; }
        .card:nth-child(4) { animation-delay: 150ms; }
        .card:nth-child(5) { animation-delay: 200ms; }
        .card:nth-child(6) { animation-delay: 250ms; }
        .card:nth-child(7) { animation-delay: 300ms; }
        .card:nth-child(8) { animation-delay: 350ms; }
        .card:nth-child(9) { animation-delay: 400ms; }
        .card:nth-child(10) { animation-delay: 450ms; }
        .card:nth-child(11) { animation-delay: 500ms; }
        .card:nth-child(12) { animation-delay: 550ms; }

        .searching .card {
            transition: all 0.3s ease;
        }

        #vehicleGrid.searching {
            position: relative;
        }

        #vehicleGrid.searching::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(2px);
            z-index: 10;
            border-radius: 16px;
            transition: all 0.3s ease;
        }

        /* 平滑滚动优化 */
        html {
            scroll-behavior: smooth;
        }

        /* 过渡动画 */
        * {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        /* 标题美化 */
        header h1 {
            background: var(--gradient-accent);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: fadeIn 0.8s ease-out;
        }

        /* 筛选栏美化 */
        .filter-bar {
            background: rgba(26, 26, 26, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            box-shadow: var(--shadow-lg);
        }

        /* 输入框美化 */
        input, select {
            background: var(--surface-light) !important;
            border: 1px solid rgba(255, 255, 255, 0.2) !important;
            border-radius: 12px !important;
            transition: all 0.3s ease !important;
        }

        input:focus, select:focus {
            border-color: var(--primary-accent) !important;
            box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.2) !important;
            transform: translateY(-1px);
        }

        /* 滑动条美化 */
        input[type="range"] {
            -webkit-appearance: none !important;
            appearance: none !important;
            background: transparent !important;
            cursor: pointer !important;
            border: none !important;
            border-radius: 0 !important;
        }

        input[type="range"]::-webkit-slider-track {
            background: var(--surface-light) !important;
            height: 4px !important;
            border-radius: 2px !important;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none !important;
            appearance: none !important;
            width: 16px !important;
            height: 16px !important;
            background: var(--primary-accent) !important;
            border-radius: 50% !important;
            cursor: pointer !important;
            transition: all 0.3s ease !important;
            box-shadow: 0 0 0 2px rgba(0, 212, 255, 0.3) !important;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2) !important;
            box-shadow: 0 0 0 4px rgba(0, 212, 255, 0.4) !important;
        }

        input[type="range"]::-moz-range-track {
            background: var(--surface-light) !important;
            height: 4px !important;
            border-radius: 2px !important;
            border: none !important;
        }

        input[type="range"]::-moz-range-thumb {
            width: 16px !important;
            height: 16px !important;
            background: var(--primary-accent) !important;
            border-radius: 50% !important;
            cursor: pointer !important;
            border: none !important;
            transition: all 0.3s ease !important;
            box-shadow: 0 0 0 2px rgba(0, 212, 255, 0.3) !important;
        }

        /* 滑动条容器 */
        .space-y-2 label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-light);
            font-weight: 500;
        }

        /* 按钮美化 */
        button {
            border-radius: 12px !important;
            transition: all 0.3s ease !important;
            font-weight: 600 !important;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* 分页按钮 */
        .pagination-btn {
            background: var(--surface-light);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-light);
            transition: all 0.3s ease;
            border-radius: 12px;
            font-weight: 600;
        }

        .pagination-btn:hover {
            background: var(--primary-accent);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 212, 255, 0.4);
        }

        .pagination-btn.active {
            background: var(--gradient-accent);
            color: white;
            box-shadow: 0 4px 12px rgba(0, 212, 255, 0.4);
        }

        /* 详情页美化 */
        .gallery-main-image {
            aspect-ratio: 16 / 9;
            object-fit: cover;
            cursor: pointer;
            border-radius: 16px;
            transition: all 0.4s ease;
            box-shadow: var(--shadow-lg);
        }

        .gallery-main-image:hover {
            transform: scale(1.02);
            box-shadow: var(--shadow-xl);
        }

        .gallery-thumbnail {
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            border-radius: 8px;
            overflow: hidden;
        }

        .gallery-thumbnail:hover {
            transform: scale(1.1);
            border-color: var(--primary-accent);
            box-shadow: var(--shadow-md);
        }

        .gallery-thumbnail.active {
            border-color: var(--primary-accent);
            box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.3);
        }

        /* 详情页数据表格 */
        .details-table dt {
            color: var(--text-muted);
            font-weight: 500;
        }

        .details-table dd {
            color: var(--text-light);
            font-weight: 600;
        }

        /* 涂装卡片美化 */
        .livery-card {
            background: var(--surface-light);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .livery-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-accent);
        }

        /* Lightbox 优化 */
        #lightbox {
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(10px);
            transition: all 0.4s ease;
        }

        #lightbox-image {
            border-radius: 16px;
            box-shadow: var(--shadow-xl);
        }

        /* 标签和徽章 */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-free {
            background: var(--gradient-accent);
            color: white;
            animation: pulse 2s infinite;
        }

        .badge-class {
            background: rgba(0, 212, 255, 0.2);
            color: var(--primary-accent);
            border: 1px solid rgba(0, 212, 255, 0.3);
        }

        /* 性能条样式 */
        .stat-row {
            display: grid;
            grid-template-columns: 24px auto 50px;
            grid-template-areas:
                "icon label value"
                "icon bar bar";
            gap: 0.25rem 1rem;
            align-items: center;
            margin-bottom: 1rem;
        }
        @media (min-width: 1024px) {
            .stat-row {
                grid-template-columns: 24px 110px 1fr 50px;
                grid-template-areas: "icon label bar value";
                gap: 1rem;
            }
        }
        .stat-icon { grid-area: icon; fill: var(--text-muted); }
        .stat-label { grid-area: label; font-weight: 500; color: var(--text-muted); font-size: 0.875rem; }
        .stat-bar-segments { grid-area: bar; display: flex; gap: 4px; width: 100%; }
        .stat-value { grid-area: value; font-weight: 600; color: var(--text-light); text-align: right; font-size: 0.875rem; }

        /* 防止触摸滑动和溢出 */
        .touch-none {
            touch-action: none;
        }

        .touch-pan-y {
            touch-action: pan-y;
        }

        /* 防止横向滚动 */
        html, body {
            overflow-x: hidden;
            max-width: 100vw;
            position: relative;
        }

        /* 滑动条容器优化 */
        .range-wrapper {
            width: 100%;
            padding: 0 4px;
            box-sizing: border-box;
        }

        input[type="range"] {
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
        }

        /* 移动端滑动优化 */
        @media (max-width: 768px) {
            body {
                overscroll-behavior-x: none;
            }

            #sidebar {
                overscroll-behavior: contain;
                -webkit-overflow-scrolling: touch;
                scroll-behavior: smooth;
            }
            
            /* 移动端筛选栏滚动优化 */
            #sidebar > div {
                -webkit-overflow-scrolling: touch;
                scrollbar-width: thin;
                scrollbar-color: rgba(255,255,255,0.2) transparent;
                padding-bottom: 80px; /* 为底部添加额外空间 */
            }
            
            /* 隐藏滚动条但保持功能 */
            #sidebar > div::-webkit-scrollbar {
                width: 4px;
            }
            
            #sidebar > div::-webkit-scrollbar-track {
                background: transparent;
            }
            
            #sidebar > div::-webkit-scrollbar-thumb {
                background-color: rgba(255,255,255,0.2);
                border-radius: 2px;
            }
            
            /* 防止内容溢出 */
            #sidebar * {
                max-width: 100%;
                box-sizing: border-box;
            }
            
            /* 移动端触摸优化 */
            .touch-manipulation {
                touch-action: manipulation;
            }
        }

        /* 防止选择文本时滑动 */
        .no-select {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .stat-segment {
            flex: 1;
            height: 16px;
            background-color: var(--surface-dark);
            border: 1px solid #4b5563;
            position: relative;
            overflow: hidden;
            border-radius: 2px;
        }
        .stat-segment-fill {
            background-color: var(--text-light);
            height: 100%;
            position: absolute;
            left: 0;
            top: 0;
            transition: width 0.8s ease;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.375rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 600;
            border-radius: 9999px;
            border: 1px solid transparent;
        }

        .badge-free {
            background-color: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
            border-color: rgba(239, 68, 68, 0.3);
            backdrop-filter: blur(10px);
        }

        .badge-class {
            background-color: rgba(59, 130, 246, 0.2);
            color: #93c5fd;
            border-color: rgba(59, 130, 246, 0.3);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        /* Lightbox 样式 */
        #lightbox {
            transition: opacity 0.3s ease-in-out;
        }
        #lightbox.hidden {
            opacity: 0;
            pointer-events: none;
        }
        #lightbox-image {
            transition: transform 0.3s ease-in-out;
        }
        #lightbox.hidden #lightbox-image {
            transform: scale(0.95);
        }
        /* 筛选栏滚动隐藏样式 */
        .filter-bar {
            transition: transform 0.3s ease-in-out;
        }
        .filter-bar.hide {
            transform: translateY(-120%);
        }
        /* 涂装折叠样式 */
        #livery-gallery-container {
            display: grid;
            grid-template-rows: 0fr;
            transition: grid-template-rows 0.5s ease-in-out;
        }
        #livery-gallery-container > div {
            overflow: hidden;
        }
        #livery-gallery-container.expanded {
           grid-template-rows: 1fr;
        }
        #livery-chevron {
            transition: transform 0.3s ease;
        }
        #livery-chevron.rotate-180 {
            transform: rotate(180deg);
        }
        /* 搜索动画 */
        #vehicleGrid.searching {
            opacity: 0.5;
            transition: opacity 0.3s ease;
        }
    </style>
</head>
<body class="antialiased">
    <!-- GTA风格导航栏 -->
    <div class="gta-nav">
        <div class="nav-left">
            <h1 class="gta-title">🚗 GTA车辆百科</h1>
            <div class="nav-links">
                <a href="https://www.antwen.com" target="_blank">安稳</a>
                <a href="https://share.antwen.com" target="_blank">在线文件</a>
            </div>
        </div>
        <div class="nav-right">
            <!-- PC端显示 -->
            <div class="nav-buttons-desktop">
                <a href="index.html" class="nav-button">🏠 首页</a>
                <a href="los-santos-map.html" class="nav-button">🏙️ 洛圣都</a>
                <a href="cayo-perico-map.html" class="nav-button">🏝️ 佩里科岛</a>
                
            </div>
            <!-- 移动端显示 -->
            <div class="nav-buttons-mobile">
                <button class="menu-toggle mr-2" id="nav-search-toggle" title="搜索">
                    <i class="fas fa-search"></i>
                    <span style="margin-left:6px;">搜索</span>
                </button>
                <button class="menu-toggle" id="nav-mobile-menu-toggle">
                    <i class="fas fa-bars"></i> 更多
                </button>
                <div class="mobile-menu" id="nav-mobile-menu">
                    <a href="index.html" class="nav-button">🏠 首页</a>
                    <a href="los-santos-map.html" class="nav-button">🏙️ 洛圣都</a>
                    <a href="cayo-perico-map.html" class="nav-button">🏝️ 佩里科岛</a>
                    <a href="https://www.antwen.com" target="_blank" class="nav-link">🔗 安稳</a>
                    <a href="https://share.antwen.com" target="_blank" class="nav-link">☁️ 在线文件</a>
                </div>
            </div>
        </div>
    </div>

    <div id="app" class="container mx-auto p-4 md:p-8">
        <!-- 页面内容将由JS动态渲染 -->
    </div>

    <footer class="text-center p-4 text-gray-500 text-sm">
        <div class="mb-2">
            <span class="inline-flex gap-4">
                <a href="https://www.antwen.com" target="_blank" class="hover:text-white transition-colors">安稳</a>
                <a href="https://map.antwen.com" target="_blank" class="hover:text-white transition-colors">地图</a>
                <a href="https://share.antwen.com" target="_blank" class="hover:text-white transition-colors">文件</a>
            </span>
        </div>
        © 2025 Antwen aka Dinghy_421
    </footer>

    <!-- Lightbox Modal -->
    <div id="lightbox" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50" onclick="closeLightbox()">
        <button class="absolute top-4 right-6 text-white text-5xl font-bold hover:text-gray-300 transition-colors">&times;</button>
        <img id="lightbox-image" src="" class="max-w-[95vw] max-h-[90vh] object-contain" onclick="event.stopPropagation()">
    </div>

    <script>
        // --- 全局状态和数据 ---
let allVehicles = [];
let filteredVehicles = [];
const ITEMS_PER_PAGE = 20;
let currentPage = 1;
let lastScrollY = window.scrollY;

// 保存浏览状态
let browseState = {
    page: 1,
    searchTerm: '',
    classFilter: 'all',
    manufacturerFilter: 'all',
    sortOrder: 'date'
};

        // --- 路由和页面渲染 ---
        const app = document.getElementById('app');

        // 简单的哈希路由
        async function router() {
            const hash = window.location.hash || '#/';
            app.innerHTML = ''; // 清空页面
            window.scrollTo(0, 0); // 每次路由变化时滚动到顶部

            // 移除滚动监听器，防止在详情页触发
            window.removeEventListener('scroll', handleScroll);

            // 如果数据还没加载，先加载数据
            if (allVehicles.length === 0) {
                app.innerHTML = '<div class="flex justify-center items-center h-64"><div class="loader"></div></div>';
                try {
                    await fetchVehicles();
                } catch (error) {
                    app.innerHTML = `
                        <div class="text-center">
                            <h1 class="text-3xl font-bold text-red-500">加载失败</h1>
                            <p class="text-gray-400 mt-4">无法加载车辆数据：${error.message}</p>
                            <button onclick="router()" class="mt-8 inline-block bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">重试</button>
                        </div>
                    `;
                    return;
                }
            }

            if (hash.startsWith('#/vehicle/')) {
                const modelName = hash.substring('#/vehicle/'.length);
                renderDetailPage(modelName);
            } else {
                renderHomePage();
            }
        }

        // 渲染主页
        function renderHomePage() {
            app.innerHTML = `

                
                <div class="text-center mb-8">
                    <h1 class="text-5xl font-bold text-white mb-3 bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent">
                        车辆数据库
                    </h1>
                    <p class="text-gray-400 text-lg">探索洛圣都的每一辆座驾</p>
                    <div class="w-24 h-1 bg-gradient-to-r from-blue-500 to-purple-500 mx-auto mt-4 rounded-full"></div>
                </div>
                <!-- 移动端菜单按钮 -->
                <button id="mobile-menu-toggle" class="lg:hidden fixed top-4 left-4 z-50 p-2 bg-gray-800/90 backdrop-blur-sm rounded-lg shadow-lg text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>

                <!-- 遮罩层 -->
                <div id="overlay" class="fixed inset-0 bg-black/50 z-40 hidden lg:hidden"></div>

                <div class="flex flex-col lg:flex-row gap-6">
                    <!-- 筛选区域 -->
        <div id="sidebar" class="fixed lg:sticky top-0 left-0 h-screen lg:h-fit w-80 xl:w-96 bg-gray-800 lg:bg-transparent z-50 lg:z-40 transition-all duration-300 lg:translate-x-0 -translate-x-full lg:translate-x-0">
                        <div class="bg-gray-800/95 backdrop-blur-sm p-4 shadow-lg space-y-4 overflow-y-auto h-full lg:h-auto max-h-screen lg:max-h-[calc(100vh-2rem)] rounded-xl border border-gray-700/50">
                            <!-- 移动端关闭按钮 -->
                            <div class="flex justify-between items-center lg:hidden">
                                <h3 class="text-lg font-semibold text-white">搜索和筛选</h3>
                                <div class="flex gap-2">
                                    <button id="resetFiltersBtn-mobile" class="px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700 transition-colors">
                                        重置
                                    </button>
                                    <button id="close-sidebar" class="p-2 text-white hover:text-gray-300">
                                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>

                            <div class="flex gap-2">
                                <div class="relative flex-grow">
                                <input type="text" id="searchInput" placeholder="按中文或英文名搜索车辆..."
                                       class="w-full p-3 pl-10 pr-4 bg-gray-700 text-white rounded-lg border border-gray-600
                                              focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-300
                                              hover:border-blue-400" list="search-suggestions">
                                <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                          d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </div>
                                <button id="searchButton" class="p-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold whitespace-nowrap transition-all duration-300 hover:shadow-lg">搜索</button>
                            </div>
                            <datalist id="search-suggestions"></datalist>
                            <div class="space-y-3">
                                <select id="classFilter" class="w-full p-3 bg-gray-700 text-white rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-300 hover:border-blue-400">
                                    <option value="all">所有类型</option>
                                </select>
                                <select id="manufacturerFilter" class="w-full p-3 bg-gray-700 text-white rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-300 hover:border-blue-400">
                                    <option value="all">所有制造商</option>
                                </select>
                                <select id="sortSelect" class="w-full p-3 bg-gray-700 text-white rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-300 hover:border-blue-400">
                            <option value="date">按发布日期排序</option>
                            <option value="name">按名称排序</option>
                        </select>



                                <!-- 独立筛选条件 -->
                                <select id="hasFreeLiveryFilter" class="w-full p-3 bg-gray-700 text-white rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-300 hover:border-blue-400">
                                    <option value="all">免费涂装</option>
                                    <option value="true">有免费涂装</option>
                                    <option value="false">无免费涂装</option>
                                </select>

                                <select id="hasHaoUpgradeFilter" class="w-full p-3 bg-gray-700 text-white rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-300 hover:border-blue-400">
                                    <option value="all">阿浩改装</option>
                                    <option value="true">有阿浩改装</option>
                                    <option value="false">无阿浩改装</option>
                                </select>

                                <select id="hasDriftTuneFilter" class="w-full p-3 bg-gray-700 text-white rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-300 hover:border-blue-400">
                                    <option value="all">漂移改装</option>
                                    <option value="true">有漂移改装</option>
                                    <option value="false">无漂移改装</option>
                                </select>

                                <select id="hasImaniUpgradeFilter" class="w-full p-3 bg-gray-700 text-white rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-300 hover:border-blue-400">
                                    <option value="all">伊玛尼改装</option>
                                    <option value="true">有伊玛尼改装</option>
                                    <option value="false">无伊玛尼改装</option>
                                </select>

                                <select id="hasMissileProtectionFilter" class="w-full p-3 bg-gray-700 text-white rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-300 hover:border-blue-400">
                                    <option value="all">导弹锁定</option>
                                    <option value="true">有导弹锁定保护</option>
                                    <option value="false">无导弹锁定保护</option>
                                </select>

                                <select id="isRemovedByRockstarFilter" class="w-full p-3 bg-gray-700 text-white rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-300 hover:border-blue-400">
                                    <option value="all">R星移除</option>
                                    <option value="true">已被R星移除</option>
                                    <option value="false">未被R星移除</option>
                                </select>

                                <select id="dlcFilter" class="w-full p-3 bg-gray-700 text-white rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-300 hover:border-blue-400">
                                    <option value="all">所有DLC</option>
                                </select>

                                <select id="topSpeedFilter" class="w-full p-3 bg-gray-700 text-white rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-300 hover:border-blue-400">
                                    <option value="all">实测最高速度</option>
                                    <option value="0-100">0-100 mph</option>
                                    <option value="100-110">100-110 mph</option>
                                    <option value="110-120">110-120 mph</option>
                                    <option value="120-130">120-130 mph</option>
                                    <option value="130-140">130-140 mph</option>
                                    <option value="140+">140+ mph</option>
                                </select>

                                <select id="seatsFilter" class="w-full p-3 bg-gray-700 text-white rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-300 hover:border-blue-400">
                                    <option value="all">座位数</option>
                                    <option value="1">1座</option>
                                    <option value="2">2座</option>
                                    <option value="4">4座</option>
                                    <option value="6">6座</option>
                                    <option value="8+">8座及以上</option>
                                </select>

                                <select id="drivetrainFilter" class="w-full p-3 bg-gray-700 text-white rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-300 hover:border-blue-400">
                                    <option value="all">驱动方式</option>
                                    <option value="FWD">前轮驱动 (FWD)</option>
                                    <option value="RWD">后轮驱动 (RWD)</option>
                                    <option value="AWD">全轮驱动 (AWD)</option>
                                </select>

                                <!-- 价格区间滑动条 -->
                                <div class="space-y-3">
                                    <label class="text-sm font-medium text-gray-300">价格区间</label>
                                    <div class="space-y-4">
                                        <div>
                                            <div class="flex justify-between text-sm mb-1">
                                                <span>最低价</span>
                                                <span id="priceMinDisplay" class="text-blue-400">0</span>
                                            </div>
                                            <input type="range" id="priceMin" min="0" max="10000000" value="0" step="10000"
                                                   class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                                        </div>
                                        <div>
                                            <div class="flex justify-between text-sm mb-1">
                                                <span>最高价</span>
                                                <span id="priceMaxDisplay" class="text-blue-400">1000万</span>
                                            </div>
                                            <input type="range" id="priceMax" min="0" max="10000000" value="10000000" step="10000"
                                                   class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                                        </div>
                                        <div class="flex justify-between text-xs text-gray-400 mt-1">
                                            <span>0</span>
                                            <span>1000万</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- 实测最高速度滑动条 -->
                                <div class="space-y-3">
                                    <label class="text-sm font-medium text-gray-300">实测最高速度</label>
                                    <div class="space-y-4">
                                        <div>
                                            <div class="flex justify-between text-sm mb-1">
                                                <span>最低速度</span>
                                                <span id="speedMinDisplay" class="text-blue-400">0 mph</span>
                                            </div>
                                            <input type="range" id="speedMin" min="0" max="200" value="0" step="1"
                                                   class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                                        </div>
                                        <div>
                                            <div class="flex justify-between text-sm mb-1">
                                                <span>最高速度</span>
                                                <span id="speedMaxDisplay" class="text-blue-400">200 mph</span>
                                            </div>
                                            <input type="range" id="speedMax" min="0" max="200" value="200" step="1"
                                                   class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                                        </div>
                                        <div class="flex justify-between text-xs text-gray-400 mt-1">
                                            <span>0 mph</span>
                                            <span>200 mph</span>
                                        </div>
                                    </div>
                                </div>

                                <button id="resetFiltersBtn" class="w-full p-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors duration-300 font-medium">
                                    重置筛选
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 右侧：车辆列表 -->
                    <div class="flex-1 lg:ml-0">
                        <div id="loader" class="flex justify-center items-center h-64"><div class="loader"></div></div>
                        <div id="vehicleGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>
                        <div id="pagination" class="flex justify-center items-center mt-12 space-x-2"></div>
                    </div>
                </div>

            `;
            // 只有在数据加载完成后才绑定事件监听器
            if (allVehicles.length > 0) {
                setupEventListeners();
                populateFilters();
                restoreBrowseState();
                // 使用恢复的状态进行筛选和显示，不重置页码
                performInitialDisplay();
            }
        }

        // 渲染详情页
        function renderDetailPage(modelName) {
            const vehicle = allVehicles.find(v => v.ModelName === modelName);
            if (!vehicle) {
                app.innerHTML = `
                    <div class="text-center">
                        <h1 class="text-3xl font-bold text-red-500">错误：未找到车辆</h1>
                        <p class="text-gray-400 mt-4">找不到模型名称为 "${modelName}" 的车辆。</p>
                        <a href="#/" class="mt-8 inline-block bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">返回主页</a>
                    </div>
                `;
                return;
            }

            const processImageUrl = (url) => {
                if (url && !url.startsWith('http')) {
                    return 'https://eo-gta-images.antwen.com/' + url;
                }
                return url;
            };
            const mainImage = processImageUrl(vehicle.ImageUrl) || 'https://placehold.co/1280x720/1f2937/FFF?text=No+Image';
            const screenshots = (vehicle.ScreenShots || vehicle['截图'] || []).map(processImageUrl);

            app.innerHTML = `
                <div class="bg-gray-800 p-4 sm:p-8 rounded-lg shadow-2xl">
                    <div class="mb-6">
                        <a href="#/" class="text-blue-400 hover:text-blue-300 transition-colors">&larr; 返回列表</a>
                    </div>

                    <div class="flex flex-col lg:flex-row lg:gap-8">
                        <!-- 移动端：标题和图片区先行 -->
                        <div class="lg:w-2/5 w-full mb-8 lg:mb-0">
                            <div class="lg:hidden mb-4">
                                <h1 class="text-3xl font-bold text-white">${vehicle.DisplayName.SimplifiedChinese}</h1>
                                <h2 class="text-xl text-gray-400">${vehicle.DisplayName.English}</h2>
                            </div>
                            <h3 class="text-xl md:text-2xl font-bold text-white mb-4">车辆截图</h3>
                            <img id="main-image" src="${mainImage}" alt="${vehicle.DisplayName.English}" class="w-full rounded-lg shadow-lg gallery-main-image" onclick="openLightbox(this.src)" onerror="this.onerror=null;this.src='https://placehold.co/1280x720/1f2937/FFF?text=Image+Not+Found';">
                            ${screenshots.length > 0 ? `
                                <div id="thumbnail-gallery" class="grid grid-cols-4 sm:grid-cols-5 gap-2 mt-4">
                                    <img src="${mainImage}" class="w-full h-auto rounded gallery-thumbnail active" onclick="changeMainImage('${mainImage}')">
                                    ${screenshots.map(ss => `<img src="${ss}" class="w-full h-auto rounded gallery-thumbnail" onclick="changeMainImage('${ss}')" onerror="this.style.display='none'">`).join('')}
                                </div>
                            ` : ''}
                            <div class="mt-8">
                                <h3 class="text-xl md:text-2xl font-bold text-white mb-4">性能参数</h3>
                                ${renderStatBars(vehicle)}
                            </div>
                            <div class="mt-8">
                                ${renderVehicleDetails(vehicle, 'special')}
                            </div>
                        </div>

                        <!-- 详细信息区 -->
                        <div class="lg:w-3/5 w-full">
                            <div class="hidden lg:block">
                                <h1 class="text-3xl md:text-4xl font-bold text-white">${vehicle.DisplayName.SimplifiedChinese}</h1>
                                <h2 class="text-xl md:text-2xl text-gray-400 mb-4">${vehicle.DisplayName.English}</h2>
                            </div>
                            <div class="details-table grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-4 text-base md:text-lg">
                                ${renderVehicleDetails(vehicle, 'primary')}
                            </div>
                            <div class="mt-8">
                                <h3 class="text-xl md:text-2xl font-bold text-white mb-4">附加信息</h3>
                                <div class="details-table grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-4 text-base md:text-lg">
                                    ${renderVehicleDetails(vehicle, 'secondary')}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 涂装展示区 -->
                    ${renderLiverySection(vehicle)}

                </div>
            `;
        }

        // --- 数据处理和DOM操作 ---

        // 渲染车辆详情的键值对
        function renderVehicleDetails(vehicle, type) {
            let detailsHtml = '';
            const primaryKeys = ['ModelName', 'Class', 'Price', 'SellPrice', 'Dealer', 'ManufacturerDisplayName', 'ReleaseDate', 'DlcName', 'TopSpeedTested', 'LapTime', 'Seats', 'Weight', 'Drivetrain', 'Gears'];
            const secondaryKeys = ['Storage', 'DeliveryMethod', 'ModificationShop', 'SellMethod', 'RaceAvailability', 'BasedOn', 'isRemovedByRockstar', 'Armor'];
            const specialKeys = ['hasDriftTune', 'hasHaoUpgrade', 'hasImaniUpgrade', 'hasMissileProtection'];

            let keysToRender;
            if (type === 'primary') keysToRender = primaryKeys;
            else if (type === 'secondary') keysToRender = secondaryKeys;
            else if (type === 'special') keysToRender = specialKeys;
            else keysToRender = [];

            if (type === 'special' && specialKeys.some(key => vehicle[key] !== undefined && vehicle[key] !== null && vehicle[key] !== 0)) {
                 detailsHtml += '<h3 class="text-xl md:text-2xl font-bold text-white mb-4">特殊改装</h3><div class="details-table grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-4 text-lg">';
            }

            keysToRender.forEach(key => {
                if (vehicle[key] !== undefined && vehicle[key] !== null) {
                    detailsHtml += renderDetailRow(key, vehicle[key]);
                }
            });

            if (type === 'special' && specialKeys.some(key => vehicle[key] !== undefined && vehicle[key] !== null && vehicle[key] !== 0)) {
                detailsHtml += '</div>';
            }

            return detailsHtml;
        }

        // 渲染单条详情
        function renderDetailRow(key, value) {
            const keyTranslations = {
                ModelName: '模型名称', Class: '车辆类型', Price: '价格', SellPrice: '出售价格', Dealer: '经销商',
                ManufacturerDisplayName: '制造商', ReleaseDate: '发布日期', DlcName: 'DLC', TopSpeedTested: '实测最高速度',
                LapTime: '圈速', Seats: '座位数', Weight: '重量', Drivetrain: '驱动方式', Gears: '档位', Armor: '装甲',
                hasDriftTune: '漂移改装', hasHaoUpgrade: '阿浩升级', hasImaniUpgrade: '伊玛尼技术', hasMissileProtection: '导弹锁定干扰',
                isRemovedByRockstar: '已被R星移除', Storage: '存放地点', DeliveryMethod: '运送方式', ModificationShop: '改装店',
                SellMethod: '出售方式', RaceAvailability: '竞速可用', BasedOn: '基于现实'
            };

            let displayValue = value;
            if (key === 'ManufacturerDisplayName' && typeof value === 'object') {
                displayValue = value.SimplifiedChinese || value.English;
            } else if (typeof value === 'boolean' || [0, 1].includes(value)) {
                displayValue = value ? '<span class="text-green-400">是</span>' : '<span class="text-red-400">否</span>';
            }

            return `
                <div>
                    <dt>${keyTranslations[key] || key}</dt>
                    <dd class="font-semibold">${displayValue}</dd>
                </div>
            `;
        }

        // 渲染性能条
        function renderStatBars(vehicle) {
            const stats = [
                { key: 'StatSpeed', label: '速度', icon: `<svg class="stat-icon" viewBox="0 0 24 24" width="24" height="24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.5 6h-3v5l4.25 2.52.75-1.23-3.5-2.07V8z" fill="currentColor"/></svg>` },
                { key: 'StatAcceleration', label: '加速', icon: `<svg class="stat-icon" viewBox="0 0 24 24" width="24" height="24"><path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z" fill="currentColor"/></svg>` },
                { key: 'StatBraking', label: '刹车', icon: `<svg class="stat-icon" viewBox="0 0 24 24" width="24" height="24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-4-4h8v-2H8v2zm8-3H8V9h8v2z" fill="currentColor"/></svg>` },
                { key: 'StatHandling', label: '操控', icon: `<svg class="stat-icon" viewBox="0 0 24 24" width="24" height="24"><path d="M19 8H5c-1.1 0-2 .9-2 2v4c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-4c0-1.1-.9-2-2-2zm-4 5H9v-2h6v2z" fill="currentColor"/></svg>` }
            ];

            let statsHtml = '<div class="space-y-3">';

            stats.forEach(stat => {
                const value = parseFloat(vehicle[stat.key]);
                if (!isNaN(value)) {
                    let segmentsHtml = '';
                    const filledSegments = value / 20; // 5 segments total (100 / 20)
                    for (let i = 0; i < 5; i++) {
                        let fillWidth = '0%';
                        if (i < Math.floor(filledSegments)) {
                            fillWidth = '100%';
                        } else if (i === Math.floor(filledSegments)) {
                            fillWidth = `${(filledSegments - Math.floor(filledSegments)) * 100}%`;
                        }
                        segmentsHtml += `
                            <div class="stat-segment">
                                <div class="stat-segment-fill" style="width: ${fillWidth};"></div>
                            </div>
                        `;
                    }

                    statsHtml += `
                        <div class="stat-row">
                            ${stat.icon}
                            <span class="stat-label">${stat.label}</span>
                            <div class="stat-bar-segments">${segmentsHtml}</div>
                            <span class="stat-value">${value.toFixed(2)}</span>
                        </div>
                    `;
                }
            });

            statsHtml += '</div>';
            return statsHtml;
        }

        // 渲染涂装画廊
        function renderLiverySection(vehicle) {
            const liveries = vehicle.liveries;
            if (!liveries || liveries.length === 0) {
                return '';
            }

            const galleryHtml = `
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                    ${liveries.map(livery => {
                        const price = livery.price || 'N/A';
                        const isFree = price.toLowerCase() === 'free';
                        const nameClass = isFree ? 'text-red-400 font-bold' : 'text-gray-300';
                        const priceClass = isFree ? 'text-red-400' : 'text-green-400';
                        let localLiveryPath = `images/${vehicle.ModelName}/${vehicle.ModelName}_livery_${livery.id}.jpg`;
                        if (!localLiveryPath.startsWith('http')) {
                            localLiveryPath = 'https://eo-gta-images.antwen.com/' + localLiveryPath;
                        }

                        return `
                        <div class="livery-card rounded-lg overflow-hidden shadow-md flex flex-col">
                            <img src="${localLiveryPath}" alt="${livery.livery_name}" class="w-full h-40 object-cover" onclick="openLightbox(this.src)" onerror="this.onerror=null;this.src='https://placehold.co/600x400/2a374a/FFF?text=Image+Not+Found';">
                            <div class="p-3 flex flex-col flex-grow">
                                <p class="text-base ${nameClass} text-center flex-grow">${livery.livery_name}</p>
                                <div class="flex justify-between items-center text-sm mt-2 pt-2 border-t border-gray-700">
                                    <span class="font-mono bg-gray-700 px-2 py-1 rounded text-xs">ID: ${livery.id || 'N/A'}</span>
                                    <span class="font-semibold ${priceClass}">${price}</span>
                                </div>
                            </div>
                        </div>
                        `;
                    }).join('')}
                </div>
            `;

            return `
                <div class="mt-10 pt-8 border-t border-gray-700">
                    <button id="toggle-livery-btn" onclick="toggleLiveries()" class="w-full text-left text-2xl font-bold text-white mb-4 flex justify-between items-center">
                        <span>涂装展示</span>
                        <svg id="livery-chevron" class="w-6 h-6 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div id="livery-gallery-container">
                        <div>${galleryHtml}</div>
                    </div>
                </div>
            `;
        }

        // 切换详情页主图
        function changeMainImage(src) {
            document.getElementById('main-image').src = src;
            const thumbnails = document.querySelectorAll('.gallery-thumbnail');
            thumbnails.forEach(thumb => {
                thumb.classList.toggle('active', thumb.src === src);
            });
        }

        // Lightbox functions
        function openLightbox(src) {
            const lightbox = document.getElementById('lightbox');
            const lightboxImage = document.getElementById('lightbox-image');
            lightboxImage.src = src;
            lightbox.classList.remove('hidden');
        }

        function closeLightbox() {
            document.getElementById('lightbox').classList.add('hidden');
        }

        // 涂装折叠功能
        function toggleLiveries() {
            const gallery = document.getElementById('livery-gallery-container');
            const chevron = document.getElementById('livery-chevron');
            gallery.classList.toggle('expanded');
            chevron.classList.toggle('rotate-180');
        }

        // 动态平衡详情页的列
        function balanceDetailColumns() {
            // 只在桌面端执行
            if (window.innerWidth < 1024) return;

            setTimeout(() => {
                const leftCol = document.getElementById('details-left-col');
                const rightCol = document.getElementById('details-right-col');
                const secondaryDetails = document.getElementById('secondary-details-container');

                if (leftCol && rightCol && secondaryDetails) {
                    // 检查左列是否比右列高出很多
                    if (leftCol.offsetHeight > rightCol.offsetHeight + 150) {
                        // 将附加信息块移动到右列
                        rightCol.appendChild(secondaryDetails);
                    }
                }
            }, 100); // 使用 setTimeout 确保浏览器已渲染完成
        }

        // 根据导航栏高度调整主内容顶部间距，避免导航栏遮挡内容
        function adjustContentForNav() {
            const nav = document.querySelector('.gta-nav');
            const appEl = document.getElementById('app');
            if (!nav || !appEl) return;
            const navHeight = nav.offsetHeight || 0;
            // 给内容区域添加与导航高度相等的顶部内边距，额外留白 8px
            appEl.style.paddingTop = (navHeight + 8) + 'px';

            // 如果存在 overlay（用于移动端遮罩），调整其 top 与高度，避免覆盖导航栏
            const overlay = document.getElementById('overlay');
            if (overlay) {
                overlay.style.top = navHeight + 'px';
                overlay.style.height = `calc(100% - ${navHeight}px)`;
            }

            // 如果存在侧边栏，调整其 top 与高度，避免被导航遮挡
            const sidebar = document.getElementById('sidebar');
            if (sidebar) {
                sidebar.style.top = navHeight + 'px';
                sidebar.style.height = `calc(100% - ${navHeight}px)`;
            }
        }

        // 初始显示车辆，使用恢复的状态
        function performInitialDisplay() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const classFilter = document.getElementById('classFilter').value;
            const manufacturerFilter = document.getElementById('manufacturerFilter').value;
            const sortMethod = document.getElementById('sortSelect').value;

            let tempVehicles = [...allVehicles];

            // 1. 搜索
            if (searchTerm) {
                tempVehicles = tempVehicles.filter(v => {
                    const nameSC = v.DisplayName?.SimplifiedChinese?.toLowerCase() || '';
                    const nameEN = v.DisplayName?.English?.toLowerCase() || '';
                    return nameSC.includes(searchTerm) || nameEN.includes(searchTerm);
                });
            }

            // 2. 分类
            if (classFilter !== 'all') {
                tempVehicles = tempVehicles.filter(v => v.Class === classFilter);
            }
            if (manufacturerFilter !== 'all') {
                tempVehicles = tempVehicles.filter(v => (v.ManufacturerDisplayName?.SimplifiedChinese || v.ManufacturerDisplayName?.English) === manufacturerFilter);
            }

            // 3. 排序
            if (sortMethod === 'name') {
                tempVehicles.sort((a, b) => a.DisplayName.English.localeCompare(b.DisplayName.English));
            } else if (sortMethod === 'date') {
                tempVehicles.sort((a, b) => {
                    const dateA = new Date(a.ReleaseDate);
                    const dateB = new Date(b.ReleaseDate);
                    return dateB - dateA;
                });
            }

            filteredVehicles = tempVehicles;

            // 初始显示时不重置页码，直接使用恢复的状态
            displayVehicles();

            // 状态恢复完成后重置标记
            setTimeout(() => {
                isRestoringState = false;
            }, 50);
        }

        // 搜索、分类和排序处理（用户主动操作时调用）
        function applyFiltersAndSort() {
            const grid = document.getElementById('vehicleGrid');
            if (grid) {
                grid.classList.add('searching');
            }

            // 使用 setTimeout 来创建动画效果
            setTimeout(() => {
                const searchTerm = document.getElementById('searchInput').value.toLowerCase();
                const classFilter = document.getElementById('classFilter').value;
                const manufacturerFilter = document.getElementById('manufacturerFilter').value;
                const sortMethod = document.getElementById('sortSelect').value;
                const hasFreeLiveryFilter = document.getElementById('hasFreeLiveryFilter').value;
                const hasHaoUpgradeFilter = document.getElementById('hasHaoUpgradeFilter').value;
                const hasDriftTuneFilter = document.getElementById('hasDriftTuneFilter').value;
                const hasImaniUpgradeFilter = document.getElementById('hasImaniUpgradeFilter').value;
                const hasMissileProtectionFilter = document.getElementById('hasMissileProtectionFilter').value;
                const isRemovedByRockstarFilter = document.getElementById('isRemovedByRockstarFilter').value;
                const dlcFilter = document.getElementById('dlcFilter').value;
                const topSpeedFilter = document.getElementById('topSpeedFilter').value;
                const seatsFilter = document.getElementById('seatsFilter').value;
                const drivetrainFilter = document.getElementById('drivetrainFilter').value;
                const priceMin = parseInt(document.getElementById('priceMin').value) || 0;
                const priceMax = parseInt(document.getElementById('priceMax').value) || 10000000;
                const speedMin = parseInt(document.getElementById('speedMin').value) || 0;
                const speedMax = parseInt(document.getElementById('speedMax').value) || 200;

                let tempVehicles = [...allVehicles];

                // 1. 搜索
                if (searchTerm) {
                    tempVehicles = tempVehicles.filter(v => {
                        const nameSC = v.DisplayName?.SimplifiedChinese?.toLowerCase() || '';
                        const nameEN = v.DisplayName?.English?.toLowerCase() || '';
                        return nameSC.includes(searchTerm) || nameEN.includes(searchTerm);
                    });
                }

                // 2. 分类
                if (classFilter !== 'all') {
                    tempVehicles = tempVehicles.filter(v => v.Class === classFilter);
                }
                if (manufacturerFilter !== 'all') {
                    tempVehicles = tempVehicles.filter(v => (v.ManufacturerDisplayName?.SimplifiedChinese || v.ManufacturerDisplayName?.English) === manufacturerFilter);
                }

                // 3. 独立筛选条件
                if (hasFreeLiveryFilter !== 'all') {
                    tempVehicles = tempVehicles.filter(v =>
                        hasFreeLiveryFilter === 'true'
                            ? (v.liveries && v.liveries.some(l => l.price && l.price.toLowerCase() === 'free'))
                            : !(v.liveries && v.liveries.some(l => l.price && l.price.toLowerCase() === 'free'))
                    );
                }
                if (hasHaoUpgradeFilter !== 'all') {
                    tempVehicles = tempVehicles.filter(v =>
                        hasHaoUpgradeFilter === 'true' ? v.hasHaoUpgrade === 1 : v.hasHaoUpgrade !== 1
                    );
                }
                if (hasDriftTuneFilter !== 'all') {
                    tempVehicles = tempVehicles.filter(v =>
                        hasDriftTuneFilter === 'true' ? v.hasDriftTune === 1 : v.hasDriftTune !== 1
                    );
                }
                if (hasImaniUpgradeFilter !== 'all') {
                    tempVehicles = tempVehicles.filter(v =>
                        hasImaniUpgradeFilter === 'true' ? v.hasImaniUpgrade === 1 : v.hasImaniUpgrade !== 1
                    );
                }
                if (hasMissileProtectionFilter !== 'all') {
                    tempVehicles = tempVehicles.filter(v =>
                        hasMissileProtectionFilter === 'true' ? v.hasMissileProtection === 1 : v.hasMissileProtection !== 1
                    );
                }
                if (isRemovedByRockstarFilter !== 'all') {
                    tempVehicles = tempVehicles.filter(v =>
                        isRemovedByRockstarFilter === 'true' ? v.isRemovedByRockstar === 1 : v.isRemovedByRockstar !== 1
                    );
                }

                // 新的筛选条件
                if (dlcFilter !== 'all') {
                    tempVehicles = tempVehicles.filter(v => v.DlcName === dlcFilter);
                }

                if (topSpeedFilter !== 'all') {
                    tempVehicles = tempVehicles.filter(v => {
                        const speed = parseFloat(v.TopSpeedTested) || 0;
                        switch (topSpeedFilter) {
                            case '0-100': return speed > 0 && speed <= 100;
                            case '100-110': return speed > 100 && speed <= 110;
                            case '110-120': return speed > 110 && speed <= 120;
                            case '120-130': return speed > 120 && speed <= 130;
                            case '130-140': return speed > 130 && speed <= 140;
                            case '140+': return speed > 140;
                            default: return true;
                        }
                    });
                }

                if (seatsFilter !== 'all') {
                    tempVehicles = tempVehicles.filter(v => {
                        const seats = parseInt(v.Seats) || 0;
                        switch (seatsFilter) {
                            case '1': return seats === 1;
                            case '2': return seats === 2;
                            case '4': return seats === 4;
                            case '6': return seats === 6;
                            case '8+': return seats >= 8;
                            default: return true;
                        }
                    });
                }

                if (drivetrainFilter !== 'all') {
                    tempVehicles = tempVehicles.filter(v => v.Drivetrain === drivetrainFilter);
                }

                // 价格区间筛选
                tempVehicles = tempVehicles.filter(v => {
                    const priceText = v.Price || '0';
                    // 移除美元符号和逗号，转换为数字
                    const price = parseInt(priceText.replace(/[$,]/g, '')) || 0;
                    return price >= priceMin && price <= priceMax;
                });

                // 实测最高速度区间筛选
                tempVehicles = tempVehicles.filter(v => {
                    const speed = parseFloat(v.TopSpeedTested) || 0;
                    return speed >= speedMin && speed <= speedMax;
                });

                // 4. 排序
                if (sortMethod === 'name') {
                    tempVehicles.sort((a, b) => a.DisplayName.English.localeCompare(b.DisplayName.English));
                } else if (sortMethod === 'date') {
                    tempVehicles.sort((a, b) => {
                        const dateA = new Date(a.ReleaseDate);
                        const dateB = new Date(b.ReleaseDate);
                        return dateB - dateA;
                    });
                }

                filteredVehicles = tempVehicles;

                // 只在用户主动筛选时重置到第一页，恢复状态时不重置
                if (!isRestoringState) {
                    currentPage = 1;
                }

                displayVehicles();

                if (!isRestoringState) {
                    saveBrowseState();
                }

                if (grid) {
                    grid.classList.remove('searching');
                }
            }, 300);
        }

// 显示车辆网格
        function displayVehicles() {
            const loader = document.getElementById('loader');
            if (loader) loader.style.display = 'none';

            const grid = document.getElementById('vehicleGrid');
            if (!grid) return;

            const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;
            const endIndex = startIndex + ITEMS_PER_PAGE;
            const paginatedVehicles = filteredVehicles.slice(startIndex, endIndex);

            if (paginatedVehicles.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center py-16 animate-fade-in">
                        <svg class="w-16 h-16 mx-auto text-gray-500 mb-4 animate-bounce" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <h3 class="text-xl font-semibold text-gray-400 mb-2">未找到匹配的车辆</h3>
                        <p class="text-gray-500">尝试调整搜索条件或重置过滤器</p>
                    </div>
                `;
                return;
            }

            // 创建新的文档片段来批量添加卡片
            const fragment = document.createDocumentFragment();

            // 先隐藏现有卡片
            const existingCards = grid.querySelectorAll('.card');
            existingCards.forEach((card, index) => {
                setTimeout(() => {
                    card.style.animation = 'fadeOut 0.3s ease-out forwards';
                }, index * 50);
            });

            // 延迟添加新卡片，创造流畅的过渡效果
            setTimeout(() => {
                grid.innerHTML = '';
                paginatedVehicles.forEach((vehicle, index) => {
                    const card = document.createElement('a');
                    card.href = `#/vehicle/${vehicle.ModelName}`;
                    card.className = 'card block rounded-lg shadow-md overflow-hidden flex flex-col adding';
                    card.style.animationDelay = `${index * 100}ms`;

                const hasFreeLivery = vehicle.liveries && vehicle.liveries.some(l => l.price && l.price.toLowerCase() === 'free');
                const screenshots = vehicle.ScreenShots || vehicle['截图'] || [];
                const processImageUrl = (url) => {
                    if (url && !url.startsWith('http')) {
                        return 'https://eo-gta-images.antwen.com/' + url;
                    }
                    return url;
                };
                const cardImageUrl = processImageUrl(vehicle.ImageUrl) || (screenshots.length > 0 ? processImageUrl(screenshots[0]) : 'https://placehold.co/600x400/1f2937/FFF?text=No+Image');

                card.innerHTML = `
                    <div class="relative overflow-hidden">
                        <img src="${cardImageUrl}" alt="${vehicle.DisplayName.English}"
                             class="w-full h-48 object-cover transition-transform duration-300 hover:scale-110"
                             onerror="this.onerror=null;this.src='https://placehold.co/600x400/1f2937/FFF?text=Image+Not+Found';">
                        ${hasFreeLivery ? '<div class="absolute top-3 right-3 badge badge-free text-xs">隐藏涂装</div>' : ''}
                        <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent h-16"></div>
                    </div>
                    <div class="p-5 flex flex-col flex-grow">
                        <div class="flex-grow">
                        <h3 class="text-xl font-bold text-white mb-1 truncate">${vehicle.DisplayName.SimplifiedChinese}</h3>
                        <p class="text-sm text-gray-400 mb-3 truncate opacity-80">${vehicle.DisplayName.English}</p>
                        <div class="flex flex-wrap items-center gap-2 mb-3">
                            <span class="badge badge-class text-xs">${vehicle.Class || '未知'}</span>
                            ${generateSpecialBadges(vehicle)}
                        </div>
                    </div>
                        <div class="border-t border-gray-700 pt-3">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-xs text-gray-500 mb-1">制造商</p>
                                    <p class="text-sm font-medium text-gray-300">${vehicle.ManufacturerDisplayName.SimplifiedChinese || vehicle.ManufacturerDisplayName.English || '未知'}</p>
                                </div>
                                <div class="text-right">
                                    <p class="text-xs text-gray-500 mb-1">价格</p>
                                    <span class="font-bold text-lg text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-emerald-500">
                                        ${vehicle.Price || 'N/A'}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                fragment.appendChild(card);
                });

                grid.appendChild(fragment);
                renderPagination();

                // 滚动到顶部，带有平滑动画
                if (!isRestoringState) {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            }, 400); // 等待淡出动画完成
        }
        // 渲染分页控件
        function renderPagination() {
            const paginationContainer = document.getElementById('pagination');
            if (!paginationContainer) return;
            paginationContainer.innerHTML = '';
            const totalPages = Math.ceil(filteredVehicles.length / ITEMS_PER_PAGE);

            if (totalPages <= 1) return;

            const createButton = (text, page, disabled = false, active = false) => {
                const btn = document.createElement('button');
                btn.textContent = text;
                btn.disabled = disabled;
                btn.className = `px-4 py-2 rounded-lg text-sm font-semibold transition-all duration-300 ${
                    active ? 'bg-gradient-to-r from-blue-600 to-blue-500 text-white shadow-lg shadow-blue-500/25' :
                    disabled ? 'bg-gray-800 text-gray-500 cursor-not-allowed' :
                    'bg-gray-800 hover:bg-gray-700 text-white hover:shadow-lg'
                }`;
                if (!disabled) {
                    btn.onclick = () => {
                        currentPage = page;
                        displayVehicles();
                        saveBrowseState();
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    };
                }
                return btn;
            };

            paginationContainer.appendChild(createButton('上一页', currentPage - 1, currentPage === 1));

            const pageNumbers = getPageNumbers(totalPages);
            pageNumbers.forEach(num => {
                if (num === '...') {
                    const dots = document.createElement('span');
                    dots.textContent = '...';
                    dots.className = 'px-4 py-2 text-gray-500';
                    paginationContainer.appendChild(dots);
                } else {
                    paginationContainer.appendChild(createButton(num, num, false, num === currentPage));
                }
            });

            paginationContainer.appendChild(createButton('下一页', currentPage + 1, currentPage === totalPages));
        }

        function getPageNumbers(totalPages) {
            const pages = [];
            if (totalPages <= 7) {
                for (let i = 1; i <= totalPages; i++) {
                    pages.push(i);
                }
            } else {
                if (currentPage <= 4) {
                    for (let i = 1; i <= 5; i++) {
                        pages.push(i);
                    }
                    pages.push('...');
                    pages.push(totalPages);
                } else if (currentPage >= totalPages - 3) {
                    pages.push(1);
                    pages.push('...');
                    for (let i = totalPages - 4; i <= totalPages; i++) {
                        pages.push(i);
                    }
                } else {
                    pages.push(1);
                    pages.push('...');
                    for (let i = currentPage - 1; i <= currentPage + 1; i++) {
                        pages.push(i);
                    }
                    pages.push('...');
                    pages.push(totalPages);
                }
            }
            return pages;
        }

        // 生成特殊改装标签
        function generateSpecialBadges(vehicle) {
            const badges = [];

            if (vehicle.hasHaoUpgrade === 1) {
                badges.push('<span class="badge bg-green-600 text-white text-xs px-2 py-1 rounded-full">阿浩改装</span>');
            }
            if (vehicle.hasImaniUpgrade === 1) {
                badges.push('<span class="badge bg-green-600 text-white text-xs px-2 py-1 rounded-full">伊玛尼改装</span>');
            }
            if (vehicle.hasDriftTune === 1) {
                badges.push('<span class="badge bg-green-600 text-white text-xs px-2 py-1 rounded-full">漂移改装</span>');
            }
            if (vehicle.hasMissileProtection === 1) {
                badges.push('<span class="badge bg-green-600 text-white text-xs px-2 py-1 rounded-full">导弹锁定</span>');
            }
            if (vehicle.isRemovedByRockstar === 1) {
                badges.push('<span class="badge bg-red-600 text-white text-xs px-2 py-1 rounded-full">R星下架</span>');
            }

            return badges.join('');
        }

        function populateFilters() {
            const classFilter = document.getElementById('classFilter');
            const manufacturerFilter = document.getElementById('manufacturerFilter');
            const dlcFilter = document.getElementById('dlcFilter');

            const classes = [...new Set(allVehicles.map(v => v.Class).filter(c => c))].sort();
            const manufacturers = [...new Set(allVehicles.map(v => v.ManufacturerDisplayName?.SimplifiedChinese || v.ManufacturerDisplayName?.English).filter(m => m))].sort();
            const dlcs = [...new Set(allVehicles.map(v => v.DlcName).filter(d => d))].sort();

            classes.forEach(c => {
                const option = document.createElement('option');
                option.value = c;
                option.textContent = c;
                classFilter.appendChild(option);
            });

            manufacturers.forEach(m => {
                const option = document.createElement('option');
                option.value = m;
                option.textContent = m;
                manufacturerFilter.appendChild(option);
            });

            dlcs.forEach(d => {
                const option = document.createElement('option');
                option.value = d;
                option.textContent = d;
                dlcFilter.appendChild(option);
            });
        }

        // 格式化价格显示
        function formatPrice(price) {
            if (price >= 1000000) {
                return (price / 1000000).toFixed(1) + 'M';
            } else if (price >= 1000) {
                return (price / 1000).toFixed(0) + 'K';
            } else {
                return price.toString();
            }
        }

        function setupEventListeners() {
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('keyup', (event) => {
                if (event.key === 'Enter') {
                    applyFiltersAndSort();
                }
            });
            searchInput.addEventListener('input', updateSearchSuggestions);
            document.getElementById('searchButton').addEventListener('click', applyFiltersAndSort);

            document.getElementById('classFilter').addEventListener('change', applyFiltersAndSort);
            document.getElementById('manufacturerFilter').addEventListener('change', applyFiltersAndSort);
            document.getElementById('sortSelect').addEventListener('change', applyFiltersAndSort);
            document.getElementById('hasFreeLiveryFilter').addEventListener('change', applyFiltersAndSort);
            document.getElementById('hasHaoUpgradeFilter').addEventListener('change', applyFiltersAndSort);
            document.getElementById('hasDriftTuneFilter').addEventListener('change', applyFiltersAndSort);
            document.getElementById('hasImaniUpgradeFilter').addEventListener('change', applyFiltersAndSort);
            document.getElementById('hasMissileProtectionFilter').addEventListener('change', applyFiltersAndSort);
            document.getElementById('isRemovedByRockstarFilter').addEventListener('change', applyFiltersAndSort);
            document.getElementById('dlcFilter').addEventListener('change', applyFiltersAndSort);
            document.getElementById('topSpeedFilter').addEventListener('change', applyFiltersAndSort);
            document.getElementById('seatsFilter').addEventListener('change', applyFiltersAndSort);
            document.getElementById('drivetrainFilter').addEventListener('change', applyFiltersAndSort);

            // 价格筛选滑动条
            document.getElementById('priceMin').addEventListener('input', (e) => {
                const min = parseInt(e.target.value);
                const max = parseInt(document.getElementById('priceMax').value);
                if (min > max) {
                    document.getElementById('priceMax').value = min;
                    document.getElementById('priceMaxDisplay').textContent = formatPrice(min);
                }
                document.getElementById('priceMinDisplay').textContent = formatPrice(min);
                applyFiltersAndSort();
            });

            document.getElementById('priceMax').addEventListener('input', (e) => {
                const max = parseInt(e.target.value);
                const min = parseInt(document.getElementById('priceMin').value);
                if (max < min) {
                    document.getElementById('priceMin').value = max;
                    document.getElementById('priceMinDisplay').textContent = formatPrice(max);
                }
                document.getElementById('priceMaxDisplay').textContent = formatPrice(max);
                applyFiltersAndSort();
            });

            // 速度筛选滑动条
            document.getElementById('speedMin').addEventListener('input', (e) => {
                const min = parseInt(e.target.value);
                const max = parseInt(document.getElementById('speedMax').value);
                if (min > max) {
                    document.getElementById('speedMax').value = min;
                    document.getElementById('speedMaxDisplay').textContent = min;
                }
                document.getElementById('speedMinDisplay').textContent = min;
                applyFiltersAndSort();
            });

            document.getElementById('speedMax').addEventListener('input', (e) => {
                const max = parseInt(e.target.value);
                const min = parseInt(document.getElementById('speedMin').value);
                if (max < min) {
                    document.getElementById('speedMin').value = max;
                    document.getElementById('speedMinDisplay').textContent = max;
                }
                document.getElementById('speedMaxDisplay').textContent = max;
                applyFiltersAndSort();
            });

            document.getElementById('resetFiltersBtn').addEventListener('click', resetAllFilters);
            document.getElementById('resetFiltersBtn-mobile').addEventListener('click', resetAllFilters);
            window.addEventListener('scroll', handleScroll);

            // 移动端菜单控制
            const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
            const closeSidebar = document.getElementById('close-sidebar');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');

            function openSidebar() {
                sidebar.classList.remove('-translate-x-full');
                overlay.classList.remove('hidden');
                document.body.classList.add('overflow-hidden');
                
                // 确保移动端可以滚动
                const sidebarContent = sidebar.querySelector('div');
                if (sidebarContent) {
                    sidebarContent.style.webkitOverflowScrolling = 'touch';
                    sidebarContent.style.overscrollBehavior = 'contain';
                }
            }

            function closeSidebarHandler() {
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('hidden');
                document.body.classList.remove('overflow-hidden');
            }

            if (mobileMenuToggle) {
                mobileMenuToggle.addEventListener('click', openSidebar);
            }
            if (closeSidebar) {
                closeSidebar.addEventListener('click', closeSidebarHandler);
            }
            if (overlay) {
                overlay.addEventListener('click', closeSidebarHandler);
            }

            // 响应窗口大小变化
            window.addEventListener('resize', () => {
                if (window.innerWidth >= 1024) { // lg breakpoint
                    closeSidebarHandler();
                }
            });
        }

        // 保存浏览状态
        function resetAllFilters() {
            // 重置所有输入框和选择器
            document.getElementById('searchInput').value = '';
            document.getElementById('classFilter').value = 'all';
            document.getElementById('manufacturerFilter').value = 'all';
            document.getElementById('sortSelect').value = 'date';
            document.getElementById('hasFreeLiveryFilter').value = 'all';
            document.getElementById('hasHaoUpgradeFilter').value = 'all';
            document.getElementById('hasDriftTuneFilter').value = 'all';
            document.getElementById('hasImaniUpgradeFilter').value = 'all';
            document.getElementById('hasMissileProtectionFilter').value = 'all';
            document.getElementById('isRemovedByRockstarFilter').value = 'all';
            document.getElementById('dlcFilter').value = 'all';
            document.getElementById('topSpeedFilter').value = 'all';
            document.getElementById('seatsFilter').value = 'all';
            document.getElementById('drivetrainFilter').value = 'all';

            // 重置滑动条
            document.getElementById('priceMin').value = 0;
            document.getElementById('priceMax').value = 10000000;
            document.getElementById('speedMin').value = 0;
            document.getElementById('speedMax').value = 200;

            // 重置显示文本
            document.getElementById('priceMinDisplay').textContent = '0';
            document.getElementById('priceMaxDisplay').textContent = '1000万';
            document.getElementById('speedMinDisplay').textContent = '0';
            document.getElementById('speedMaxDisplay').textContent = '200';

            // 重新应用筛选
            currentPage = 1;
            applyFiltersAndSort();

            // 在移动端关闭侧边栏
            if (window.innerWidth < 1024) {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('overlay');
                if (sidebar && overlay) {
                    sidebar.classList.add('-translate-x-full');
                    overlay.classList.add('hidden');
                    document.body.classList.remove('overflow-hidden');
                }
            }
        }

        function saveBrowseState() {
            browseState = {
                page: currentPage,
                searchTerm: document.getElementById('searchInput')?.value || '',
                classFilter: document.getElementById('classFilter')?.value || 'all',
                manufacturerFilter: document.getElementById('manufacturerFilter')?.value || 'all',
                sortOrder: document.getElementById('sortSelect')?.value || 'date',
                hasFreeLivery: document.getElementById('hasFreeLiveryFilter')?.value || 'all',
                hasHaoUpgrade: document.getElementById('hasHaoUpgradeFilter')?.value || 'all',
                hasDriftTune: document.getElementById('hasDriftTuneFilter')?.value || 'all',
                hasImaniUpgrade: document.getElementById('hasImaniUpgradeFilter')?.value || 'all',
                hasMissileProtection: document.getElementById('hasMissileProtectionFilter')?.value || 'all',
                isRemovedByRockstar: document.getElementById('isRemovedByRockstarFilter')?.value || 'all',
                dlcFilter: document.getElementById('dlcFilter')?.value || 'all',
                topSpeedFilter: document.getElementById('topSpeedFilter')?.value || 'all',
                seatsFilter: document.getElementById('seatsFilter')?.value || 'all',
                drivetrainFilter: document.getElementById('drivetrainFilter')?.value || 'all',
                priceMin: parseInt(document.getElementById('priceMin')?.value) || 0,
                priceMax: parseInt(document.getElementById('priceMax')?.value) || 10000000,
                speedMin: parseInt(document.getElementById('speedMin')?.value) || 0,
                speedMax: parseInt(document.getElementById('speedMax')?.value) || 200
            };
            localStorage.setItem('gtaVehiclesBrowseState', JSON.stringify(browseState));
        }

        let isRestoringState = false;

        // 恢复浏览状态
        function restoreBrowseState() {
            const savedState = localStorage.getItem('gtaVehiclesBrowseState');
            if (savedState) {
                try {
                    browseState = JSON.parse(savedState);

                    // 恢复输入框和选择器的状态
                    const searchInput = document.getElementById('searchInput');
                    const classFilter = document.getElementById('classFilter');
                    const manufacturerFilter = document.getElementById('manufacturerFilter');
                    const sortSelect = document.getElementById('sortSelect');
                    const hasFreeLiveryFilter = document.getElementById('hasFreeLiveryFilter');
                    const hasHaoUpgradeFilter = document.getElementById('hasHaoUpgradeFilter');
                    const hasDriftTuneFilter = document.getElementById('hasDriftTuneFilter');
                    const hasImaniUpgradeFilter = document.getElementById('hasImaniUpgradeFilter');
                    const hasMissileProtectionFilter = document.getElementById('hasMissileProtectionFilter');
                    const isRemovedByRockstarFilter = document.getElementById('isRemovedByRockstarFilter');
                    const dlcFilter = document.getElementById('dlcFilter');
                    const topSpeedFilter = document.getElementById('topSpeedFilter');
                    const seatsFilter = document.getElementById('seatsFilter');
                    const drivetrainFilter = document.getElementById('drivetrainFilter');
                    const priceMin = document.getElementById('priceMin');
                    const priceMax = document.getElementById('priceMax');
                    const speedMin = document.getElementById('speedMin');
                    const speedMax = document.getElementById('speedMax');

                    if (searchInput) searchInput.value = browseState.searchTerm || '';
                    if (classFilter) classFilter.value = browseState.classFilter || 'all';
                    if (manufacturerFilter) manufacturerFilter.value = browseState.manufacturerFilter || 'all';
                    if (sortSelect) sortSelect.value = browseState.sortOrder || 'date';
                    if (hasFreeLiveryFilter) hasFreeLiveryFilter.value = browseState.hasFreeLivery || 'all';
                    if (hasHaoUpgradeFilter) hasHaoUpgradeFilter.value = browseState.hasHaoUpgrade || 'all';
                    if (hasDriftTuneFilter) hasDriftTuneFilter.value = browseState.hasDriftTune || 'all';
                    if (hasImaniUpgradeFilter) hasImaniUpgradeFilter.value = browseState.hasImaniUpgrade || 'all';
                    if (hasMissileProtectionFilter) hasMissileProtectionFilter.value = browseState.hasMissileProtection || 'all';
                    if (isRemovedByRockstarFilter) isRemovedByRockstarFilter.value = browseState.isRemovedByRockstar || 'all';
                    if (dlcFilter) dlcFilter.value = browseState.dlcFilter || 'all';
                    if (topSpeedFilter) topSpeedFilter.value = browseState.topSpeedFilter || 'all';
                    if (seatsFilter) seatsFilter.value = browseState.seatsFilter || 'all';
                    if (drivetrainFilter) drivetrainFilter.value = browseState.drivetrainFilter || 'all';

                    // 恢复滑动条状态
                    if (priceMin) {
                        priceMin.value = browseState.priceMin || 0;
                        document.getElementById('priceMinDisplay').textContent = formatPrice(priceMin.value);
                    }
                    if (priceMax) {
                        priceMax.value = browseState.priceMax || 10000000;
                        document.getElementById('priceMaxDisplay').textContent = formatPrice(priceMax.value);
                    }
                    if (speedMin) {
                        speedMin.value = browseState.speedMin || 0;
                        document.getElementById('speedMinDisplay').textContent = speedMin.value;
                    }
                    if (speedMax) {
                        speedMax.value = browseState.speedMax || 200;
                        document.getElementById('speedMaxDisplay').textContent = speedMax.value;
                    }

                    currentPage = browseState.page || 1;

                    // 标记为恢复状态，避免触发保存，延迟更长确保状态恢复完成
                    isRestoringState = true;

                } catch (e) {
                    console.warn('无法恢复浏览状态:', e);
                }
            }
        }

        function updateSearchSuggestions(event) {
            const searchTerm = event.target.value.toLowerCase();
            const suggestionsContainer = document.getElementById('search-suggestions');
            suggestionsContainer.innerHTML = '';

            if (searchTerm.length < 2) return;

            const suggestions = new Set();
            allVehicles.forEach(v => {
                const nameSC = v.DisplayName?.SimplifiedChinese?.toLowerCase() || '';
                const nameEN = v.DisplayName?.English?.toLowerCase() || '';
                if (nameSC.includes(searchTerm)) suggestions.add(v.DisplayName.SimplifiedChinese);
                if (nameEN.includes(searchTerm)) suggestions.add(v.DisplayName.English);
            });

            [...suggestions].slice(0, 5).forEach(suggestion => {
                const option = document.createElement('option');
                option.value = suggestion;
                suggestionsContainer.appendChild(option);
            });
        }

        // 禁止页面缩放的通用处理函数
        function disableZoom() {
            // 1) 强制 viewport meta 禁止缩放
            let vp = document.querySelector('meta[name="viewport"]');
            if (!vp) {
                vp = document.createElement('meta');
                vp.name = 'viewport';
                document.head.appendChild(vp);
            }
            vp.content = 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no';

            // 2) 阻止 Ctrl/Cmd + 鼠标滚轮缩放
            window.addEventListener('wheel', function (e) {
                if (e.ctrlKey || e.metaKey) {
                    e.preventDefault();
                }
            }, { passive: false });

            // 3) 阻止键盘缩放（Ctrl/Cmd + +/- 或 Ctrl+Scroll 以外的情况）
            window.addEventListener('keydown', function (e) {
                if ((e.ctrlKey || e.metaKey) && (e.key === '+' || e.key === '-' || e.key === '=' || e.key === '0')) {
                    e.preventDefault();
                }
            }, { passive: false });

            // 4) 阻止触摸缩放（双指捏合）
            let lastTouchEnd = 0;
            document.addEventListener('touchstart', function (e) {
                if (e.touches && e.touches.length > 1) {
                    e.preventDefault();
                }
            }, { passive: false });

            // 防止双击放大（iOS）
            document.addEventListener('touchend', function (e) {
                const now = Date.now();
                if (now - lastTouchEnd <= 300) {
                    e.preventDefault();
                }
                lastTouchEnd = now;
            }, { passive: false });

            // 5) 阻止 gesture events（Safari）
            document.addEventListener('gesturestart', function (e) { e.preventDefault(); }, { passive: false });
            document.addEventListener('gesturechange', function (e) { e.preventDefault(); }, { passive: false });
            document.addEventListener('gestureend', function (e) { e.preventDefault(); }, { passive: false });
        }

        function handleScroll() {
            const filterBar = document.getElementById('filter-bar');
            if (filterBar) {
                const currentScrollY = window.scrollY;
                if (Math.abs(currentScrollY - lastScrollY) < 20) {
                    return; // Avoid jitter
                }
                if (currentScrollY > lastScrollY && currentScrollY > 150) {
                    // Scrolling down
                    filterBar.classList.add('hide');
                } else {
                    // Scrolling up
                    filterBar.classList.remove('hide');
                }
                lastScrollY = currentScrollY <= 0 ? 0 : currentScrollY;
            }
        }

        async function init() {
            // 添加加载动画
            document.body.classList.add('loading');

            // 禁止页面放大缩小（通过 JS 强制拦截手势、键盘和滚轮缩放）
            try {
                disableZoom();
            } catch (e) {
                // ignore
            }

            try {
                const response = await fetch('vehicles_database_antwen.json?v=' + Date.now());
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                allVehicles = await response.json();

                // 为所有图片URL添加Cloudflare R2域名前缀
                console.log('开始处理图片URL...', allVehicles.length, '辆车');
                allVehicles.forEach(vehicle => {
                    if (vehicle.ImageUrl && !vehicle.ImageUrl.startsWith('http')) {
                        vehicle.ImageUrl = 'https://eo-gta-images.antwen.com/' + vehicle.ImageUrl;
                    }
                    if (vehicle.bakImageUrl && !vehicle.bakImageUrl.startsWith('http')) {
                        vehicle.bakImageUrl = 'https://eo-gta-images.antwen.com/' + vehicle.bakImageUrl;
                    }
                    if (vehicle.liveries && Array.isArray(vehicle.liveries)) {
                        vehicle.liveries.forEach(livery => {
                            if (livery.link && !livery.link.startsWith('http')) {
                                livery.link = 'https://eo-gta-images.antwen.com/' + livery.link;
                            }
                            if (livery.baklink && !livery.baklink.startsWith('http')) {
                                livery.baklink = 'https://eo-gta-images.antwen.com/' + livery.baklink;
                            }
                        });
                    }
                    if (vehicle.Screenshots && Array.isArray(vehicle.Screenshots)) {
                        vehicle.Screenshots.forEach((screenshot, index) => {
                            if (screenshot && !screenshot.startsWith('http')) {
                                vehicle.Screenshots[index] = 'https://eo-gta-images.antwen.com/' + screenshot;
                            }
                        });
                    }
                });

                // 默认按日期排序
                allVehicles.sort((a, b) => new Date(b.ReleaseDate) - new Date(a.ReleaseDate));

                filteredVehicles = [...allVehicles];

                // 数据加载完成后再进行路由
                await router();
                // 根据导航高度调整内容顶部间距，确保导航不会遮挡内容
                try {
                    adjustContentForNav();
                    window.addEventListener('resize', adjustContentForNav);
                } catch (e) {
                    // ignore if adjustContentForNav is not available
                }

            } catch (error) {
                app.innerHTML = `<div class="text-center text-red-500 text-xl">
                    <p>错误：无法加载车辆数据。</p>
                    <p class="text-sm mt-2">请确保 'vehicles_database_antwen.json' 文件与此 HTML 文件在同一目录下。</p>
                    <p class="text-sm mt-2">错误详情: ${error.message}</p>
                </div>`;
            } finally {
                document.body.classList.remove('loading');
            }
        }

        window.addEventListener('hashchange', router);
        document.addEventListener('DOMContentLoaded', init);
    </script>

    <script>
        // 仅控制导航栏的移动下拉菜单，避免与主脚本中 sidebar 的 mobile-menu-toggle 冲突
        const navToggle = document.getElementById('nav-mobile-menu-toggle');
        const navMenu = document.getElementById('nav-mobile-menu');
        if (navToggle && navMenu) {
            navToggle.addEventListener('click', function() {
                navMenu.classList.toggle('show');
            });
        }

        // 在导航栏添加搜索按钮，点击时打开侧边栏搜索（优先触发页面中的主侧边栏按钮）
        const navSearchToggle = document.getElementById('nav-search-toggle');
        if (navSearchToggle) {
            navSearchToggle.addEventListener('click', function() {
                // 如果页面中存在控制侧边栏的按钮，触发它的 click（它在 setupEventListeners 中绑定了 openSidebar）
                const mainSidebarToggle = document.getElementById('mobile-menu-toggle');
                if (mainSidebarToggle) {
                    mainSidebarToggle.click();
                    return;
                }

                // 回退：直接打开侧边栏（与主脚本 openSidebar 行为一致），并修正顶部以避免被导航挡住
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('overlay');
                const nav = document.querySelector('.gta-nav');
                const navHeight = nav ? nav.offsetHeight || 0 : 0;
                if (sidebar && overlay) {
                    // 确保侧边栏显示并不被导航遮挡
                    sidebar.classList.remove('-translate-x-full');
                    sidebar.style.top = navHeight + 'px';
                    sidebar.style.height = `calc(100% - ${navHeight}px)`;
                    overlay.classList.remove('hidden');
                    if (overlay) {
                        overlay.style.top = navHeight + 'px';
                        overlay.style.height = `calc(100% - ${navHeight}px)`;
                    }
                    document.body.classList.add('overflow-hidden');
                }
            });
        }
    </script>
</body>
</html>
